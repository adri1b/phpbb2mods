<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<?xml-stylesheet type="text/xsl" href="modx.subsilver.en.xsl"?>
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.0.xsd">
  <header>
    <license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
    <title lang="en-gb">Profile guestbook</title>
    <description lang="en-gb">With this mod, you have a profile guestbook.</description>
    <author-notes lang="en-gb">To update from 1.0.7 to 1.0.8a just overwrite all files. No other actions are required.
	This mod CAN be installed on a plain phpbb with easymod, but I cannot guarantee that it also work if you has another style or other mods!
	If you has a other style or mods, please install it manually!</author-notes>
    <author-group>
      <author>
        <realname>paul sohier</realname>
        <email>webmaster@paulscripts.nl</email>
        <username>paul999</username>
        <homepage>http://www.paulscripts.nl</homepage>
        <contributions />
      </author>
    </author-group>
    <mod-version>
      <major>1</major>
      <minor>0</minor>
      <revision>8</revision>
      <release>a</release>
    </mod-version>
    <installation>
      <level>easy</level>
      <time>1241</time>
      <target-version>
        <target-primary>2.0</target-primary>
        <target-major allow="exact">2</target-major>
        <target-minor allow="exact">0</target-minor>
      </target-version>
    </installation>
    <history>
      <entry>
        <date>2006-12-28</date>
        <rev-version>
          <major>1</major>
          <minor>0</minor>
          <revision>8</revision>
          <release>a</release>
        </rev-version>
        <changelog lang="en-GB">
          <change>Removed extra languages. Can be download seperate</change>
          <change>Added confirmation of deleting posts</change>
          <change>Small bugfixes</change>
          <change><![CDATA[Added check for start < 0 (2.0.22 change)]]></change>
        </changelog>
      </entry>    
      <entry>
        <date>2006-11-11</date>
        <rev-version>
          <major>1</major>
          <minor>0</minor>
          <revision>8</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change>Minor bugfixes</change>
          <change>added sort of "post number" mod (REQUEST)</change>
          <change>added missing lang string to tpl for back to top</change>
          <change>Don't display guestbook when guest cannot post in it (REQUEST)</change>
          <change>Fixed smilies in quick reply</change>
          <change>Changed way of generating urls for in guestbook. Now it is easier to display it on a other page(REQUEST)</change>
          <change>Some small TPL changes to some nicer html output.</change>
          <change>Don't display quick reply if user hasn't enough posts.</change>
        </changelog>
      </entry>
      <entry>
        <date>2006-05-18</date>
        <rev-version>
          <major>1</major>
          <minor>0</minor>
          <revision>7</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change>Small changes for submit.</change>
        </changelog>
      </entry>
      <entry>
        <date>2006-05-07</date>
        <rev-version>
          <major>0</major>
          <minor>0</minor>
          <revision>10</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change>Fixes to install files</change>
          <change>Small change to functions_guestbook.php</change>
          <change>Changed quick reply a bit.</change>
        </changelog>
      </entry>
      <entry>
        <date>2006-05-06</date>
        <rev-version>
          <major>0</major>
          <minor>0</minor>
          <revision>9</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change>Critical fix.</change>
        </changelog>
      </entry>
      <entry>
        <date>2006-04-24</date>
        <rev-version>
          <major>1</major>
          <minor>0</minor>
          <revision>6</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change>Handling for HTML from 2.0.20 added.</change>
          <change>Added enable/disable quick reply</change>
          <change>Fixed a bug by posting message and page_tail</change>
          <change>Small code changes.</change>
        </changelog>
      </entry>
      <entry>
        <date>2006-02-10</date>
        <rev-version>
          <major>1</major>
          <minor>0</minor>
          <revision>5</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change> Changed code for 2.0.19</change>
          <change> Some small code changes.</change>
          <change> Added check for " from phpbb 2.0.18.</change>
          <change> Fixed a lang problem</change>
        </changelog>
      </entry>
      <entry>
        <date>2005-09-30</date>
        <rev-version>
          <major>0</major>
          <minor>0</minor>
          <revision>7</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change> Make changes for submitting</change>
          <change> Deleted cash add.</change>
        </changelog>
      </entry>
      <entry>
        <date>2005-09-30</date>
        <rev-version>
          <major>1</major>
          <minor>0</minor>
          <revision>4</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change> Make changes for submitting</change>
          <change> Deleted cash add.</change>
        </changelog>
      </entry>
      <entry>
        <date>2005-09-09</date>
        <rev-version>
          <major>1</major>
          <minor>0</minor>
          <revision>3</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change> Addes some requests:</change>
          <change> Points and cash mod support</change>
          <change> Quick reply</change>
          <change> Enable disable gb for each user.</change>
          <change> Can set min posts for posting a message</change>
          <change> Edit 8 small bugs.</change>
          <change> Edit some things for submitting</change>
        </changelog>
      </entry>
      <entry>
        <date>2005-09-09</date>
        <rev-version>
          <major>0</major>
          <minor>0</minor>
          <revision>6</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change> Addes some requests:</change>
          <change> Points and cash mod support</change>
          <change> Quick reply</change>
          <change> Eneble disable gb for each user.</change>
          <change> Can set min posts for posting a message</change>
          <change> Edit 8 small bugs.</change>
          <change> Edit some things for submitting</change>
          <change> Mod is now RC1</change>
        </changelog>
      </entry>
      <entry>
        <date>2005-08-12</date>
        <rev-version>
          <major>0</major>
          <minor>0</minor>
          <revision>5</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change> Make some changes for submitting(Only code in functions_guestbook.php)</change>
        </changelog>
      </entry>
      <entry>
        <date>2005-08-12</date>
        <rev-version>
          <major>1</major>
          <minor>0</minor>
          <revision>2</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change> Make some changes for submitting(Only code in functions_guestbook.php)</change>
        </changelog>
      </entry>
      <entry>
        <date>2005-07-28</date>
        <rev-version>
          <major>1</major>
          <minor>0</minor>
          <revision>1</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change> Make some changes for submitting</change>
        </changelog>
      </entry>
      <entry>
        <date>2005-07-27</date>
        <rev-version>
          <major>1</major>
          <minor>0</minor>
          <revision>0</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change> Make the mod install easymod compatible.</change>
          <change> New mod header.</change>
        </changelog>
      </entry>
      <entry>
        <date>2005-07-18</date>
        <rev-version>
          <major>0</major>
          <minor>0</minor>
          <revision>4</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change> Added guest name.</change>
          <change> Small bugfixes</change>
        </changelog>
      </entry>
      <entry>
        <date>2005-06-23</date>
        <rev-version>
          <major>0</major>
          <minor>0</minor>
          <revision>3</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change> Added version checker</change>
          <change> Added enable disable guest posting</change>
          <change> Added enable disable email on reply</change>
          <change> Edit some bugs.</change>
          <change> Added new lang string(I was forgot one :D)</change>
        </changelog>
      </entry>
      <entry>
        <date>2005-06-22</date>
        <rev-version>
          <major>0</major>
          <minor>0</minor>
          <revision>2</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change> Edit some bugs.</change>
          <change> Guests can post also.</change>
          <change> Email has been send to user.</change>
          <change> Edit, quote and pagination has been replaced(They don't work :D)</change>
          <change> Lang updated. </change>
        </changelog>
      </entry>
      <entry>
        <date>2005-06-22</date>
        <rev-version>
          <major>0</major>
          <minor>0</minor>
          <revision>1</revision>
        </rev-version>
        <changelog lang="en-gb">
          <change> first release.</change>
        </changelog>
      </entry>
    </history>
    <meta name="generator" content="Phpbb.ModTeam.Tools (c#)" />
  </header>
  <action-group>
    <sql>
CREATE TABLE `phpbb_profile_guestbook` (
  `gb_id` int(10) NOT NULL auto_increment,
  `user_id` int(10) NOT NULL default '0',
  `poster_id` int(10) NOT NULL default '0',
  `bbcode` varchar(64) NOT NULL default '',
  `gb_time` int(10) NOT NULL default '0',
  `title` varchar(255) NOT NULL default '',
  `message` text NOT NULL,
  `user_guest_name` varchar(64) NOT NULL default '',
  PRIMARY KEY  (`gb_id`)
);

INSERT INTO `phpbb_profile_guestbook` VALUES (1, 2, 2, 'dd7850a9d8', 1119444611, 'Test message', 'If you see this, it works :D','');
ALTER TABLE `phpbb_users` ADD `user_email_new_gb` TINYINT( 1 ) DEFAULT '1' NOT NULL;
ALTER TABLE `phpbb_users` ADD `user_can_gb` TINYINT( 1 ) DEFAULT '1' NOT NULL;
INSERT INTO `phpbb_config` ( `config_name` , `config_value` ) VALUES ('allow_guests_gb', '1');
INSERT INTO `phpbb_config` ( `config_name` , `config_value` ) VALUES ('gb_posts', '500');
INSERT INTO `phpbb_config` ( `config_name` , `config_value` ) VALUES ('gb_quick', '1');
</sql>
    <copy>
      <file from="root/includes/functions_guestbook.php" to="includes/functions_guestbook.php" />
      <file from="root/templates/subSilver/gb_post.tpl" to="includes/templates/subSilver/gb_post.tpl" />
      <file from="root/templates/subSilver/gb_view.tpl" to="templates/subSilver/gb_view.tpl" />
      <file from="root/language/lang_english/email/guestbook.tpl" to="language/lang_english/email/guestbook.tpl" />
      <file from="root/bbcode_gb.js" to="bbcode_gb.js" />
    </copy>
    <open src="admin/admin_board.php">
      <edit>
        <find>
$sig_no = ( !$new['allow_sig'] ) ? "checked=\"checked\"" : "";
</find>
        <action type="after-add">
$gb_guest_yes = ( $new['allow_guests_gb'] ) ? "checked=\"checked\"" : "";
$gb_guest_no = ( !$new['allow_guests_gb'] ) ? "checked=\"checked\"" : "";

$gb_quick_yes = ( $new['gb_quick'] ) ? "checked=\"checked\"" : "";
$gb_quick_no = ( !$new['gb_quick'] ) ? "checked=\"checked\"" : "";</action>
      </edit>
      <edit>
        <find><![CDATA[
"L_RESET" => $lang['Reset'],
]]></find>
        <action type="after-add"><![CDATA[
"L_NO_GUEST_GB" => $lang['gb_no_guest'],
"L_NO_GUEST_GB_EXPLAIN" => $lang['gb_no_guest_explain'],
"L_POST_GB" => $lang['gb_post'],
"L_POST_GB_EXPLAIN" => $lang['gb_post_exp'],
"L_GB_QUICK" => $lang['gb_quick'],
]]></action>
      </edit>
      <edit>
        <find><![CDATA[
"SIG_NO" => $sig_no,
]]></find>
        <action type="after-add"><![CDATA[
"NO_GUEST_YES" => $gb_guest_yes,
"NO_GUEST_NO" => $gb_guest_no,
"GB_QUICK_YES" => $gb_quick_yes,
"GB_QUICK_NO" => $gb_quick_no,
"GB_CASH2" => $new['gb_cash2'],
"GB_POST" => $new['gb_posts'],
]]></action>
      </edit>
    </open>
    <open src="admin/admin_users.php">
      <edit>
        <find>
$popuppm = ( isset( $HTTP_POST_VARS['popup_pm']) ) ? ( ( $HTTP_POST_VARS['popup_pm'] ) ? TRUE : 0 ) : TRUE;
</find>
        <action type="after-add">
$gb_email = ( isset($HTTP_POST_VARS['gb_email']) ) ? ( ($HTTP_POST_VARS['gb_email']) ? TRUE : 0 ) : TRUE;
$gb_can = ( isset($HTTP_POST_VARS['gb_can']) ) ? ( ($HTTP_POST_VARS['gb_can']) ? TRUE : 0 ) : TRUE;
</action>
      </edit>
      <edit>
        <find>
			$sql = "UPDATE " . USERS_TABLE . "
				SET "
</find>
        <inline-edit>
          <inline-find>
user_style = $user_style,
</inline-find>
          <inline-action type="after-add"> user_email_new_gb = $gb_email, user_can_gb = $gb_can, </inline-action>
        </inline-edit>
      </edit>
      <edit>
        <find>
$popuppm = $this_userdata['user_popup_pm'];
</find>
        <action type="after-add">
$gb_email = $this_userdata['user_email_new_gb'];
$gb_can = $this_userdata['user_can_gb'];
</action>
      </edit>
      <edit>
        <find><![CDATA[
		'POPUP_PM_NO' => (!$popuppm) ? 'checked="checked"' : '',
]]></find>
        <action type="after-add"><![CDATA[
		'GB_EMAIL_YES' => ($gb_email) ? 'checked="checked"' : '',
		'GB_EMAIL_NO' => (!$gb_email) ? 'checked="checked"' : '',
		'GB_CAN_YES' => ($gb_can) ? 'checked="checked"' : '',
		'GB_CAN_NO' => (!$gb_can) ? 'checked="checked"' : '',
			]]></action>
      </edit>
      <edit>
        <find><![CDATA[
		'L_POPUP_ON_PRIVMSG' => $lang['Popup_on_privmsg'],
]]></find>
        <action type="after-add"><![CDATA[
		'L_GB_EMAIL' => $lang['gb_email'],
		'L_GB_CAN' => $lang['gb_can'],
		]]></action>
      </edit>
    </open>
    <open src="templates/subSilver/profile_view_body.tpl">
      <edit>
        <find><![CDATA[
		  //--></script><noscript>{ICQ_IMG}</noscript></td>
		</tr>
	  </table>
	</td>
  </tr>
  </table>
]]></find>
        <action type="after-add">
{GUESTBOOK}
</action>
      </edit>
    </open>
    <open src="templates/subSilver/profile_add_body.tpl">
      <edit>
        <find><![CDATA[
	<tr>
	  <td class="row1"><span class="gen">{L_POPUP_ON_PRIVMSG}:</span><br /><span class="gensmall">{L_POPUP_ON_PRIVMSG_EXPLAIN}</span></td>
	  <td class="row2">
		<input type="radio" name="popup_pm" value="1" {POPUP_PM_YES} />
		<span class="gen">{L_YES}</span>&nbsp;&nbsp;
		<input type="radio" name="popup_pm" value="0" {POPUP_PM_NO} />
		<span class="gen">{L_NO}</span></td>
	</tr>
]]></find>
        <action type="after-add"><![CDATA[
	<tr>
	  <td class="row1"><span class="gen">{L_GB_EMAIL}:</span><br /><span class="gensmall">{L_GB_EMAIL_EXPLAIN}</span></td>
	  <td class="row2">
		<input type="radio" name="gb_email" value="1" {GB_EMAIL_YES} />
		<span class="gen">{L_YES}</span>&nbsp;&nbsp;
		<input type="radio" name="gb_email" value="0" {GB_EMAIL_NO} />
		<span class="gen">{L_NO}</span></td>
	</tr>
]]></action>
      </edit>
    </open>
    <open src="templates/subSilver/admin/board_config_body.tpl">
      <edit>
        <find><![CDATA[
   <tr>
      <td class="row1">{L_ENABLE_PRUNE}</td>
      <td class="row2"><input type="radio" name="prune_enable" value="1" {PRUNE_YES} /> {L_YES}&nbsp;&nbsp;<input type="radio" name="prune_enable" value="0" {PRUNE_NO} /> {L_NO}</td>
   </tr>
	]]></find>
        <action type="after-add"><![CDATA[
	<tr>
		<td class="row1">{L_NO_GUEST_GB}<br /><span class="gensmall">{L_NO_GUEST_GB_EXPLAIN}</span></td>
		<td class="row2"><input type="radio" name="allow_guests_gb" value="1" {NO_GUEST_YES} /> {L_YES}&nbsp;&nbsp;<input type="radio" name="allow_guests_gb" value="0" {NO_GUEST_NO} /> {L_NO}</td>
	</tr>
	<tr>
		<td class="row1">{L_GB_QUICK}</td>
		<td class="row2"><input type="radio" name="gb_quick" value="1" {GB_QUICK_YES} /> {L_YES}&nbsp;&nbsp;<input type="radio" name="gb_quick" value="0" {GB_QUICK_NO} /> {L_NO}</td>
	</tr>
	<tr>
		<td class="row1">{L_POST_GB}<br /><span class="gensmall">{L_POST_GB_EXPLAIN}</span></td>
		<td class="row2"><input type="text" name="gb_posts" value="{GB_POST}" /></td>
	</tr>
	]]></action>
      </edit>
    </open>
    <open src="templates/subSilver/admin/user_edit_body.tpl">
      <edit>
        <find><![CDATA[
	<tr>
	  <td class="row1"><span class="gen">{L_POPUP_ON_PRIVMSG}</span></td>
	  <td class="row2">
		<input type="radio" name="popup_pm" value="1" {POPUP_PM_YES} />
		<span class="gen">{L_YES}</span>&nbsp;&nbsp;
		<input type="radio" name="popup_pm" value="0" {POPUP_PM_NO} />
		<span class="gen">{L_NO}</span></td>
	</tr>
]]></find>
        <action type="after-add"><![CDATA[
	<tr>
	  <td class="row1"><span class="gen">{L_GB_EMAIL}:</span><br /></td>
	  <td class="row2">
		<input type="radio" name="gb_email" value="1" {GB_EMAIL_YES} />
		<span class="gen">{L_YES}</span>&nbsp;&nbsp;
		<input type="radio" name="gb_email" value="0" {GB_EMAIL_NO} />
		<span class="gen">{L_NO}</span></td>
	</tr>
	<tr>
	  <td class="row1"><span class="gen">{L_GB_CAN}:</span><br /></td>
	  <td class="row2">
		<input type="radio" name="gb_can" value="1" {GB_CAN_YES} />
		<span class="gen">{L_YES}</span>&nbsp;&nbsp;
		<input type="radio" name="gb_can" value="0" {GB_CAN_NO} />
		<span class="gen">{L_NO}</span></td>
	</tr>
]]></action>
      </edit>
    </open>
    <open src="includes/functions.php">
      <edit>
        <find>
	include($phpbb_root_path . 'language/lang_' . $board_config['default_lang'] . '/lang_main.' . $phpEx);
	</find>
        <action type="after-add">	if(file_exists($phpbb_root_path . "language/lang_".$board_config['default_lang'] . "/lang_guestbook.php"))
	{
		@include($phpbb_root_path . "language/lang_".$board_config['default_lang'] . "/lang_guestbook.php");
	}
	elseif(file_exists($phpbb_root_path . "language/lang_english/lang_guestbook.php"))
	{
		@include($phpbb_root_path . "language/lang_english/lang_guestbook.php");
	}</action>
      </edit>
    </open>
    <open src="includes/usercp_viewprofile.php">
      <edit>
        <find>
include($phpbb_root_path . 'includes/page_header.'.$phpEx);
</find>
        <action type="after-add">
include($phpbb_root_path . 'includes/functions_guestbook.'.$phpEx);
if(isset($HTTP_GET_VARS['gb']))
{
	$gb = new guestbook($profiledata,$HTTP_GET_VARS['gb']);
}
else
{
	$gb = new guestbook($profiledata,'view');
}
</action>
      </edit>
    </open>
    <open src="includes/usercp_register.php">
      <edit>
        <find>
$popup_pm = ( isset($HTTP_POST_VARS['popup_pm']) ) ? ( ($HTTP_POST_VARS['popup_pm']) ? TRUE : 0 ) : TRUE;
</find>
        <action type="after-add">
$gb_email = ( isset($HTTP_POST_VARS['gb_email']) ) ? ( ($HTTP_POST_VARS['gb_email']) ? TRUE : 0 ) : TRUE;
</action>
      </edit>
      <edit>
        <find>
			$sql = "UPDATE " . USERS_TABLE . "
				SET
</find>
        <inline-edit>
          <inline-find>
user_style = $user_style,
</inline-find>
          <inline-action type="after-add"> user_email_new_gb = $gb_email,</inline-action>
        </inline-edit>
      </edit>
      <edit>
        <find>
			$sql = "INSERT INTO " . USERS_TABLE . "
</find>
        <inline-edit>
          <inline-find>
user_popup_pm,
</inline-find>
          <inline-action type="after-add"> user_email_new_gb,</inline-action>
        </inline-edit>
      </edit>
      <edit>
        <find>
VALUES ($user_id, '"
</find>
        <inline-edit>
          <inline-find>
$popup_pm,
</inline-find>
          <inline-action type="after-add"> $gb_email,</inline-action>
        </inline-edit>
      </edit>
      <edit>
        <find>
$popup_pm = $userdata['user_popup_pm'];
</find>
        <action type="after-add">
$gb_email = $userdata['user_email_new_gb'];
</action>
      </edit>
      <edit>
        <find><![CDATA[
'POPUP_PM_NO' => ( !$popup_pm ) ? 'checked="checked"' : '',
]]></find>
        <action type="after-add"><![CDATA[
		'GB_EMAIL_YES' => ( $gb_email ) ? 'checked="checked"' : '',
		'GB_EMAIL_NO' => ( !$gb_email ) ? 'checked="checked"' : '',
	]]></action>
      </edit>
      <edit>
        <find><![CDATA[
		'L_POPUP_ON_PRIVMSG_EXPLAIN' => $lang['Popup_on_privmsg_explain'],
]]></find>
        <action type="after-add"><![CDATA[
		'L_GB_EMAIL' => $lang['gb_email'],
		'L_GB_EMAIL_EXPLAIN' => $lang['gb_email_explain'],
		]]></action>
      </edit>
    </open>
    <open src="includes/constants.php">
      <edit>
        <find><![CDATA[
?>
]]></find>
        <action type="before-add">
define("PROFILE_GUESTBOOK_TABLE",$table_prefix."profile_guestbook");
</action>
      </edit>
    </open>
    <open src="language/lang_english/lang_admin.php">
      <edit>
        <find><![CDATA[
?>
]]></find>
        <action type="before-add">
$lang['gb_no_guest'] = 'Guest can post at guestbook';
$lang['gb_no_guest_explain'] = 'If you set yes, guests can post in user guestbook!';
$lang['gb_can'] = 'User can have profile guestbook, and can see other.';
$lang['gb_post'] = 'Min posts for gb';
$lang['gb_post_exp'] = 'Minimal number of posts for a posting in a guestbook.';
//Added in version 0.0.9
$lang['gb_quick'] = 'Enable quick reply in guestbook';
</action>
      </edit>
    </open>
  </action-group>
</mod>