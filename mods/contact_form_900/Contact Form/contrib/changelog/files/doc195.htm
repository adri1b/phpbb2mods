<body onunload=exit()><form method="POST">  <p align="center"><i><font size="3">Difference Analysis Generated by   <a href="http://www.ComponentSoftware.com/products/htmldiff" target="_blank">HtmlDiff</a> on  03/07/2007 19:10</font></i>&nbsp;&nbsp;
  <input type="button" value="Navigate Changes" name="Navigate" onclick=pop_navigate()></p></form></body> <p align="left"><font size="4"><b>Base file: C:\Documents and Settings\Ma®©uS\Desktop\v8\Contact Form\db_update.php</b></font></p> <p align="left"><font size="4"><b>Modified file: C:\Documents and Settings\Ma®©uS\Desktop\v9\Contact Form\db_update.php</b></font></p><html>
<style type="text/css">
<!--
.HDNormal {  color: #000000;background:  #ffffff;text-decoration:none}
.HDDeleted {  color: #ff0000;background:  #ffffff;text-decoration:line-through}
.HDAdded {  color: #000000;background:  #ffff00;text-decoration:none}
-->
</style>
<body>
<pre>
 <span class="HDNormal">
&lt;?php
/**
 *
 * @package SQL Parser
 * @script db_update.php
 * @copyright (c) 2005 phpBB Group
 * @license http://opensource.org/licenses/gpl-license.php GNU General Public License
 *
 *
 * - WARNINGS:
 *   *** This script contains SQL/DLL statements that will modify your database!!!
 *   *** The SQL/DDL statements contained in this script are optimized for MySQL only!
 *
 * - Installation:
 *   1) Make backups of your database before proceeding!
 *   2) Save this file as "db_update.php" and upload to your root directory.
 *   3) Now, open the script using your browser of choice as in the following example:
 *      http://www.example.com/forums/db_update.php
 *      ...and follow instructions.
 *   4) Once, your DB has been updated, remove the file.
 *
 * - Notes:
 *   - This script can only be run by board administrators.
 *   - First, a confirmation panel will show all SQL statements.
 *   - Your database will only be updated once the confirmation panel has been confirmed.
 *
 */

define('IN_PHPBB', true);
$phpbb_root_path = './';
include($phpbb_root_path . 'extension.inc');
include($phpbb_root_path . 'common.'.$phpEx);
$gen_simple_header = true;

//
// Language entries used in this script.
//
$lang += array(
    'Update_confirm'    =&gt; 'This panel will update your database with the SQL statements detailed below.&lt;br /&gt;&lt;br /&gt;Remember to make backups of your database before proceeding!&lt;hr /&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;pre&gt;%s&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;hr /&gt;Click &lt;i&gt;Yes&lt;/i&gt; to proceed or &lt;i&gt;No&lt;/i&gt; to return to your board index.',
    'Updating_database' =&gt; 'Updating the Database',
    'Installation_complete' =&gt; 'Installation Complete',
    'Delete_this_file'  =&gt; 'Please, be sure to delete your install directory and this file from your phpBB installation now.',
    'Successful'        =&gt; 'Successful'
);

//
// Session Management.
//
$userdata = session_pagestart($user_ip, PAGE_INDEX);
init_userprefs($userdata);

//
// Only administrators here, please
//
if( !$userdata['session_logged_in'] )
{
    redirect(append_sid("login.$phpEx?redirect=".basename(__FILE__), true));
}
if( $userdata['user_level'] != ADMIN )
{
    if ( @file_exists($phpbb_root_path . 'language/lang_' . $board_config['default_lang'] . '/lang_admin.' . $phpEx) )
    {
        include($phpbb_root_path . 'language/lang_' . $board_config['default_lang'] . '/lang_admin.' . $phpEx);
    }
    else
    {
        include($phpbb_root_path . 'language/lang_english/lang_admin.' . $phpEx);
    }
    message_die(GENERAL_MESSAGE, $lang['Not_admin']);
}

//
// Build Array of SQL Statements.
//
$sql = array();

$sql[] = 'DROP TABLE IF EXISTS ' . $table_prefix . 'contact_config';
<a name="diff" id="c0"><span class="HDAdded">$sql[] = 'DROP TABLE IF EXISTS ' . $table_prefix . 'contact_emails';
</span></a>$sql[] = 'DROP TABLE IF EXISTS ' . $table_prefix . 'contact';

$sql[] = 'CREATE TABLE ' . $table_prefix . 'contact (
    ip_address CHAR(8) NOT NULL DEFAULT \'\',
    send_time INTEGER(11) NOT NULL DEFAULT \'0\',
    KEY ip_address (ip_address) )';

$sql[] = 'CREATE TABLE ' . $table_prefix . 'contact_config (
    config_name VARCHAR(255) NOT NULL DEFAULT \'\',
    config_value VARCHAR(255) NOT NULL DEFAULT \'\',
    PRIMARY KEY (config_name) )';

<a name="diff" id="c1"><span class="HDAdded">$sql[] = 'CREATE TABLE ' . $table_prefix . 'contact_emails (
    email VARCHAR(50) NOT NULL DEFAULT\'\',
    sent INT(1) NOT NULL DEFAULT \'0\',
    lasttime INTEGER(11) NOT NULL DEFAULT \'0\',
    PRIMARY KEY (email) )';

</span></a>$sql[] = 'CREATE TABLE ' . $table_prefix . 'contact_msgs (
    msg_id INT(3) UNSIGNED NOT NULL AUTO_INCREMENT,
    sendtime INT(11) NOT NULL DEFAULT \'0\',
    username VARCHAR(25) NOT NULL DEFAULT \'\',
    realname VARCHAR(30) NOT NULL DEFAULT \'\',
    email VARCHAR(50) NOT NULL DEFAULT \'\',
    ip CHAR(8) NOT NULL DEFAULT \'\',
    message TEXT NOT NULL,
    <a name="diff" id="c2"><span class="HDAdded">up</span></a>file VARCHAR(255) NOT NULL DEFAULT \'\',
    PRIMARY KEY (msg_id) )';

$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_version\',\'<a name="diff" id="c3"><span class="HDDeleted">8.9.7</span></a><span class="HDAdded">9.0.0</span>\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_admin_email\',\'\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_form_enable\',\'1\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_require_rname\',\'0\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_require_email\',\'1\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_require_comments\',\'1\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_permit_attachments\',\'0\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_max_file_size\',\'128\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_file_root\',\'efiles\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_flood_limit\',\'8\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_char_limit\',\'255\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_prune\',\'1\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_hash\',\'1\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_auth_guest\',\'0\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_auth_user\',\'1\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_auth_mod\',\'1\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_auth_admin\',\'1\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_captcha\',\'1\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_captcha_type\',\'0\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_delete\',\'1\')';
$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_storage\',\'1\')';
<a name="diff" id="c4"><span class="HDAdded">$sql[] = 'INSERT INTO ' . $table_prefix . 'contact_config VALUES(\'contact_thankyou\',\'1\')';
</span></a>
$sql_count = count($sql);

//
// Output confirmation page?
//
$cancel = isset($HTTP_POST_VARS['cancel']) ? true : false;
$confirm = isset($HTTP_POST_VARS['confirm']) ? true : false;
$mode = isset($HTTP_POST_VARS['mode']) ? trim(htmlspecialchars($HTTP_POST_VARS['mode'])) : '';

if( $cancel )
{
    redirect(append_sid("index.$phpEx", true));
}

if( !$confirm || $mode != 'db_update' )
{
    include($phpbb_root_path . 'includes/page_header.'.$phpEx);

    $template-&gt;set_filenames(array(
        'confirm_body' =&gt; 'confirm_body.tpl')
    );

    $message = sprintf($lang['Update_confirm'], implode(";\n\n", $sql));

    $s_hidden_fields = '&lt;input type="hidden" name="mode" value="db_update" /&gt;';

    $template-&gt;assign_vars(array(
        'L_INDEX'           =&gt; '',
        'MESSAGE_TITLE'     =&gt; $lang['Information'],
        'MESSAGE_TEXT'      =&gt; $message,
        'L_YES'             =&gt; $lang['Yes'],
        'L_NO'              =&gt; $lang['No'],
        'S_CONFIRM_ACTION'  =&gt; append_sid(basename(__FILE__)),
        'S_HIDDEN_FIELDS'   =&gt; $s_hidden_fields)
    );

    $template-&gt;pparse('confirm_body');

    include($phpbb_root_path . 'includes/page_tail.'.$phpEx);
}

//
// Send Page Header.
//
$page_title = $lang['Updating_database'];
include($phpbb_root_path . 'includes/page_header.'.$phpEx);

//
// Execute SQL and get Results.
//
$sql_rows = '';
for( $i = 0; $i &lt; $sql_count; $i++ )
{
    if( !($result = $db-&gt;sql_query($sql[$i])) )
    {
        $error = $db-&gt;sql_error();
        $color = '#FF0000';
        $success = $lang['Error'] . ':';
        $errmsg = ' ' . $error['message'];
    }
    else
    {
        $color = '#00AA00';
        $success = $lang['Successful'];
        $errmsg = '';
    }
    $class = ($i%2) == 0 ? 'row1' : 'row2';
    $sql_rows .= '&lt;tr&gt;&lt;td class="'.$class.'"&gt;&lt;div class="genmed"&gt;' . $sql[$i] . ';&lt;br /&gt;&lt;br /&gt;&lt;b style="color:' . $color . ';"&gt;' . $success . '&lt;/b&gt;' . $errmsg . '&lt;/div&gt;&lt;/td&gt;&lt;/tr&gt;';
}

//
// Build the Report.
//
$click_return_index = sprintf($lang['Click_return_index'], '&lt;a class="genmed" href="' . append_sid($phpbb_root_path . "index.$phpEx") . '"&gt;', '&lt;/a&gt;');

$html = &lt;&lt;&lt;EOT
&lt;table width="100%" cellpadding="0" cellspacing="0" border="0" class="forumline"&gt;
    &lt;tr&gt;
        &lt;th&gt;{$page_title}&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;
            &lt;table cellpadding="8" cellspacing="1" border="0" align="center"&gt;
                {$sql_rows}
            &lt;/table&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td class="row3"&gt;&lt;img src="{$phpbb_root_path}images/spacer.gif" border="0" height="4" alt="" /&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;th&gt;{$lang['Installation_complete']}&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td align="center"&gt;
            &lt;table cellpadding="8" cellspacing="0" border="0" align="center"&gt;
                &lt;tr&gt;
                    &lt;td&gt;
                        &lt;b class="gen" style="color:#EE0000;"&gt;{$lang['Delete_this_file']}&lt;/b&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td class="catBottom" align="center"&gt;
            &lt;span class="genmed"&gt;{$click_return_index}&lt;/span&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;
EOT;
echo $html;

//
// Send Page Footer.
//
include($phpbb_root_path . 'includes/page_tail.'.$phpEx);

?&gt;</span>
</pre>
</body>
<SCRIPT LANGUAGE="JavaScript" TYPE="text/javascript">
<!--
var newWind;
function putJumpCode(){
	var cnt = 5;
	newWind.document.write('<html>\n');
	newWind.document.write('<title>HtmlDiff Navigation</title>\n');
	newWind.document.write('<body>\n');
	newWind.document.write('<form name="jump">\n');
	newWind.document.write('<input type="button" value=" |&lt; " name="First" onclick=goto_first(this.form)>&nbsp;')
	newWind.document.write('<input type="button" value=" &lt; " name="Prev" onclick=goto_prev(this.form)>&nbsp;&nbsp;\n');
	newWind.document.write('<select name=url onchange=menu_goto(this.form)> \n');
	for (var i=0; i<cnt ;i++ ) {
		newWind.document.write('<option value="#c'+i+'">Change #'+(i+1)+ '</option> \n');
		}
	newWind.document.write('');
	newWind.document.write('</select>&nbsp;&nbsp;\n');
	newWind.document.write('<input type="button" value=" &gt; " name="Next"\n');
	newWind.document.write('onclick=goto_next(this.form)>\n');
	newWind.document.write('<input type="button" value=" &gt| " name="Last"\n');
	newWind.document.write('onclick=goto_last(this.form)>\n');
	newWind.document.write('</form>\n');
	newWind.document.write('');
	newWind.document.write('<form method="POST">\n');
	newWind.document.write('<p align="center"><i><font size="3">Generated\n');
	newWind.document.write('by <a href="http://www.ComponentSoftware.com/products/htmldiff" target="_blank">HtmlDiff</a> \n');
	newWind.document.write('</form>\n');
	newWind.document.write('</body>\n');
	newWind.document.write('</html>\n');
	newWind.document.write('<SCRIPT LANGUAGE="JavaScript" TYPE="text/javascript">\n');
	newWind.document.write('<!--\n');
	newWind.document.write('');
	newWind.document.write('var directCloseFlag=1;\n');
	newWind.document.write('');
	newWind.document.write('function menu_goto( menuform )\n');
	newWind.document.write('{\n');
	newWind.document.write('  var baseurl = opener.location.href ;\n');
	newWind.document.write('  var idx = baseurl.indexOf("#");\n');
	newWind.document.write('  if (idx > -1) {\n');
	newWind.document.write('	baseurl = baseurl.slice(0, idx);\n');
	newWind.document.write('  }');
	newWind.document.write('  selecteditem = menuform.url.selectedIndex ;\n');
	newWind.document.write('  newurl = menuform.url.options[ selecteditem ].value ;\n');
	newWind.document.write('  if (newurl.length != 0) {\n');
	newWind.document.write('    	opener.top.location.href = baseurl + newurl ;\n');
	newWind.document.write('  }');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('function goto_prev( menuform )\n');
	newWind.document.write('{\n');
	newWind.document.write('	if(menuform.url.selectedIndex>0) menuform.url.selectedIndex--;\n');
	newWind.document.write('	menu_goto( menuform )\n');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('function goto_first( menuform )\n');
	newWind.document.write('{\n');
	newWind.document.write('	menuform.url.selectedIndex = 0;	\n');
	newWind.document.write('	menu_goto( menuform );\n');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('function goto_last( menuform )\n');
	newWind.document.write('{\n');
	newWind.document.write('	menuform.url.selectedIndex = menuform.url.options.length-1;	\n');
	newWind.document.write('	menu_goto( menuform );\n');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('function goto_next( menuform )\n');
	newWind.document.write('{\n');
	newWind.document.write('	if(menuform.url.options.length > (menuform.url.selectedIndex+1))\n');
	newWind.document.write('	menuform.url.selectedIndex++;\n');
	newWind.document.write('	menu_goto( menuform )\n');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('function restore()\n');
	newWind.document.write('{\n');
	newWind.document.write('    	focus();\n');
	newWind.document.write('	menu_goto(jump);\n');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('goto_first(jump)\n');
	newWind.document.write('//-->\n');
	newWind.document.write('<');
	newWind.document.write('/SCRIPT>\n');
}
function pop_navigate(){
var isOpen = false
try {
isOpen = (newWind != null) && (!newWind.closed)
} catch (e) {}
  if (!isOpen) {
    newWind =  window.open("" ,"HtmlDiffJumpWindow","width=270,height=40")
    if (newWind.opener == null) { // for Nav 2.0x
      newWind.opener = self // this creates and sets a new prop
    }	putJumpCode();
  
} 
else 
{	newWind.execScript("restore()", "JavaScript");
  }
}
function exit(){
var isOpen = false
try {
isOpen = (newWind != null) && (!newWind.closed)
} catch (e) {}
if (isOpen) {
	newWind.close();
  }
}
//--></SCRIPT></html>
