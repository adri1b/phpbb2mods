<body onunload=exit()><form method="POST">  <p align="center"><i><font size="3">Difference Analysis Generated by   <a href="http://www.ComponentSoftware.com/products/htmldiff" target="_blank">HtmlDiff</a> on  03/07/2007 19:10</font></i>&nbsp;&nbsp;
  <input type="button" value="Navigate Changes" name="Navigate" onclick=pop_navigate()></p></form></body> <p align="left"><font size="4"><b>Base file: C:\Documents and Settings\Ma®©uS\Desktop\v8\Contact Form\root\includes\contact_captcha.php</b></font></p> <p align="left"><font size="4"><b>Modified file: C:\Documents and Settings\Ma®©uS\Desktop\v9\Contact Form\root\includes\contact_captcha.php</b></font></p><html>
<style type="text/css">
<!--
.HDNormal {  color: #000000;background:  #ffffff;text-decoration:none}
.HDDeleted {  color: #ff0000;background:  #ffffff;text-decoration:line-through}
.HDAdded {  color: #000000;background:  #ffff00;text-decoration:none}
-->
</style>
<body>
<pre>
 <span class="HDNormal">
&lt;?php
/***************************************************************************
 *                            contact_captcha.php
 *                            -------------------
 *  Version:    <a name="diff" id="c0"><span class="HDDeleted">8.2</span></a><span class="HDAdded">9.0</span>.0
 *  Begin:      Tuesday, Dec 06, 2006
 *      Copyright:  (C) 2006<a name="diff" id="c1"><span class="HDAdded">-07</span></a>, Marcus
 *  E-mail:     marcus@phobbia.net
 *  $id:        <a name="diff" id="c2"><span class="HDDeleted">00:53 23/04</span></a><span class="HDAdded">21:55 25/06</span>/2007
 *
 ***************************************************************************/

/***************************************************************************
 *
 *   This program is free software; you can redistribute it and/or modify
 *   it under the terms of the GNU General Public License as published by
 *   the Free Software Foundation; either version 2 of the License, or
 *   (at your option) any later version.
 *
 ***************************************************************************/

define('IN_PHPBB', true);

$phpbb_root_path = './../';
require($phpbb_root_path . 'extension.inc');
include($phpbb_root_path . 'common.'.$phpEx);

@session_start();

$contact_config = array();

$sql = "SELECT *
    FROM " . CONTACT_CONFIG_TABLE;

<a name="diff" id="c3"><span class="HDDeleted">    </span></a>if(!($result = $db-&gt;sql_query($sql)))
<span class="HDDeleted">    </span>{
    <span class="HDDeleted">    </span>message_die(CRITICAL_ERROR, <span class="HDDeleted">"</span><span class="HDAdded">'</span>Could not query config information<span class="HDDeleted">", ""</span><span class="HDAdded">', ''</span>, __LINE__, __FILE__, $sql);
<span class="HDDeleted">    </span>}
<span class="HDDeleted">    </span>while ($row = $db-&gt;sql_fetchrow($result))
<span class="HDDeleted">    </span>{
        $contact_config[$row['config_name']] = $row['config_value'];
<a name="diff" id="c4"><span class="HDDeleted">    </span></a>}

//
// Seed the random number generator
// 104729 is the 10000th prime number
//
mt_srand((double)microtime() * 104729);
$random = md5(<a name="diff" id="c5"><span class="HDAdded">mt_</span></a>rand() * microtime());
$digit = rand(1,9);
$random = str_replace(<a name="diff" id="c6"><span class="HDDeleted">'0'</span></a><span class="HDAdded">0</span>, $digit, $random); // Substitute zeros
$length = rand(4,5);
$captcha = substr($random, 0, $length);
unset($random, $digit);

$type = '';

if($contact_config['contact_captcha_type'] == 2)
{
<a name="diff" id="c7"><span class="HDAdded">    if(function_exists('glob'))
    {
</span></a>    $type = rand(0,1);
<a name="diff" id="c8"><span class="HDAdded">    }
    else
    {
        $type = 1; // PHP &lt; 4.3.0
    }
</span></a>}

if($contact_config['contact_captcha_type'] == 0 || $type == 0)
{
    unset($type);

    foreach(glob($phpbb_root_path . 'images/captcha/captcha*.png') as $bgimg);

    if(empty($bgimg))
    {
        $type = 1;
    }
    else
    {
        //
        // Image based CAPTCHA
        //
        $bg = rand(1,5);
        $image = @imagecreatefrompng($phpbb_root_path . 'images/captcha/captcha'.$bg.'.png');
        $txtcol = imagecolorallocate($image, 0, 0, 0);

        display_<a name="diff" id="c9"><span class="HDDeleted">text</span></a><span class="HDAdded">code</span>($captcha);
    }
}

if($contact_config['contact_captcha_type'] == 1 || $type == 1)
{
    unset($type);

    //
    // Coloured CAPTCHA
    //
    $image = imagecreate(80,25);
    $background = imagecolorallocatealpha($image, rand(125,255), rand(125,255), rand(125,255), rand(50,100));
    $linecol = imagecolorallocatealpha($image, rand(50,200), rand(50,200), rand(50,200), rand(20,80));
    $txtcol = imagecolorallocate($image, 0,0,0);
    $blk = imagecolorallocate($image, 0,0,0);

    //
    // Random Lines
    //
    $lines = rand(2,5);

    for($i=1; $i&lt;=$lines; $i++)
    {
        imageline($image, rand(2,78), rand(2,23), rand(78,2), rand(23,2), $linecol);
    }

    //
    // Border Lines
    //
    imageline($image, 0, 0, 79, 0, $blk);
    imageline($image, 0, 0, 0, 24, $blk);
    imageline($image, 79, 24, 0, 24, $blk);
    imageline($image, 79, 24, 79, 0, $blk);

    display_<a name="diff" id="c10"><span class="HDDeleted">text</span></a><span class="HDAdded">code</span>($captcha);
}

function display_<a name="diff" id="c11"><span class="HDDeleted">text</span></a><span class="HDAdded">code</span>($captcha)
{
    global $phpbb_root_path;
    global $txtcol, $image, $length;

    if(function_exists('imagettftext'))
    {
        for($i=1; $i&lt;=$length; $i++)
        {
            //
            // Rotate Characters
            //
            $rotate = rand(1,2);

            if($rotate == 1)
            {
                $angle = rand(0,25);
            }
            else
            {
                $angle = rand(335,360);
            }

            //
            // TTF's Fonts
            //
            $font = rand(1,4);

            switch ($font)
            {
                case 1:
                    imagettftext($image, rand(12,14), $angle, ($i*12), 20, $txtcol, $phpbb_root_path . 'fonts/VillageSquare.ttf', substr($captcha,($i-1),1));
                    break;

                case 2:
                    imagettftext($image, rand(12,14), $angle, ($i*12), 20, $txtcol, $phpbb_root_path . 'fonts/BauerBodoniItalicBT.ttf', substr($captcha,($i-1),1));
                    break;

                case 3:
                    imagettftext($image, rand(12,14), $angle, ($i*12), 20, $txtcol, $phpbb_root_path . 'fonts/WarmMilk.ttf', substr($captcha,($i-1),1));
                    break;

                case 4:
                    imagettftext($image, rand(12,14), $angle, ($i*12), 20, $txtcol, $phpbb_root_path . 'fonts/OregonDry.ttf', substr($captcha,($i-1),1));
                    break;
            }
        }
    }
    else
    {
        //
        // Standard PHP Font
        //
        imagestring($image, rand(4,5), rand(13,18), 4, $captcha, $txtcol);
    }
}

if(@ini_get('register_globals') == '0' || strtolower(@ini_get('register_globals')) == 'off')
{
    $HTTP_SESSION_VARS['randi'] = $captcha;
}
else
{
<a name="diff" id="c12"><span class="HDDeleted">    // Required for max PHP5 compatability
</span></a><span class="HDAdded">    // PHP5
</span>    $_SESSION['randi'] = $captcha;
}

header("Content-type: image/png");
header("Cache-Control: post-check=0, pre-check=0", false);
header("Cache-Control: no-store, no-cache, must-revalidate");
header("Pragma: no-cache");
header("Expires: " . gmdate("D, d M Y H:i:s", time()) . " GMT");
header("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT");

imagepng($image);
imagedestroy($image);

?&gt;</span>
</pre>
</body>
<SCRIPT LANGUAGE="JavaScript" TYPE="text/javascript">
<!--
var newWind;
function putJumpCode(){
	var cnt = 13;
	newWind.document.write('<html>\n');
	newWind.document.write('<title>HtmlDiff Navigation</title>\n');
	newWind.document.write('<body>\n');
	newWind.document.write('<form name="jump">\n');
	newWind.document.write('<input type="button" value=" |&lt; " name="First" onclick=goto_first(this.form)>&nbsp;')
	newWind.document.write('<input type="button" value=" &lt; " name="Prev" onclick=goto_prev(this.form)>&nbsp;&nbsp;\n');
	newWind.document.write('<select name=url onchange=menu_goto(this.form)> \n');
	for (var i=0; i<cnt ;i++ ) {
		newWind.document.write('<option value="#c'+i+'">Change #'+(i+1)+ '</option> \n');
		}
	newWind.document.write('');
	newWind.document.write('</select>&nbsp;&nbsp;\n');
	newWind.document.write('<input type="button" value=" &gt; " name="Next"\n');
	newWind.document.write('onclick=goto_next(this.form)>\n');
	newWind.document.write('<input type="button" value=" &gt| " name="Last"\n');
	newWind.document.write('onclick=goto_last(this.form)>\n');
	newWind.document.write('</form>\n');
	newWind.document.write('');
	newWind.document.write('<form method="POST">\n');
	newWind.document.write('<p align="center"><i><font size="3">Generated\n');
	newWind.document.write('by <a href="http://www.ComponentSoftware.com/products/htmldiff" target="_blank">HtmlDiff</a> \n');
	newWind.document.write('</form>\n');
	newWind.document.write('</body>\n');
	newWind.document.write('</html>\n');
	newWind.document.write('<SCRIPT LANGUAGE="JavaScript" TYPE="text/javascript">\n');
	newWind.document.write('<!--\n');
	newWind.document.write('');
	newWind.document.write('var directCloseFlag=1;\n');
	newWind.document.write('');
	newWind.document.write('function menu_goto( menuform )\n');
	newWind.document.write('{\n');
	newWind.document.write('  var baseurl = opener.location.href ;\n');
	newWind.document.write('  var idx = baseurl.indexOf("#");\n');
	newWind.document.write('  if (idx > -1) {\n');
	newWind.document.write('	baseurl = baseurl.slice(0, idx);\n');
	newWind.document.write('  }');
	newWind.document.write('  selecteditem = menuform.url.selectedIndex ;\n');
	newWind.document.write('  newurl = menuform.url.options[ selecteditem ].value ;\n');
	newWind.document.write('  if (newurl.length != 0) {\n');
	newWind.document.write('    	opener.top.location.href = baseurl + newurl ;\n');
	newWind.document.write('  }');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('function goto_prev( menuform )\n');
	newWind.document.write('{\n');
	newWind.document.write('	if(menuform.url.selectedIndex>0) menuform.url.selectedIndex--;\n');
	newWind.document.write('	menu_goto( menuform )\n');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('function goto_first( menuform )\n');
	newWind.document.write('{\n');
	newWind.document.write('	menuform.url.selectedIndex = 0;	\n');
	newWind.document.write('	menu_goto( menuform );\n');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('function goto_last( menuform )\n');
	newWind.document.write('{\n');
	newWind.document.write('	menuform.url.selectedIndex = menuform.url.options.length-1;	\n');
	newWind.document.write('	menu_goto( menuform );\n');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('function goto_next( menuform )\n');
	newWind.document.write('{\n');
	newWind.document.write('	if(menuform.url.options.length > (menuform.url.selectedIndex+1))\n');
	newWind.document.write('	menuform.url.selectedIndex++;\n');
	newWind.document.write('	menu_goto( menuform )\n');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('function restore()\n');
	newWind.document.write('{\n');
	newWind.document.write('    	focus();\n');
	newWind.document.write('	menu_goto(jump);\n');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('goto_first(jump)\n');
	newWind.document.write('//-->\n');
	newWind.document.write('<');
	newWind.document.write('/SCRIPT>\n');
}
function pop_navigate(){
var isOpen = false
try {
isOpen = (newWind != null) && (!newWind.closed)
} catch (e) {}
  if (!isOpen) {
    newWind =  window.open("" ,"HtmlDiffJumpWindow","width=270,height=40")
    if (newWind.opener == null) { // for Nav 2.0x
      newWind.opener = self // this creates and sets a new prop
    }	putJumpCode();
  
} 
else 
{	newWind.execScript("restore()", "JavaScript");
  }
}
function exit(){
var isOpen = false
try {
isOpen = (newWind != null) && (!newWind.closed)
} catch (e) {}
if (isOpen) {
	newWind.close();
  }
}
//--></SCRIPT></html>
