<body onunload=exit()><form method="POST">  <p align="center"><i><font size="3">Difference Analysis Generated by   <a href="http://www.ComponentSoftware.com/products/htmldiff" target="_blank">HtmlDiff</a> on  03/07/2007 19:10</font></i>&nbsp;&nbsp;
  <input type="button" value="Navigate Changes" name="Navigate" onclick=pop_navigate()></p></form></body> <p align="left"><font size="4"><b>Base file: C:\Documents and Settings\Ma®©uS\Desktop\v8\Contact Form\contrib\addons\Recipient List addon\install.txt</b></font></p> <p align="left"><font size="4"><b>Modified file: C:\Documents and Settings\Ma®©uS\Desktop\v9\Contact Form\contrib\addons\Recipient List addon\install.txt</b></font></p><html>
<style type="text/css">
<!--
.HDNormal {  color: #000000;background:  #ffffff;text-decoration:none}
.HDDeleted {  color: #ff0000;background:  #ffffff;text-decoration:line-through}
.HDAdded {  color: #000000;background:  #ffff00;text-decoration:none}
-->
</style>
<body>
<pre>
 <span class="HDNormal">
############################################################## 
## MOD Title:       Contact Form :: Recipients List Add-on
## MOD Author:          marcus.smith &lt; marcus@phobbia.net &gt; (MarcuS) http://www.phobbia.net/mods
## MOD Description: Adds a dropdown of different Admins/Moderators who can be contacted
## MOD Version:     1.<a name="diff" id="c0"><span class="HDDeleted">1</span></a><span class="HDAdded">2</span>.0
##
## Installation Level:  Easy
##
## Installation Time:   ~5 Minutes
##
## Files To Edit:   contact.php
##          includes/functions_selects.php
##          templates/subSilver/contact_body.tpl
##
## Included Files:  language/lang_english/lang_contacts.php
##
## License: http://opensource.org/licenses/gpl-license.php GNU General Public License v2 
##############################################################
## For security purposes, please check: http://www.phpbb.com/mods/
## for the latest version of this MOD. Although MODs are checked
## before being allowed in the MODs Database there is no guarantee
## that there are no security problems within the MOD. No support
## will be given for MODs not found within the MODs Database which
## can be found at http://www.phpbb.com/mods/
############################################################## 
## Author Notes:
##
##  How to Use this Addon
##  ---------------------
##  Open language/lang_english/lang_contacts.php and locate the Recipients array.
##  Each recipient is structured as follows: $lang['contact_me']['user_id'] = 'Recipient Name/Dept';
##  The first part: ['user_id'] - is sent to the chosen user_id you enter, whilst the second part: 'Recipient Name/Dept'
##  is displayed in the Contact Forms dropdown options list which users see. A user_id can be found by getting
##  the u= value seen in the URL when viewing a users profile.
##
##  If the sender does not choose a recipient from the list it will go to the Site Admin by default.
##
##  One Rule: The same user_id cannot appear more than once in the list!
##
##  Sites with Additional Languages
##  -------------------------------
##  Simply create a duplicate of lang_contacts.php, making sure the user_id is against the correct translation
##  each time in the Recipients array.
##
##  Why did you use 'user_id' instead of e-mails?
##  ---------------------------------------------
##  If we used value="email@yoursite.com" these may be viewed in the HTML source and either abused by
##  people, or found by spam bots harvesting your site.  Instead we use the user_id of the user who will
##  receive the e-mail, and get their e-mail from the database registered to their name.  This does cause
##  a couple of limitations - ie each user_id can be listed once only - but is more secure in the end.
##
############################################################## 
## MOD History:
##
<a name="diff" id="c1"><span class="HDAdded">##  2007-30-05 - Version 1.2.0
##      - Bug fix in install.txt - thanks Wolfgang
##
</span></a>##  2007-22-04 - Version 1.1.0
##      - Updated to match latest code changes (8.9.4)
##
##  2007-03-03 - Version 1.0.0
##      - Recipients List Add-on written for Contact Form
##
############################################################## 
## Before Adding This MOD To Your Forum, You Should Back Up All Files Related To This MOD 
############################################################## 

#
#-----[ DIY INSTRUCTIONS ]-------------------------------------------
#
Make sure the Contact Form mod is installed BEFORE following these instructions.

See Authors Notes for creating your own reasons list or using translations.

#
#-----[ COPY ]------------------------------------------ 
# 
copy root/language/lang_english/lang_contacts.php to language/lang_english/lang_contacts.php

# 
#-----[ OPEN ]------------------------------------------ 
# 
contact.php
#
#-----[ FIND ]------------------------------------------ 
#
include($phpbb_root_path . 'language/lang_' . $board_config['default_lang'] . '/lang_contact.'.$phpEx);
#
#-----[ AFTER, ADD ]------------------------------------
#
include($phpbb_root_path . 'language/lang_' . $board_config['default_lang'] . '/lang_contacts.'.$phpEx);
include($phpbb_root_path . 'includes/functions_selects.'.$phpEx);
#
#-----[ FIND ]------------------------------------------ 
#
$email          = (!isset($HTTP_POST_VARS['email'])) ? '' : stripslashes(trim(htmlspecialchars($HTTP_POST_VARS['email'])));
#
#-----[ AFTER, ADD ]------------------------------------
#
$contacts_list      = (!isset($HTTP_POST_VARS['contacts_list'])) ? '' <a name="diff" id="c2"><span class="HDDeleted">?</span></a><span class="HDAdded">:</span> stripslashes(htmlspecialchars($HTTP_POST_VARS['contacts_list']));
#
#-----[ FIND ]------------------------------------------ 
#

    $sql = "SELECT user_lang
            FROM " . USERS_TABLE . "
            WHERE user_id = 2";
    if(!($result = $db-&gt;sql_query($sql)))
    {
        message_die(CRITICAL_ERROR, "Could not query recipient information", "", __LINE__, __FILE__, $sql);
    }
    $row = $db-&gt;sql_fetchrow($result);

#
#-----[ REPLACE WITH ]------------------------------------
#

#
#-----[ FIND ]------------------------------------------ 
#
    empty($contact_config['contact_admin_email']) ? $emailer-&gt;email_address($board_config['board_email']) : $emailer-&gt;email_address($contact_config['contact_admin_email']);
#
#-----[ REPLACE WITH ]------------------------------------
#
    if($contacts_list == '0')
    {
        empty($contact_config['contact_admin_email']) ? $emailer-&gt;email_address($board_config['board_email']) : $emailer-&gt;email_address($contact_config['contact_admin_email']);
    }
    else
    {
        $sql = "SELECT user_email, user_lang FROM " . USERS_TABLE . "
            WHERE user_id = '$contacts_list'";
        $result = $db-&gt;sql_query($sql);
        if(!$db-&gt;sql_query($sql))
        {
            message_die(GENERAL_ERROR, "Could not query recipient information", "", __LINE__, __FILE__, $sql);
        }
        $row = $db-&gt;sql_fetchrow($result);
        $emailer-&gt;email_address($row['user_email']);
    }
#
#-----[ FIND ]------------------------------------------ 
#
    'L_SUBMIT' =&gt; $lang['Submit'],
    'L_RESET' =&gt; $lang['Reset'],

#
#-----[ AFTER, ADD ]------------------------------------
#
    'L_TO_OPTIONS' =&gt; $lang['Contacts_list'],
    'L_TO_OPTIONS_EXPLAIN' =&gt; $lang['Contacts_explain'],
    'TO_OPTIONS' =&gt; contacts_list($select_name = 'contacts_list'),

#
#-----[ OPEN ]------------------------------------------
#
includes/functions_selects.php
#
#-----[ FIND ]-----------------------------------------
#
?&gt;
#
#-----[ BEFORE, ADD ]------------------------------------
#

//
// Contact Form :: Recipients List Addon
//
function contacts_list($select_name = 'contacts_list')
{
    global $lang;

    $contacts_list = '&lt;select name="' . $select_name . '"&gt;';
    $contacts_list .= '&lt;option value="0" selected="selected"&gt;' . $lang['Contacts_list'] .'&lt;/option&gt;';

    while(list($value, $option) = @each($lang['contact_me']))
    {
        $contacts_list .= '&lt;option value="' . $value . '"&gt;' . $option . '&lt;/option&gt;';
    }
    $contacts_list .= '&lt;/select&gt;';

    return $contacts_list;
}

#
#-----[ OPEN ]------------------------------------------
#
templates/subSilver/contact_body.tpl
#
#-----[ FIND ]------------------------------------------
#
  &lt;tr&gt; 
    &lt;td class="row1"&gt;&lt;span class="gen"&gt;&lt;b&gt;{L_EMAIL}&lt;/b&gt;&lt;/span&gt;&lt;br /&gt;
        &lt;span class="gensmall"&gt;{L_EXPLAIN_EMAIL}&lt;/span&gt;&lt;/td&gt;
    &lt;td class="row2"&gt;&lt;input type="text" name="email" size="30" maxlength="50" /&gt;&lt;/td&gt;
  &lt;/tr&gt;
#
#-----[ AFTER, ADD ]------------------------------------
#
  &lt;tr&gt;
    &lt;td class="row1"&gt;&lt;span class="gen"&gt;&lt;b&gt;{L_TO_OPTIONS}&lt;/b&gt;&lt;/span&gt;&lt;br /&gt;
        &lt;span class="gensmall"&gt;{L_TO_OPTIONS_EXPLAIN}&lt;/span&gt;&lt;/td&gt;
    &lt;td class="row2"&gt;{TO_OPTIONS}&lt;/td&gt;
  &lt;/tr&gt;
#
#-----[ SAVE/CLOSE ALL FILES ]--------------------------
#
# EoM</span>
</pre>
</body>
<SCRIPT LANGUAGE="JavaScript" TYPE="text/javascript">
<!--
var newWind;
function putJumpCode(){
	var cnt = 3;
	newWind.document.write('<html>\n');
	newWind.document.write('<title>HtmlDiff Navigation</title>\n');
	newWind.document.write('<body>\n');
	newWind.document.write('<form name="jump">\n');
	newWind.document.write('<input type="button" value=" |&lt; " name="First" onclick=goto_first(this.form)>&nbsp;')
	newWind.document.write('<input type="button" value=" &lt; " name="Prev" onclick=goto_prev(this.form)>&nbsp;&nbsp;\n');
	newWind.document.write('<select name=url onchange=menu_goto(this.form)> \n');
	for (var i=0; i<cnt ;i++ ) {
		newWind.document.write('<option value="#c'+i+'">Change #'+(i+1)+ '</option> \n');
		}
	newWind.document.write('');
	newWind.document.write('</select>&nbsp;&nbsp;\n');
	newWind.document.write('<input type="button" value=" &gt; " name="Next"\n');
	newWind.document.write('onclick=goto_next(this.form)>\n');
	newWind.document.write('<input type="button" value=" &gt| " name="Last"\n');
	newWind.document.write('onclick=goto_last(this.form)>\n');
	newWind.document.write('</form>\n');
	newWind.document.write('');
	newWind.document.write('<form method="POST">\n');
	newWind.document.write('<p align="center"><i><font size="3">Generated\n');
	newWind.document.write('by <a href="http://www.ComponentSoftware.com/products/htmldiff" target="_blank">HtmlDiff</a> \n');
	newWind.document.write('</form>\n');
	newWind.document.write('</body>\n');
	newWind.document.write('</html>\n');
	newWind.document.write('<SCRIPT LANGUAGE="JavaScript" TYPE="text/javascript">\n');
	newWind.document.write('<!--\n');
	newWind.document.write('');
	newWind.document.write('var directCloseFlag=1;\n');
	newWind.document.write('');
	newWind.document.write('function menu_goto( menuform )\n');
	newWind.document.write('{\n');
	newWind.document.write('  var baseurl = opener.location.href ;\n');
	newWind.document.write('  var idx = baseurl.indexOf("#");\n');
	newWind.document.write('  if (idx > -1) {\n');
	newWind.document.write('	baseurl = baseurl.slice(0, idx);\n');
	newWind.document.write('  }');
	newWind.document.write('  selecteditem = menuform.url.selectedIndex ;\n');
	newWind.document.write('  newurl = menuform.url.options[ selecteditem ].value ;\n');
	newWind.document.write('  if (newurl.length != 0) {\n');
	newWind.document.write('    	opener.top.location.href = baseurl + newurl ;\n');
	newWind.document.write('  }');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('function goto_prev( menuform )\n');
	newWind.document.write('{\n');
	newWind.document.write('	if(menuform.url.selectedIndex>0) menuform.url.selectedIndex--;\n');
	newWind.document.write('	menu_goto( menuform )\n');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('function goto_first( menuform )\n');
	newWind.document.write('{\n');
	newWind.document.write('	menuform.url.selectedIndex = 0;	\n');
	newWind.document.write('	menu_goto( menuform );\n');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('function goto_last( menuform )\n');
	newWind.document.write('{\n');
	newWind.document.write('	menuform.url.selectedIndex = menuform.url.options.length-1;	\n');
	newWind.document.write('	menu_goto( menuform );\n');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('function goto_next( menuform )\n');
	newWind.document.write('{\n');
	newWind.document.write('	if(menuform.url.options.length > (menuform.url.selectedIndex+1))\n');
	newWind.document.write('	menuform.url.selectedIndex++;\n');
	newWind.document.write('	menu_goto( menuform )\n');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('function restore()\n');
	newWind.document.write('{\n');
	newWind.document.write('    	focus();\n');
	newWind.document.write('	menu_goto(jump);\n');
	newWind.document.write('}');
	newWind.document.write('');
	newWind.document.write('goto_first(jump)\n');
	newWind.document.write('//-->\n');
	newWind.document.write('<');
	newWind.document.write('/SCRIPT>\n');
}
function pop_navigate(){
var isOpen = false
try {
isOpen = (newWind != null) && (!newWind.closed)
} catch (e) {}
  if (!isOpen) {
    newWind =  window.open("" ,"HtmlDiffJumpWindow","width=270,height=40")
    if (newWind.opener == null) { // for Nav 2.0x
      newWind.opener = self // this creates and sets a new prop
    }	putJumpCode();
  
} 
else 
{	newWind.execScript("restore()", "JavaScript");
  }
}
function exit(){
var isOpen = false
try {
isOpen = (newWind != null) && (!newWind.closed)
} catch (e) {}
if (isOpen) {
	newWind.close();
  }
}
//--></SCRIPT></html>
