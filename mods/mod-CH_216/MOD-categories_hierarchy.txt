##############################################################
## MOD Title:		Categories Hierarchy (sub-forums)
## MOD Author:		Ptirhiik < please_use_the_board@clanmckeen.com > (Pierre) http://ptifo.clanmckeen.com
## MOD Description:	
##		This mod will add sub-forums functionalities (and many more) to your phpBB board.
##		Don't go blindly with easyMOD without having done what is quoted in the Do It Yourself instruction block !
##
## MOD Version:		2.1.6g
##
## Installation Level:	Intermediate
## Installation Time:	3 hours
## Files To Edit:
##			common.php
##			groupcp.php
##			login.php
##			memberlist.php
##			modcp.php
##			posting.php
##			privmsg.php
##
##			admin/admin_disallow.php
##			admin/admin_groups.php
##			admin/admin_mass_email.php
##			admin/admin_ranks.php
##			admin/admin_smilies.php
##			admin/admin_styles.php
##			admin/admin_user_ban.php
##			admin/admin_words.php
##			admin/page_footer_admin.php
##			admin/page_header_admin.php
##			admin/pagestart.php
##
##			db/mssql-odbc.php
##			db/mysql.php
##
##			includes/auth.php
##			includes/bbcode.php
##			includes/db.php
##			includes/emailer.php
##			includes/functions.php
##			includes/functions_post.php
##			includes/functions_search.php
##			includes/functions_selects.php
##			includes/page_header.php
##			includes/page_tail.php
##			includes/usercp_activate.php
##			includes/usercp_avatar.php
##			includes/usercp_email.php
##			includes/usercp_sendpasswd.php
##			includes/usercp_viewprofile.php
##
##			templates/subSilver/bbcode.tpl
##			templates/subSilver/confirm_body.tpl
##			templates/subSilver/groupcp_info_body.tpl
##			templates/subSilver/groupcp_user_body.tpl
##			templates/subSilver/login_body.tpl
##			templates/subSilver/memberlist_body.tpl
##			templates/subSilver/message_body.tpl
##			templates/subSilver/modcp_move.tpl
##			templates/subSilver/modcp_split.tpl
##			templates/subSilver/modcp_viewip.tpl
##			templates/subSilver/overall_footer.tpl
##			templates/subSilver/overall_header.tpl
##			templates/subSilver/posting_smilies.tpl
##			templates/subSilver/posting_topic_review.tpl
##			templates/subSilver/privmsgs_body.tpl
##			templates/subSilver/privmsgs_read_body.tpl
##			templates/subSilver/profile_send_email.tpl
##			templates/subSilver/profile_send_pass.tpl
##			templates/subSilver/profile_view_body.tpl
##			templates/subSilver/search_body.tpl
##			templates/subSilver/search_results_posts.tpl
##			templates/subSilver/search_username.tpl
##			templates/subSilver/simple_footer.tpl
##			templates/subSilver/simple_header.tpl
##			templates/subSilver/subSilver.cfg
##			templates/subSilver/subSilver.css
##			templates/subSilver/viewonline_body.tpl
##			templates/subSilver/viewtopic_poll_ballot.tpl
##			templates/subSilver/viewtopic_poll_result.tpl
##
##			templates/subSilver/admin/disallow_body.tpl
##			templates/subSilver/admin/group_edit_body.tpl
##			templates/subSilver/admin/group_select_body.tpl
##			templates/subSilver/admin/index_body.tpl
##			templates/subSilver/admin/index_navigate.tpl
##			templates/subSilver/admin/page_footer.tpl
##			templates/subSilver/admin/page_header.tpl
##			templates/subSilver/admin/ranks_edit_body.tpl
##			templates/subSilver/admin/ranks_list_body.tpl
##			templates/subSilver/admin/smile_edit_body.tpl
##			templates/subSilver/admin/smile_import_body.tpl
##			templates/subSilver/admin/smile_list_body.tpl
##			templates/subSilver/admin/styles_addnew_body.tpl
##			templates/subSilver/admin/styles_edit_body.tpl
##			templates/subSilver/admin/styles_exporter.tpl
##			templates/subSilver/admin/styles_list_body.tpl
##			templates/subSilver/admin/user_ban_body.tpl
##			templates/subSilver/admin/user_email_body.tpl
##			templates/subSilver/admin/words_edit_body.tpl
##			templates/subSilver/admin/words_list_body.tpl
##
## Included Files:
##			root/*.*
##
## License:		http://opensource.org/licenses/gpl-license.php GNU General Public License v2
##############################################################
## For security purposes, please check: http://www.phpbb.com/mods/
## for the latest version of this MOD. Although MODs are checked
## before being allowed in the MODs Database there is no guarantee
## that there are no security problems within the MOD. No support
## will be given for MODs not found within the MODs Database which
## can be found at http://www.phpbb.com/mods/
##############################################################
## Author Notes:
##	Installation description has been wrote by Malach, thanks to him :).
##
##	This mod only support MySQL, Postgresql, msSQL, odbc-msSQL. msAccess is not supported.
## 
##
##	Complementary notes :
##	-------------------
##	- This mod adds Markus Petrux's Fix message_die for multiple errors MOD (http://www.phpbb.com/phpBB/viewtopic.php?t=233542)
##	- "Today/yesterday at" is based on Netclectic's one (http://www.phpbb.com/phpBB/viewtopic.php?t=158812)
##	- Message Sub-title feature is based on Morpheus2matrix's "Topic description mod" (http://www.phpbb.com/phpBB/viewtopic.php?t=148241)
##		and has been realised by Gilgraf (http://ggweb-fr.com/phpbbfre/)
##	- Last post topic title on index is based on e-Sven idea
##
##############################################################
## MOD History:
##
##
##   ---------------------------------------------------------------
##   2007-10-20 - Version 2.1.6g
##	- changed the first plug-ins entry point in usercp_viewprofile,
##	- fix a html typo in ptifo/overall_header.tpl & subSilver/index_body.tpl,
##
##   2007-10-18 - Version 2.1.6f-pre.2
##	- fix usercp plug-ins not loading when coming from profile.php url,
##
##   2007-10-07 - Version 2.1.6f-pre
##	- fix typos,
##	- increased the number of plug-ins points,
##
##   2007-05-13 - Version 2.1.6e pre-release
##	- introduce the new plug-ins system, more versatile,
##	- introduce XML database schema usage in the installer,
##	- addition of the memory debug information when supported by the system & php version,
##	- slight review of the template parser to reduce memory usage when tpls cache are not activated,
##	- add a global disable email ability (doesn't applied to system & admin emails),
##	- fix the return message when marking all forums (return to index appeared two times),
##	- fix the lost of the checkboxes when editing a pm,
##	- pm author informations are now sent to template the same way than in viewtopic (2.1.6d templates remains compliant),
##	- fix the username search when user have + in his name,
##	- fix in viewprofile the rank image display,
##	- add the check of ttf support for visual confirmation,
##	- fix the forum prune template in acp, so the cp patch export template (js error preventing selection),
##	- enlarged the user time format pref,
##	- continue to fix (x)HTML standard compliance
##
##   2007-01-02 - Version 2.1.6d
##	- review for phpBB 2.0.22
##	- make the sid addition to form from phpBB 2.0.22 optional through a constant
##	- visual confirmation goody is now part of the core code. Reviewed for non-gd users too.
##	- remove of the highlight url parm
##	- limit the number of concurrent searches on keywords
##	- limit the number of concurrent guests posting
##	- php randomizer reseted only once per page
##	- open the possibility to rename posting.php
##	- selection/sort of inactive users on the memberlist page for users administrators
##	- the jumpbox has been redesigned to move the html from the php to the tpl
##
##   2006-11-05 - Version 2.1.6c
##	- fix class_db & class_install
##
##   2006-11-04 - Version 2.1.6b
##   2006-10-31 - Version 2.1.6b pre-release
##	- fixes and optimizations
##
##   2006-06-30 - Version 2.1.6 (final)
##   2006-06-11 - Version 2.1.6 pre-release
##	- backside : numerous improvements including:
##		o lang cache,
##		o template cache built in,
##		o template design possibilities increased (less php qulifications),
##		o full-text index with mySQL for search
##
##	All of this result in a noticeable improvement regarding the page generation time
##
##	- front side :
##		o user profile is now entirely handled in panels,
##		o user administration is done from the user profile, reachable through the memberlist or posts,
##		o user creation "on-the-fly",
##		o bots crawlers are now identified
##
##	- admin side :
##		o registration, posting and visits stats are now included,
##		o the tool to designed panels and patches has been added,
##	... and many other improvement I let you discover :)
##
##   ---------------------------------------------------------------
##   2006-06-08 - Version 2.1.4e
##	- review the files for phpBB 2.0.21
##
##   2006-05-18 - Version 2.1.4d
##	- fix a security issue in class_template.php, align other files,
##	- change the queries used to recompute the users status to enlight them,
##	- fix a bug in search.php preventing the unreaded status to appear in some cases,
##	- fix in the db schema the size of phpbb_forums.forum_style,
##	- install process do no more modify users settings regarding style choice when upgrading.
##		Though, the default style is still set to ptifo, overriding user choices.
##
##   2006-04-09 - Version 2.1.4c
##	- rebuild the installation onto phpBB 2.0.20,
##	- fix some bugs known in phpBB 2.0.20,
##	- fix some bugs known in CH 2.1.4
##
##   2005-11-01 - Version 2.1.4
##	- rebuild the installation onto phpBB 2.0.18,
##	- handle new phpBB 2.0.18 functionalities regarding outdated unreaded topics (reset after two monthes without visits),
##	- fix the overwriting per config settings of users preferences for pack/split root index
##	- fix the announcement duration lost on new topic at first preview or submit,
##	- fix the topics list sorting when author is choosen,
##	- fix a typo in index.php
##
##   2005-10-23 - Version 2.1.2
##	- enhance compliancy with php 5.0.5,
##	- add a security fix regarding cookies,
##	- fix the posting when no post icons are available,
##	- ensure you can't post into a link or a category forum whatever auths are,
##	- remove topic calendar version from config table if topic calendar is no more present,
##	- remove "empty message" in posting when canceling the form,
##	- fix small glitches,
##
##   2005-08-21 - Version 2.1.1 RC 6
##      - rebuild the installation onto phpBB 2.0.17,
##	- continue to clean // in front of deleted/replaced blocks,
##	- ptifo template added, subSilver template reviewed to enhance W3C compliancy,
##	- add the dst management at user level,
##	- rewrite the installer,
##	- optimize the template parser,
##	- optimize the topics list reading
##
##   2005-05-08 - Version 2.1.1 RC 5
##	- rebuild the installation onto phpBB 2.0.15,
##	- add in privmsg.php the send to the template the detailed links and pics,
##	- remove from posting_body.tpl the moderators lines (as they aren't filled),
##	- clean some large replaced blocks from the added // in front of the line,
##	- prevent relog in ACP when .htaccess is present,
##	- fixed a timestamp issue when DST is activated server side
##
##   2005-05-01 - Version 2.1.1 RC 4
##	- enhance the tpls coding (remove subSilver hardcoded things tied in the phps),
##	- add the pagination to topic review area,
##	- add a templates/your_template/your_template.ini read to handle commands specific to a template (ie tpl var assignation)
##
##   2005-04-16 - Version 2.1.1 RC 3
##	- enhance compliancy with postgresql version prior to v8 for the installer,
##	- fix a bug when using eXtreme Style,
##	- adapt includes/sessions.php modifications for phpBB 2.0.14
##
##   2005-04-10 - Version 2.1.1 RC 2
##	- fix memberlist pagination,
##	- fix a message coming when creating a new topic with Topic Calendar CH edition installed,
##	- fix in search the missing pagination,
##	- change the way the posts icons are displayed (move html for pic from php to tpl),
##	- remove default posts icon on replies,
##	- clean html when topics title attribute are used as bubble-info with pic
##
##   2005-04-02 - Version 2.1.1 RC 1
##	- add version check in ACP/Index,
##	- add a warning when a new reply has been made while you were editing/create a new reply to the topic,
##	- add the ability to create topic title tags, with images or not,
##	- topics moved gets their own topic folder icon, copied from the moderation button on viewtopic (templates/subSilver/images/topic_move.gif),
##	- topic icons permissions are now based on a forum auth rather than a user level, allowing so to create specific auth for some (ie for groups),
##	- re-add the unmark topic at bottom of viewtopic (was already at top) when keep unread functionality is activated,
##	- fix the date type fields issue appearing with topic calendar CH edition,
##	- calendar icon changed, calendar folder icons added
##	- the install process now supports postgresql (tested on v8), several scripts upgraded to enhance the compliancy with other databases than mySQL,
##	- guests if authorized will be able to edit only the messages posted with the same ip than the one they are using, no more all guests posts,
##	- "0 posts/topics + no topics" are no more displayed on index when the user can view but not read the forum,
##	- add the <!-- INCLUDE xxx.tpl --> feature to the templates parser,
##	- change the way the data caches files are encoded,
##	- all parent forum auths of the forum manager groups are now reported to the new forum when creating one
##
##   ---------------------------------------------------------------
##   2004-10-10 - Version 2.1.0
##	a complete overall of categories hierarchy, with a lot of new features including :
##	- use of the table forum for categories (categories table is not used anymore),
##	- advanced forums administration, including custom presets for auths,
##	- styles, topic order, and other layout options per forums,
##	- today/yesterday at based on Netclectic's mod,
##	- last post topic title on index based on e-Sven mod,
##	- keep unread topics flag (in cookies or in database),
##	- announces duration,
##	- message icons in front of topic title,
##	- a new more solid cache system, with tweaking tool,
##	- and more ... :)
##
##   ---------------------------------------------------------------
##   2003-12-20 - Version 2.0.5
##      - fix moderators not displayed in forums view
##	- split the cache module to a separate installation to use with other mods
##	- analyse and removal of sql requests usage
##	- reoganize distribution pack
##
##   2003-11-22 - Version 2.0.4
##      - fix topics count and forum link type hit count not displayed when caches used
##	- fix moving cats and forums in forum extend
## 
##   2003-11-13 - Version 2.0.4 - RC 2
##      - add a cache system for tables : categories, forums, themes, and words
##	- fix : standard forums admin : icons not saved
##	- fix : extended forums admin : some forums options were showing in categories if topic display order was installed
##	- fix : extended forums admin : sql generated if no use of real subforums was wrong
## 
##   2003-11-10 - Version 2.0.4-RC
##      - fix topic title viewable in search results
##	- unqualify some path to images in admin context
##	- centralize all admin auth definition in def_auth.php (for further management of presets)
##	- add the forum icon feature
##	- add a more easy-to-use facultative forum administration
##
##   2003-10-21 - Version 2.0.3
##	- upgrade the mods settings tool
##	- add the lang settings tool
##	- add the missing sub-forums links for the forums attached to index
##	- fix the prec/next topic link
##
##   2003-09-24 - Version 2.0.2
##      - fix the missing categories name in admin drop down box,
##	- remove HTML in overviewed forum/cat descriptions,
##	- remove extra line between forum desc, moderators and links on index,
##	- add the $lang['Subforums'] entry to display in front of the mini links on index (default is blank)
## 
##   2003-09-18 - Version 2.0.1
##      - enhance quickness on hughe forums tree
##	- fix spacer issue in admin
##	- clean index_box.tpl from th classes
##	- fix auth_read and auth_view confusion in phpBB
##
##   2003-08-19 - Version 2.0.0
##	- support of multi-language forums and categories name and description
##	- add forum link type feature
##      - add the ability to attach a category to a forum
##	- add the ability (optional) to attach a forum to a forum
##	- add the ability to mix the sort of categories and forums at the same level
##	- add another level of packing the index (full packing)
##	- add the prec extension "last topic title on index" as an option to the base version
##	- add the prec enhancement "links to sub-level on description" as an option to the base version
##	- redesign of the forums and categories reading
##	- add the ability to split categories on index
##	- add the ability to remove within the acp the who's online box at different level
##	- more friendly admin forums and cats administration (ACP)
##	- admin interface for setting the display
##	- users preferences interface with mods settings mod (included in the pack)
##
##   ---------------------------------------------------------------
##   2003-04-09 - Version 1.1.0
##   2003-03-24 - Version 1.0.9
##   2003-03-05 - Version 1.0.8
##   2003-03-01 - Version 1.0.7
##   2003-02-21 - Version 1.0.6
##   2003-02-21 - Version 1.0.5
##   2003-01-15 - Version 1.0.2
##   2003-01-05 - Version 1.0.1
##
##############################################################
## Before Adding This MOD To Your Forum, You Should Back Up All Files Related To This MOD
##############################################################
#
#-----[ DIY INSTRUCTIONS ]------------------------------------
#
# -----------------
# Once the renames done, I strongly advice you to backup the _sav_* files,
# then to remove them from your webspace.
# -----------------
#
RENAME faq.php INTO _sav_faq.php
RENAME index.php INTO _sav_index.php
RENAME profile.php INTO _sav_profile.php
RENAME search.php INTO _sav_search.php
RENAME viewforum.php INTO _sav_viewforum.php
RENAME viewonline.php INTO _sav_viewonline.php
RENAME viewtopic.php INTO _sav_viewtopic.php

RENAME admin/admin_board.php INTO admin/_sav_admin_board.php
RENAME admin/admin_db_utilities.php INTO admin/_sav_admin_db_utilities.php
RENAME admin/admin_forum_prune.php INTO admin/_sav_admin_forum_prune.php
RENAME admin/admin_forumauth.php INTO admin/_sav_admin_forumauth.php
RENAME admin/admin_forums.php INTO admin/_sav_admin_forums.php
RENAME admin/admin_ug_auth.php INTO admin/_sav_admin_ug_auth.php
RENAME admin/admin_users.php INTO admin/_sav_admin_users.php
RENAME admin/index.php INTO admin/_sav_index.php

RENAME includes/functions_admin.php INTO includes/_sav_functions_admin.php
RENAME includes/prune.php INTO includes/_sav_prune.php
RENAME includes/sessions.php INTO includes/_sav_sessions.php
RENAME includes/template.php INTO includes/_sav_template.php
RENAME includes/topic_review.php INTO includes/_sav_topic_review.php
RENAME includes/usercp_confirm.php INTO includes/_sav_usercp_confirm.php
RENAME includes/usercp_register.php INTO includes/_sav_usercp_register.php

RENAME templates/subSilver/agreement.tpl INTO templates/subSilver/_sav_agreement.tpl
RENAME templates/subSilver/faq_body.tpl INTO templates/subSilver/_sav_faq_body.tpl
RENAME templates/subSilver/index_body.tpl INTO templates/subSilver/_sav_index_body.tpl
RENAME templates/subSilver/jumpbox.tpl INTO templates/subSilver/_sav_jumpbox.tpl
RENAME templates/subSilver/modcp_body.tpl INTO templates/subSilver/_sav_modcp_body.tpl
RENAME templates/subSilver/posting_body.tpl INTO templates/subSilver/_sav_posting_body.tpl
RENAME templates/subSilver/posting_preview.tpl INTO templates/subSilver/_sav_posting_preview.tpl
RENAME templates/subSilver/privmsgs_preview.tpl INTO templates/subSilver/_sav_privmsgs_preview.tpl
RENAME templates/subSilver/profile_add_body.tpl INTO templates/subSilver/_sav_profile_add_body.tpl
RENAME templates/subSilver/profile_avatar_gallery.tpl INTO templates/subSilver/_sav_profile_avatar_gallery.tpl
RENAME templates/subSilver/search_results_topics.tpl INTO templates/subSilver/_sav_search_results_topics.tpl
RENAME templates/subSilver/viewforum_body.tpl INTO templates/subSilver/_sav_viewforum_body.tpl
RENAME templates/subSilver/viewtopic_body.tpl INTO templates/subSilver/_sav_viewtopic_body.tpl

RENAME templates/subSilver/admin/auth_forum_body.tpl INTO templates/subSilver/admin/_sav_auth_forum_body.tpl
RENAME templates/subSilver/admin/auth_select_body.tpl INTO templates/subSilver/admin/_sav_auth_select_body.tpl
RENAME templates/subSilver/admin/auth_ug_body.tpl INTO templates/subSilver/admin/_sav_auth_ug_body.tpl
RENAME templates/subSilver/admin/board_config_body.tpl INTO templates/subSilver/admin/_sav_board_config_body.tpl
RENAME templates/subSilver/admin/category_edit_body.tpl INTO templates/subSilver/admin/_sav_category_edit_body.tpl
RENAME templates/subSilver/admin/db_utils_backup_body.tpl INTO templates/subSilver/admin/_sav_db_utils_backup_body.tpl
RENAME templates/subSilver/admin/db_utils_restore_body.tpl INTO templates/subSilver/admin/_sav_db_utils_restore_body.tpl
RENAME templates/subSilver/admin/forum_admin_body.tpl INTO templates/subSilver/admin/_sav_forum_admin_body.tpl
RENAME templates/subSilver/admin/forum_delete_body.tpl INTO templates/subSilver/admin/_sav_forum_delete_body.tpl
RENAME templates/subSilver/admin/forum_edit_body.tpl INTO templates/subSilver/admin/_sav_forum_edit_body.tpl
RENAME templates/subSilver/admin/forum_prune_body.tpl INTO templates/subSilver/admin/_sav_forum_prune_body.tpl
RENAME templates/subSilver/admin/forum_prune_result_body.tpl INTO templates/subSilver/admin/_sav_forum_prune_result_body.tpl
RENAME templates/subSilver/admin/forum_prune_select_body.tpl INTO templates/subSilver/admin/_sav_forum_prune_select_body.tpl
RENAME templates/subSilver/admin/user_avatar_gallery.tpl INTO templates/subSilver/admin/_sav_user_avatar_gallery.tpl
RENAME templates/subSilver/admin/user_edit_body.tpl INTO templates/subSilver/admin/_sav_user_edit_body.tpl
RENAME templates/subSilver/admin/user_select_body.tpl INTO templates/subSilver/admin/_sav_user_select_body.tpl
#
#-----[ COPY ]------------------------------------------------
#
COPY root/*.* TO *.*
#
#-----[ OPEN ]------------------------------------------------
#
common.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
if ( !defined('IN_PHPBB') )
{
	die("Hacking attempt");
}
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
// minimal requirement: php 4.0.6
if ( !function_exists('debug_backtrace') )
{
	// php 4.3.0
	function debug_backtrace()
	{
		return false;
	}
}

function _backtrace($comment='', $return=false)
{
	static $trc_pgm, $trc_memory;

	$now = microtime();
	if ( !$trc_memory )
	{
		$trc_memory = function_exists('memory_get_usage') ? memory_get_usage() : -1;
	}
	if ( !$trc_pgm )
	{
		$trc_pgm = array(array('time' => $now, 'after_debug' => microtime(), 'mem' => $trc_memory > 1 ? memory_get_usage() : 0));
		return;
	}
	if ( $return )
	{
		return array($trc_pgm, $trc_memory);
	}
	if ( ($dbg = debug_backtrace()) && ($count_dbg = count($dbg)) )
	{
		$trace = array();
		for ( $i = 0; $i < $count_dbg; $i++ )
		{
			$trace[] = array('file' => basename($dbg[$i]['file']), 'line' => $dbg[$i]['line']);
		}
		$trc_pgm[] = array('comment' => $comment, 'time' => $now, 'after_debug' => microtime(), 'trace' => $trace, 'mem' => $trc_memory > 1 ? memory_get_usage() : 0);
		unset($trace);
	}
	unset($dbg);
}
_backtrace();
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
	$not_unset = array('HTTP_GET_VARS', 'HTTP_POST_VARS',
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	$not_unset[] = 'requester';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
include($phpbb_root_path . 'config.'.$phpEx);

if( !defined("PHPBB_INSTALLED") )
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
	message_die(GENERAL_MESSAGE, 'Board_disable', 'Information');
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
// error_reporting(E_ALL);

// get the database settings
$dbms = $dbhost = $dbname = $dbuser = $dbpasswd = $table_prefix = false;
include($phpbb_root_path . 'config.' . $phpEx);
if ( !defined('PHPBB_INSTALLED') )
{
	header('Location: ' . $phpbb_root_path . 'install/install.' . $phpEx);
	exit;
}

include($phpbb_root_path . 'includes/constants.' . $phpEx);
include($phpbb_root_path . 'includes/class_template.' . $phpEx);
include($phpbb_root_path . 'includes/auth.' . $phpEx);
include($phpbb_root_path . 'includes/functions.' . $phpEx);

include($phpbb_root_path . 'includes/CH_functions.' . $phpEx);
include($phpbb_root_path . 'includes/db.' . $phpEx);
include($phpbb_root_path . 'includes/class_config.' . $phpEx);

$client_ip = !empty($HTTP_SERVER_VARS['REMOTE_ADDR']) ? $HTTP_SERVER_VARS['REMOTE_ADDR'] : (!empty($HTTP_ENV_VARS['REMOTE_ADDR']) ? $HTTP_ENV_VARS['REMOTE_ADDR'] : getenv('REMOTE_ADDR'));
$user_ip = encode_ip($client_ip);

if ( file_exists('install') || file_exists('contrib') )
{
	message_die(GENERAL_MESSAGE, 'Please_remove_install_contrib');
}

// Show 'Board is disabled' message if needed.
if ( $config->data['board_disable'] && !defined('IN_ADMIN') && !defined('IN_LOGIN') && !defined('IN_INSTALL') )
{
	message_die(GENERAL_MESSAGE, 'Board_disable', 'Information');
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
groupcp.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
include($phpbb_root_path . 'extension.inc');
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$phpEx = substr(strrchr(__FILE__, '.'), 1);
$requester = 'groupcp';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	if ( !empty($row['user_viewemail']) || $group_mod )
	{
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	if ( (!empty($row['user_viewemail']) && empty($config->data['email_disable'])) || $group_mod )
	{
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
// Start session management
//
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
$user->use_lang(array('groupcp', 'viewprofile'));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
// End session management
//
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
$navigation = new navigation();
$navigation->add('Usergroups', '', 'groupcp', '', '');
$navigation->display();

// no access for bots
if ( $user->data['session_is_bot'] )
{
	message_return('Not_Authorised');
}

// read forums and auths for the jumpbox
include($config->url('includes/class_forums'));
$forums = new forums();
$forums->read();
$user->get_cache(array(POST_GROUPS_URL, POST_FORUM_URL, POST_FORUM_URL . 'jbox'));
$user_groups_list = $user->get_groups_list();

// auth
$auth_manage = false;
$auth_membership = false;

// level
$is_founder = $user->data['session_logged_in'] && in_array(GROUP_FOUNDER, $user_groups_list);
$is_admin = $user->data['session_logged_in'] && in_array(GROUP_ADMIN, $user_groups_list);
$is_owner = false;

// read group
$group_id = _read(POST_GROUPS_URL, TYPE_INT);

// get the appropriate group id
if ( _button('group_member') )
{
	$group_id = _read(POST_GROUPS_URL . '_member', TYPE_INT, $group_id);
}
if ( _button('group_pending') )
{
	$group_id = _read(POST_GROUPS_URL . '_pending', TYPE_INT, $group_id);
}
if ( _button('group_remaining') )
{
	$group_id = _read(POST_GROUPS_URL . '_remaining', TYPE_INT, $group_id);
}

if ( $group_id == GROUP_REGISTERED )
{
	message_return('Not_Authorised');
}
$group_status = GROUP_STANDARD;
$group_row = array();
if ( !empty($group_id) )
{
	$sql = 'SELECT *
				FROM ' . GROUPS_TABLE . '
				WHERE group_id = ' . intval($group_id) . '
					AND group_single_user <> ' . true;
	$result = $db->sql_query($sql, false, __LINE__, __FILE__);
	if ( $group_row = $db->sql_fetchrow($result) )
	{
		$group_status = intval($group_row['group_status']);
		$group_row['group_name'] = ($group_status >= GROUP_SYSTEM) ? $user->lang($group_row['group_name']) : $group_row['group_name'];
		$group_row['group_description'] = ($group_status >= GROUP_SYSTEM) ? $user->lang($group_row['group_description']) : $group_row['group_description'];
		$is_owner = $user->data['session_logged_in'] && (intval($group_row['group_moderator']) == $user->data['user_id']);
	}
	$db->sql_freeresult($result);
}
switch ( $group_id )
{
	case GROUP_FOUNDER:
		$auth_manage = $is_owner;
		$auth_membership = $is_owner;
		break;
	case GROUP_ADMIN:
		$auth_manage = $is_founder;
		$auth_membership = $is_owner || $is_founder;
		break;
	default:
		$auth_manage = $is_owner || $is_founder || $is_admin;
		$auth_membership = $is_owner || $is_founder || $is_admin;
		break;
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
if ( isset($HTTP_GET_VARS[POST_GROUPS_URL]) || isset($HTTP_POST_VARS[POST_GROUPS_URL]) )
{
	$group_id = ( isset($HTTP_POST_VARS[POST_GROUPS_URL]) ) ? intval($HTTP_POST_VARS[POST_GROUPS_URL]) : intval($HTTP_GET_VARS[POST_GROUPS_URL]);
}
else
{
	$group_id = '';
}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	$sql = "SELECT group_moderator 
		FROM " . GROUPS_TABLE . "  
		WHERE group_id = $group_id";
	if ( !($result = $db->sql_query($sql)) )
	{
		message_die(GENERAL_ERROR, 'Could not obtain user and group information', '', __LINE__, __FILE__, $sql);
	}

	$row = $db->sql_fetchrow($result);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	// get the group
	$row = $group_row;
	$group_type = _read('group_type', TYPE_INT);
	if ( !$auth_membership )
	{
		_error('Not_group_moderator');
	}
	else if ( ($group_status >= GROUP_SYSTEM) && ($group_type < GROUP_CLOSED) )
	{
		_error('Change_sysgroup_type_denied');
	}
	else if ( ($group_type != $row['group_type']) && !$auth_manage )
	{
		_error('Manage_group_denied');
	}
	if ( $error )
	{
		$l_link = 'Click_return_group';
		$u_link = $config->url('groupcp', array(POST_GROUPS_URL => intval($group_id)), true);
		message_return($error_msg, $l_link, $u_link);
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	include($phpbb_root_path . 'includes/emailer.'.$phpEx);
	$emailer = new emailer($board_config['smtp_delivery']);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	if ( $moderator )
	{
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	$emailer->send();
	$emailer->reset();
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		if ( $userdata['user_level'] != ADMIN && $userdata['user_level'] == MOD )
		{
			$sql = "SELECT COUNT(auth_mod) AS is_auth_mod
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search : the full line is longer
#
		$message = $lang['Unsub_success'] . '<br />

		message_die(GENERAL_MESSAGE, $message);
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		// recache users
		$sql = 'DELETE FROM ' . USERS_CACHE_TABLE . '
					WHERE user_id = ' . $userdata['user_id'];
		$db->sql_query($sql, false, __LINE__, __FILE__);

		// remove group style if matching
		if ( intval($group_row['group_style']) )
		{
			$sql = 'UPDATE ' . GROUPS_TABLE . '
						SET group_style = 0
						WHERE group_id = ' . intval($user->data['group_id']) . '
							AND group_style = ' . intval($group_row['group_style']);
			$db->sql_query($sql, false, __LINE__, __FILE__);
		}

		// set users mod status
		$moderators = new moderators();
		$moderators->set_users_status();
		unset($moderators);

		// send achievement message
		message_return('Unsub_success', 'Click_return_group', $config->url('groupcp', array(POST_GROUPS_URL => intval($group_id)), true));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	switch(SQL_LAYER)
	{
		case 'postgresql':
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
		if ( $group_moderator == $userdata['user_id'] || $userdata['user_level'] == ADMIN )
		{
			$is_moderator = TRUE;
		}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	if ( empty($group_row) )
	{
		message_return('No_such_group');
	}
	if ( $group_info = $group_row )
	{
		// reminder : use later gcp_manage auth
		$is_moderator = $auth_membership;
		$group_moderator = intval($group_info['group_moderator']);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
					if ( $row['user_level'] != ADMIN && $row['user_level'] != MOD && $group_info['auth_mod'] )
					{
						$sql = "UPDATE " . USERS_TABLE . " 
							SET user_level = " . MOD . " 
							WHERE user_id = " . $row['user_id'];
						if ( !$db->sql_query($sql) )
						{
							message_die(GENERAL_ERROR, 'Could not update user level', '', __LINE__, __FILE__, $sql);
						}
					}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
					// recache user
					$sql = 'DELETE FROM ' . USERS_CACHE_TABLE . '
								WHERE user_id = ' . intval($row['user_id']);
					$db->sql_query($sql, false, __LINE__, __FILE__);

					// add style
					if ( intval($group_row['group_style']) )
					{
						$sql = 'UPDATE ' . GROUPS_TABLE . '
									SET group_style = ' . intval($group_row['group_style']) . '
									WHERE group_user_id = ' . intval($row['user_id']) . '
										AND group_style = 0';
						$db->sql_query($sql, false, __LINE__, __FILE__);
					}

					// set users mod status
					$moderators = new moderators();
					$moderators->set_users_status();
					unset($moderators);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
					$group_sql = "SELECT group_name 
						FROM " . GROUPS_TABLE . " 
						WHERE group_id = $group_id";
					if ( !($result = $db->sql_query($group_sql)) )
					{
						message_die(GENERAL_ERROR, 'Could not get group information', '', __LINE__, __FILE__, $group_sql);
					}

					$group_name_row = $db->sql_fetchrow($result);

					$group_name = $group_name_row['group_name'];
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
					$group_name = $group_row['group_name'];
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
						if ( $group_info['auth_mod'] )
						{
							$sql = "UPDATE " . USERS_TABLE . " 
								SET user_level = " . MOD . " 
								WHERE user_id IN ($sql_in) 
									AND user_level NOT IN (" . MOD . ", " . ADMIN . ")";
							if ( !$db->sql_query($sql) )
							{
								message_die(GENERAL_ERROR, 'Could not update user level', '', __LINE__, __FILE__, $sql);
							}
						}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
						if ( $group_info['auth_mod'] )
						{
							$sql = "SELECT ug.user_id, ug.group_id 
								FROM " . AUTH_ACCESS_TABLE . " aa, " . USER_GROUP_TABLE . " ug
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
								if ( $remove_mod_sql != '' )
								{
									$sql = "UPDATE " . USERS_TABLE . " 
										SET user_level = " . USER . " 
										WHERE user_id IN ($remove_mod_sql) 
											AND user_level NOT IN (" . ADMIN . ")";
									if ( !$db->sql_query($sql) )
									{
										message_die(GENERAL_ERROR, 'Could not update user level', '', __LINE__, __FILE__, $sql);
									}
								}
							}
						}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
					if ( !$db->sql_query($sql) )
					{
						message_die(GENERAL_ERROR, 'Could not update user group table', '', __LINE__, __FILE__, $sql);
					}
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
					// recache users
					$sql = 'DELETE FROM ' . USERS_CACHE_TABLE . '
								WHERE user_id IN(' . $sql_in . ')';
					$db->sql_query($sql, false, __LINE__, __FILE__);

					// set group style
					if ( intval($group_row['group_style']) )
					{
						// set style
						if ( isset($HTTP_POST_VARS['approve']) )
						{
							$sql = 'UPDATE ' . GROUPS_TABLE . '
										SET group_style = ' . intval($group_row['group_style']) . '
										WHERE group_style = 0
											AND group_user_id IN(' . $sql_in . ')';
							$db->sql_query($sql, false, __LINE__, __FILE__);
						}
						// remove style
						else if ( isset($HTTP_POST_VARS['remove']) )
						{
							$sql = 'UPDATE ' . GROUPS_TABLE . '
										SET group_style = 0
										WHERE group_style = ' . intval($group_row['group_style']) . '
											AND group_user_id IN(' . $sql_in . ')';
							$db->sql_query($sql, false, __LINE__, __FILE__);
						}
					}

					// set users mod status
					$moderators = new moderators();
					$moderators->set_users_status();
					unset($moderators);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
						$group_sql = "SELECT group_name 
							FROM " . GROUPS_TABLE . " 
							WHERE group_id = $group_id";
						if ( !($result = $db->sql_query($group_sql)) )
						{
							message_die(GENERAL_ERROR, 'Could not get group information', '', __LINE__, __FILE__, $group_sql);
						}

						$group_name_row = $db->sql_fetchrow($result);
						$group_name = $group_name_row['group_name'];
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
						$group_name = $group_row['group_name'];
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	$sql = "SELECT *
		FROM " . GROUPS_TABLE . "
		WHERE group_id = $group_id
			AND group_single_user = 0";
	if ( !($result = $db->sql_query($sql)) )
	{
		message_die(GENERAL_ERROR, 'Error getting group information', '', __LINE__, __FILE__, $sql);
	}

	if ( !($group_info = $db->sql_fetchrow($result)) )
	{
		message_die(GENERAL_MESSAGE, $lang['Group_not_exist']); 
	}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	if ( !($group_info = $group_row) )
	{
		message_return('Group_not_exist');
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	// Get moderator details for this group
	//
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	if ( intval($group_info['group_moderator']) )
	{
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		message_die(GENERAL_ERROR, 'Error getting user list for group', '', __LINE__, __FILE__, $sql);
	}

	$group_moderator = $db->sql_fetchrow($result); 
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	}
	else
	{
		$group_moderator = array('user_id' => 0);
	}
	$template->set_switch('moderator', intval($group_moderator['user_id']));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	if ( $userdata['user_level'] == ADMIN )
	{
		$is_moderator = TRUE;
	}
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	$is_moderator = $auth_membership;
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	make_jumpbox('viewforum.'.$phpEx);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			if ( $is_moderator )
			{
				$template->assign_block_vars('member_row.switch_mod_option', array());
			}
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			$template->set_switch('member_row.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	$template->assign_vars(array(
		'PAGINATION' => generate_pagination("groupcp.$phpEx?" . POST_GROUPS_URL . "=$group_id", $members_count, $board_config['topics_per_page'], $start),
		'PAGE_NUMBER' => sprintf($lang['Page_of'], ( floor( $start / $board_config['topics_per_page'] ) + 1 ), $current_page ), 

		'L_GOTO_PAGE' => $lang['Goto_page'])
	);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	$pagination = new pagination('groupcp', array(POST_GROUPS_URL => $group_id));
	$pagination->display('pagination', $members_count, intval($config->data['topics_per_page']), $start, true, 'Users_count');
	unset($pagination);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
					'U_VIEWPROFILE' => append_sid("profile.$phpEx?mode=viewprofile&amp;" . POST_USERS_URL . "=$user_id"))
				);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				$template->set_switch('pending_members_row.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$sql = "SELECT g.group_id, g.group_name, g.group_type, ug.user_pending 
			FROM " . GROUPS_TABLE . " g, " . USER_GROUP_TABLE . " ug
			WHERE ug.user_id = " . $userdata['user_id'] . "  
				AND ug.group_id = g.group_id
				AND g.group_single_user <> " . TRUE . "
			ORDER BY g.group_name, ug.user_id";
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$sql = str_replace('SELECT g.group_id, ', 'SELECT g.group_status, g.group_id, ', $sql);
		$sql = str_replace('WHERE ', 'WHERE g.group_id <> ' . intval($config->data['group_registered']) . ' AND ', $sql);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
				$in_group[] = $row['group_id'];
				if ( $row['user_pending'] )
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				if ( $row['group_status'] == GROUP_SYSTEM )
				{
					$row['group_name'] = $user->lang($row['group_name']);
				}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			$s_pending_groups = '<select name="' . POST_GROUPS_URL . '">' . $s_pending_groups_opt . "</select>";
			$s_member_groups = '<select name="' . POST_GROUPS_URL . '">' . $s_member_groups_opt . "</select>";
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
			$s_pending_groups = '<select name="' . POST_GROUPS_URL . '_pending">' . $s_pending_groups_opt . "</select>";
			$s_member_groups = '<select name="' . POST_GROUPS_URL . '_member">' . $s_member_groups_opt . "</select>";
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	$sql = "SELECT group_id, group_name, group_type 
		FROM " . GROUPS_TABLE . " g 
		WHERE group_single_user <> " . TRUE . " 
			$ignore_group_sql 
		ORDER BY g.group_name";
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	$sql = str_replace('SELECT group_id, ', 'SELECT group_status, group_id, ', $sql);
	$sql = str_replace('WHERE ', 'WHERE g.group_id <> ' . intval($config->data['group_registered']) . ' AND g.group_status < ' . GROUP_SPECIAL . ' AND ', $sql);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		if  ( $row['group_type'] != GROUP_HIDDEN || $userdata['user_level'] == ADMIN )
		{
			$s_group_list_opt .='<option value="' . $row['group_id'] . '">' . $row['group_name'] . '</option>';
		}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		if ( $row['group_status'] == GROUP_SYSTEM )
		{
			$row['group_name'] = $user->lang($row['group_name']);
		}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	$s_group_list = '<select name="' . POST_GROUPS_URL . '">' . $s_group_list_opt . '</select>';
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	$s_group_list = '<select name="' . POST_GROUPS_URL . '_remaining">' . $s_group_list_opt . '</select>';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		make_jumpbox('viewforum.'.$phpEx);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
login.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
include($phpbb_root_path . 'extension.inc');
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$phpEx = substr(strrchr(__FILE__, '.'), 1);
$requester = 'login';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
// Set page ID for session management
//
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
$user->use_lang('login');
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
// End session management
//
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
$navigation = new navigation();
$navigation->add('Login', '', 'login', '', '');
$navigation->display();

// no access for bots
if ( $user->data['session_is_bot'] )
{
	message_return('Not_Authorised');
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
memberlist.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
include($phpbb_root_path . 'extension.inc');
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$phpEx = substr(strrchr(__FILE__, '.'), 1);
$requester = 'memberlist';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
// Start session management
//
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
$user->use_lang(array('memberlist', 'viewprofile'));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$mode_types = array('joined', 'username', 'location', 'posts', 'email', 'website', 'topten');
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
$user->get_cache(POST_GROUPS_URL);
$is_user_admin = $user->auth(POST_GROUPS_URL, 'ucp_edit_admin', GROUP_REGISTERED);

// plugs
if ( $config->plug_ins[$requester] )
{
	foreach ( $config->plug_ins[$requester] as $plug => $dummy )
	{
		if ( method_exists($config->plug_ins[$requester][$plug], 'start') )
		{
			$config->plug_ins[$requester][$plug]->start();
		}
	}
}

$select_group = _read(POST_GROUPS_URL, TYPE_INT);
if ( $select_group == GROUP_REGISTERED )
{
	$select_group = 0;
}
$select_level = _read('level', TYPE_INT);
$dft_order = 'asc';
$dft_sort = 'joined';
$parms = array(
	POST_GROUPS_URL => intval($select_group),
	'level' => intval($select_level), 
	'order' => strtolower(_read('order', TYPE_NO_HTML, $dft_order, array_flip(array('ASC', 'DESC', 'asc', 'desc')))),
	'mode' => _read('mode', TYPE_NO_HTML, $dft_sort, array_flip($mode_types)),
	'username' => stripslashes(phpbb_clean_username(addslashes(_read('username')))),
	'inact' => $is_user_admin ? max(0, min(1, _read('inact', TYPE_INT))) : 0,
);
$start = _read('start', TYPE_INT);
$sort_order = strtoupper($parms['order']);
$mode = $parms['mode'];
if ( $parms['order'] == $dft_order )
{
	unset($parms['order']);
}
if ( $parms['mode'] == $dft_sort )
{
	unset($parms['mode']);
}

// search with a username
$username_search = preg_replace('/\*/', '%', $parms['username']);
if ( !empty($username_search) && (str_replace('%', '', $username_search) != '') )
{
	$template->assign_vars(array(
		'USERNAME' => $parms['username'],
	));
}
else if ( isset($parms['username']) )
{
	unset($parms['username']);
}
$template->assign_vars(array(
	'L_SEARCH_USERNAME' => $template->lang('Find_username'),
	'L_SEARCH_EXPLAIN' => $template->lang('Search_author_explain'),
	'L_OPTIONS' => $template->lang('Options'),
	'L_INACTIVE' => $template->lang('Add_inactive_users'),
	'L_YES' => $template->lang('Yes'),
	'L_NO' => $template->lang('No'),
));
$template->set_switch('user_admin', $is_user_admin);
$template->set_switch('user_admin.inact', $parms['inact'], $is_user_admin);
display_buttons(array(
	'submit_form' => array('txt' => 'Submit', 'img' => 'cmd_submit', 'key' => 'cmd_submit'),
));

_hide(array(POST_GROUPS_URL => $parms[POST_GROUPS_URL], 'level' => $parms['level']));
_hide_set();

// no access for bots
if ( $user->data['session_is_bot'] )
{
	// navigation
	$navigation = new navigation();
	$navigation->add('Memberlist', '', 'memberlist', '', '');
	$navigation->display();
	message_return('Not_Authorised');
}

// extra selection
$sql_join = '';
$sql_where = empty($select_level) ? '' : 'user_level = ' . intval($select_level) . ' AND ';
if ( !empty($select_group) )
{
	// verify the user is authed to the group
	if ( $user->data['user_level'] != ADMIN )
	{
		$sql = 'SELECT g.group_id, g.group_type, g.group_single_user, ug.user_id
					FROM ' . GROUPS_TABLE . ' g
						LEFT JOIN ' . USER_GROUP_TABLE . ' ug
							ON ug.user_id = ' . intval($user->data['user_id']) . '
								AND ug.group_id = g.group_id
					WHERE g.group_id = ' . intval($select_group) . '
						AND g.group_single_user = 0
					LIMIT 1';
		$result = $db->sql_query($sql, false, __LINE__, __FILE__);
		if ( !($row = $db->sql_fetchrow($result)) || (($row['group_type'] == GROUP_HIDDEN) && empty($row['user_id'])) )
		{
			// navigation
			$navigation = new navigation();
			$navigation->add('Memberlist', '', 'memberlist', '', '');
			$navigation->display();
			message_return('Not_Authorised');
		}
		$db->sql_freeresult($result);
	}

	$sql_join = ', ' . USER_GROUP_TABLE . ' ug';
	$sql_where = 'u.user_id = ug.user_id
					AND ug.user_pending <> 1
					AND ug.group_id = ' . intval($select_group) . '
					AND ';
}
if ( isset($parms['username']) && $parms['username'] )
{
	$sql_where .= 'username LIKE \'' . $db->sql_escape_string($username_search) . '\'
					AND ';
}

// filter inactive users if the user has not the profile administration access
$user->get_cache(POST_GROUPS_URL);
if ( !isset($parms['inact']) || !$parms['inact'] )
{
	$sql_where .= 'user_active = 1
					AND ';
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
make_jumpbox('viewforum.'.$phpEx);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full lines are longer
#
$sql = "SELECT username, user_id,
	FROM " . USERS_TABLE . "
	WHERE user_id <> " . ANONYMOUS . "
	ORDER BY $order_by";
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
$last_active_status = -1;

// plugs
if ( $config->plug_ins[$requester] )
{
	foreach ( $config->plug_ins[$requester] as $plug => $dummy )
	{
		if ( method_exists($config->plug_ins[$requester][$plug], 'format_sql_detail') )
		{
			$config->plug_ins[$requester][$plug]->format_sql_detail($sql);
		}
	}
}

if ( $parms['inact'] )
{
	$sql = str_replace('SELECT ', 'SELECT user_active, ', $sql);
	$sql = str_replace('ORDER BY ', 'ORDER BY user_active, ', $sql);
}
if ( !empty($sql_join) )
{
	$sql = str_replace('username', 'u.username', $sql);
	$sql = str_replace('user_', 'u.user_', $sql);
	$sql = str_replace('FROM ' . USERS_TABLE, 'FROM ' . USERS_TABLE . ' u' . $sql_join, $sql);
}
if ( !empty($sql_where) )
{
	$sql = str_replace('WHERE ', 'WHERE ' . $sql_where, $sql);
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		if ( !empty($row['user_viewemail']) || $userdata['user_level'] == ADMIN )
		{
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		if ( (!empty($row['user_viewemail']) && empty($config->data['email_disable'])) || ($user->data['user_level'] == ADMIN) )
		{
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			'U_VIEWPROFILE' => append_sid("profile.$phpEx?mode=viewprofile&amp;" . POST_USERS_URL . "=$user_id"))
		);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$template->set_switch('memberrow.light', !($i % 2));
		if ( $parms['inact'] && ($last_active_status != $row['user_active']) )
		{
			$template->assign_block_vars('memberrow.active_status', array(
				'L_TITLE' => $row['user_active'] ? $template->lang('Active_users') : $template->lang('Inactive_users'),
			));
			$last_active_status = $row['user_active'];
		}

		// plugs
		if ( $config->plug_ins[$requester] )
		{
			foreach ( $config->plug_ins[$requester] as $plug => $dummy )
			{
				if ( method_exists($config->plug_ins[$requester][$plug], 'display') )
				{
					$config->plug_ins[$requester][$plug]->display($row, 'memberrow');
				}
			}
		}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	while ( $row = $db->sql_fetchrow($result) );
	$db->sql_freeresult($result);
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
else
{
	$navigation = new navigation();
	$navigation->add('Memberlist', '', 'memberlist', '', '');
	$navigation->display();
	message_return('No_match');
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	if ( !($result = $db->sql_query($sql)) )
	{
		message_die(GENERAL_ERROR, 'Error getting total users', '', __LINE__, __FILE__, $sql);
	}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
	'L_GOTO_PAGE' => $lang['Goto_page'])
);
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	// plugs
	if ( $config->plug_ins[$requester] )
	{
		foreach ( $config->plug_ins[$requester] as $plug => $dummy )
		{
			if ( method_exists($config->plug_ins[$requester][$plug], 'format_sql_total') )
			{
				$config->plug_ins[$requester][$plug]->format_sql_total($sql);
			}
		}
	}

	if ( !empty($sql_join) )
	{
		$sql = str_replace('username', 'u.username', $sql);
		$sql = str_replace('user_', 'u.user_', $sql);
		$sql = str_replace('FROM ' . USERS_TABLE, 'FROM ' . USERS_TABLE . ' u' . $sql_join, $sql);
	}
	if ( !empty($sql_where) )
	{
		$sql = str_replace('WHERE ', 'WHERE ' . $sql_where, $sql);
	}
	$result = $db->sql_query($sql, false, __LINE__, __FILE__);
	$total_members = ($row = $db->sql_fetchrow($result)) ? intval($row['total']) : 0;
	$db->sql_freeresult($result);
}
else
{
	$total_members = $i;
}

// navigation
$navigation = new navigation();
$navigation->add('Memberlist', '', 'memberlist', $parms, '');
$navigation->display();

// pagination
$pagination = new pagination('memberlist', $parms);
$pagination->display('pagination', $total_members, intval($config->data['topics_per_page']), $start, true, 'Users_count');
unset($pagination);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
modcp.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
include($phpbb_root_path . 'extension.inc');
include($phpbb_root_path . 'common.'.$phpEx);
include($phpbb_root_path . 'includes/bbcode.'.$phpEx);
include($phpbb_root_path . 'includes/functions_admin.'.$phpEx);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$phpEx = substr(strrchr(__FILE__, '.'), 1);
$requester = 'modcp';
include($phpbb_root_path . 'common.'.$phpEx);

include($config->url('includes/bbcode'));
include($config->url('includes/functions_admin'));
include($config->url('includes/class_forums'));
include($config->url('includes/class_topics'));
include($config->url('includes/class_posts'));
include($config->url('includes/class_message'));
include($config->url('includes/class_resync'));

class topics_modcp extends topics
{
	function bottom_line($empty=false)
	{
		global $template, $user;

		$template->set_switch('topicrow');
		$template->set_switch('topicrow.bottom');
		$template->set_switch('topicrow.bottom.select', $this->with_select);
		$template->set_switch('topicrow.bottom.no_topics', $empty);
		if ( $empty )
		{
			$template->set_switch('topicrow.bottom.no_topics.select', $this->with_select);
		}
		else
		{
			$template->set_switch('topicrow.bottom.no_topics_ELSE.select', $this->with_select);
		}
		$template->assign_vars(array(
			'L_SELECT' => $user->lang('Select'),
			'L_DELETE' => $user->lang('Delete'),
			'L_MOVE' => $user->lang('Move'),
			'L_LOCK' => $user->lang('Lock'),
			'L_UNLOCK' => $user->lang('Unlock'),
		));
		$template->assign_vars(array('BOTTOM_ROW' => $template->include_file('topics_bottom_modcp.tpl')));
	}
}

$forums = new forums();
$forums->read();
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
// Start session management
//
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
$user->use_lang(array('modcp', 'class_forum', 'class_topics', 'class_posts', 'viewprofile'));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
// End session management
//
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
// plugs
if ( $config->plug_ins[$requester] )
{
	foreach ( $config->plug_ins[$requester] as $plug => $dummy )
	{
		if ( method_exists($config->plug_ins[$requester][$plug], 'start') )
		{
			$config->plug_ins[$requester][$plug]->start();
		}
	}
}

$template->assign_vars(array(
	'U_MOD_CP' => $config->url($requester, array(POST_FORUM_URL => $forum_id, 'sid' => $user->data['session_id']), true),
	'L_MOD_CP' => $user->lang('Mod_CP'),
	'I_POST' => $user->img('icon_minipost'),
));

// no access for bots
if ( $user->data['session_is_bot'] )
{
	message_return('Not_Authorised');
}
$user->get_cache(array(POST_FORUM_URL, POST_FORUM_URL . 'jbox'));
$forums->refresh();
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	else if ( $forum_id )
	{
		$redirect = "viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id";
	}
	else
	{
		$redirect = "index.$phpEx";
	}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	else
	{
		$redirect = $config->url(INDEX, array(POST_FORUM_URL => $forum_id), true);
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
// Start auth check
//
$is_auth = auth(AUTH_ALL, $forum_id, $userdata);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
if ( $forums->data[$forum_id]['forum_type'] != POST_FORUM_URL )
{
	$l_link = 'Click_return_forum';
	$u_link = $config->url(INDEX, array(POST_FORUM_URL => $forum_id), true);
	message_return('Move_to_forum_error', $l_link, $u_link);
}

// display nav sentence
$forums->display_nav(($mode == 'ip') ? 0 : $forum_id);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
				remove_search_post($post_id_sql);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			sync('forum', $forum_id);

			if ( !empty($topic_id) )
			{
				$redirect_page = "viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id&amp;sid=" . $userdata['session_id'];
				$l_redirect = sprintf($lang['Click_return_forum'], '<a href="' . $redirect_page . '">', '</a>');
			}
			else
			{
				$redirect_page = "modcp.$phpEx?" . POST_FORUM_URL . "=$forum_id&amp;sid=" . $userdata['session_id'];
				$l_redirect = sprintf($lang['Click_return_modcp'], '<a href="' . $redirect_page . '">', '</a>');
			}

			$template->assign_vars(array(
				'META' => '<meta http-equiv="refresh" content="3;url=' . $redirect_page . '">')
			);

			message_die(GENERAL_MESSAGE, $lang['Topics_Removed'] . '<br /><br />' . $l_redirect);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
			if ( !empty($post_id_sql) )
			{
				// prune search tables
				if ( !$config->data['fulltext_search'] )
				{
					$prune = new prune();
					$prune->words_posts(array_map('intval', explode(', ', $post_id_sql)));
					unset($prune);
				}

				// plugs
				if ( $config->plug_ins[$requester] )
				{
					foreach ( $config->plug_ins[$requester] as $plug => $dummy )
					{
						if ( method_exists($config->plug_ins[$requester][$plug], 'remove_posts') )
						{
							$config->plug_ins[$requester][$plug]->remove_posts(array_map('intval', explode(', ', $post_id_sql)));
						}
					}
				}
			}

			if ( !empty($topic_id_sql) )
			{
				// plugs
				if ( $config->plug_ins[$requester] )
				{
					foreach ( $config->plug_ins[$requester] as $plug => $dummy )
					{
						if ( method_exists($config->plug_ins[$requester][$plug], 'remove_topics') )
						{
							$config->plug_ins[$requester][$plug]->remove_topics(array_map('intval', explode(', ', $topic_id_sql)));
						}
					}
				}
			}

			$resync = new resync();
			$resync->forums($forum_id);
			unset($resync);
			if ( !empty($topic_id) )
			{
				$l_return = 'Click_return_forum';
				$u_return = $config->url(INDEX, array(POST_FORUM_URL => $forum_id, 'sid' => $user->data['session_id']), true);
			}
			else
			{
				$l_return = 'Click_return_modcp';
				$u_return = $config->url($requester, array(POST_FORUM_URL => $forum_id, 'sid' => $user->data['session_id']), true);
			}
			message_return('Topics_Removed', $l_return, $u_return);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			$new_forum_id = intval($HTTP_POST_VARS['new_forum']);
			$old_forum_id = $forum_id;
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
			if ( $forums->data[$new_forum_id]['forum_type'] != POST_FORUM_URL )
			{
				$l_link = 'Click_return_modcp';
				$u_link = $config->url($requester, array(POST_FORUM_URL => $forum_id, 'sid' => $user->data['session_id']), true);
				message_return('Move_to_forum_error', $l_link, $u_link, 10);
			}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
				sync('forum', $new_forum_id);
				sync('forum', $old_forum_id);

				$message = $lang['Topics_Moved'] . '<br /><br />';

			}
			else
			{
				$message = $lang['No_Topics_Moved'] . '<br /><br />';
			}

			if ( !empty($topic_id) )
			{
				$redirect_page = "viewtopic.$phpEx?" . POST_TOPIC_URL . "=$topic_id&amp;sid=" . $userdata['session_id'];
				$message .= sprintf($lang['Click_return_topic'], '<a href="' . $redirect_page . '">', '</a>');
			}
			else
			{
				$redirect_page = "modcp.$phpEx?" . POST_FORUM_URL . "=$forum_id&amp;sid=" . $userdata['session_id'];
				$message .= sprintf($lang['Click_return_modcp'], '<a href="' . $redirect_page . '">', '</a>');
			}

			$message = $message . '<br \><br \>' . sprintf($lang['Click_return_forum'], '<a href="' . "viewforum.$phpEx?" . POST_FORUM_URL . "=$old_forum_id&amp;sid=" . $userdata['session_id'] . '">', '</a>');

			$template->assign_vars(array(
				'META' => '<meta http-equiv="refresh" content="3;url=' . $redirect_page . '">')
			);

			message_die(GENERAL_MESSAGE, $message);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
				// plugs
				if ( $config->plug_ins[$requester] )
				{
					foreach ( $config->plug_ins[$requester] as $plug => $dummy )
					{
						if ( method_exists($config->plug_ins[$requester][$plug], 'move_topics') )
						{
							$config->plug_ins[$requester][$plug]->move_topics(array_map('intval', explode(', ', $topic_list)), $new_forum_id, $forum_id);
						}
					}
				}

				// resync
				$resync = new resync();
				$resync->forums($new_forum_id == $forum_id ? $forum_id : array($new_forum_id, $forum_id));
				unset($resync);
				$message = 'Topics_Moved';
			}
			else
			{
				$message = 'No_Topics_Moved';
			}
			if ( !empty($topic_id) )
			{
				$l_return = 'Click_return_topic';
				$u_return = $config->url('viewtopic', array(POST_TOPIC_URL => $topic_id, 'sid' => $user->data['session_id']), true);
			}
			else
			{
				$l_return = 'Click_return_modcp';
				$u_return = $config->url($requester, array(POST_FORUM_URL => $forum_id, 'sid' => $user->data['session_id']), true);
			}
			message_return($message, $l_return, $u_return, 5, $forum_id);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		if ( !empty($topic_id) )
		{
			$redirect_page = "viewtopic.$phpEx?" . POST_TOPIC_URL . "=$topic_id&amp;sid=" . $userdata['session_id'];
			$message = sprintf($lang['Click_return_topic'], '<a href="' . $redirect_page . '">', '</a>');
		}
		else
		{
			$redirect_page = "modcp.$phpEx?" . POST_FORUM_URL . "=$forum_id&amp;sid=" . $userdata['session_id'];
			$message = sprintf($lang['Click_return_modcp'], '<a href="' . $redirect_page . '">', '</a>');
		}

		$message = $message . '<br \><br \>' . sprintf($lang['Click_return_forum'], '<a href="' . "viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id&amp;sid=" . $userdata['session_id'] . '">', '</a>');

		$template->assign_vars(array(
			'META' => '<meta http-equiv="refresh" content="3;url=' . $redirect_page . '">')
		);

		message_die(GENERAL_MESSAGE, $lang['Topics_Locked'] . '<br /><br />' . $message);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		// plugs
		if ( $config->plug_ins[$requester] )
		{
			foreach ( $config->plug_ins[$requester] as $plug => $dummy )
			{
				if ( method_exists($config->plug_ins[$requester][$plug], 'lock_topics') )
				{
					$config->plug_ins[$requester][$plug]->lock_topics(array_map('intval', explode(', ', $topic_id_sql)));
				}
			}
		}

		if ( !empty($topic_id) )
		{
			$l_return = 'Click_return_topic';
			$u_return = $config->url('viewtopic', array(POST_TOPIC_URL => $topic_id, 'sid' => $user->data['session_id']), true);
		}
		else
		{
			$l_return = 'Click_return_modcp';
			$u_return = $config->url($requester, array(POST_FORUM_URL => $forum_id, 'sid' => $user->data['session_id']), true);
		}
		message_return('Topics_Locked', $l_return, $u_return, 5, $forum_id);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		if ( !empty($topic_id) )
		{
			$redirect_page = "viewtopic.$phpEx?" . POST_TOPIC_URL . "=$topic_id&amp;sid=" . $userdata['session_id'];
			$message = sprintf($lang['Click_return_topic'], '<a href="' . $redirect_page . '">', '</a>');
		}
		else
		{
			$redirect_page = "modcp.$phpEx?" . POST_FORUM_URL . "=$forum_id&amp;sid=" . $userdata['session_id'];
			$message = sprintf($lang['Click_return_modcp'], '<a href="' . $redirect_page . '">', '</a>');
		}

		$message = $message . '<br \><br \>' . sprintf($lang['Click_return_forum'], '<a href="' . "viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id&amp;sid=" . $userdata['session_id'] . '">', '</a>');

		$template->assign_vars(array(
			'META' => '<meta http-equiv="refresh" content="3;url=' . $redirect_page . '">')
		);

		message_die(GENERAL_MESSAGE, $lang['Topics_Unlocked'] . '<br /><br />' . $message);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		// plugs
		if ( $config->plug_ins[$requester] )
		{
			foreach ( $config->plug_ins[$requester] as $plug => $dummy )
			{
				if ( method_exists($config->plug_ins[$requester][$plug], 'unlock_topics') )
				{
					$config->plug_ins[$requester][$plug]->unlock_topics(array_map('intval', explode(', ', $topic_id_sql)));
				}
			}
		}

		if ( !empty($topic_id) )
		{
			$l_return = 'Click_return_topic';
			$u_return = $config->url('viewtopic', array(POST_TOPIC_URL => $topic_id, 'sid' => $user->data['session_id']), true);
		}
		else
		{
			$l_return = 'Click_return_modcp';
			$u_return = $config->url($requester, array(POST_FORUM_URL => $forum_id, 'sid' => $user->data['session_id']), true);
		}
		message_return('Topics_Unlocked', $l_return, $u_return, 5, $forum_id);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
				if (empty($post_subject))
				{
					message_die(GENERAL_MESSAGE, $lang['Empty_subject']);
				}

				$new_forum_id = intval($HTTP_POST_VARS['new_forum_id']);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				if ( $forums->data[$new_forum_id]['forum_type'] != POST_FORUM_URL )
				{
					$l_link = 'Click_return_modcp';
					$u_link = $config->url($requester, array('mode' => 'split', POST_FORUM_URL => $forum_id, POST_TOPIC_URL => $topic_id, 'sid' => $user->data['session_id']), true);
					message_return('Move_to_forum_error', $l_link, $u_link, 10);
				}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
				sync('topic', $new_topic_id);
				sync('topic', $topic_id);
				sync('forum', $new_forum_id);
				sync('forum', $forum_id);

				$template->assign_vars(array(
					'META' => '<meta http-equiv="refresh" content="3;url=' . "viewtopic.$phpEx?" . POST_TOPIC_URL . "=$topic_id&amp;sid=" . $userdata['session_id'] . '">')
				);

				$message = $lang['Topic_split'] . '<br /><br />' . sprintf($lang['Click_return_topic'], '<a href="' . "viewtopic.$phpEx?" . POST_TOPIC_URL . "=$topic_id&amp;sid=" . $userdata['session_id'] . '">', '</a>');
				message_die(GENERAL_MESSAGE, $message);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
				// plugs
				if ( $config->plug_ins[$requester] )
				{
					foreach ( $config->plug_ins[$requester] as $plug => $dummy )
					{
						if ( method_exists($config->plug_ins[$requester][$plug], 'split_posts') )
						{
							$config->plug_ins[$requester][$plug]->split_posts(array_map('intval', explode(', ', $post_id_sql)), $new_topic_id, $topic_id, $new_forum_id, $forum_id);
						}
					}
				}

				$resync = new resync();
				$resync->topics(array($new_topic_id, $topic_id));
				$resync->forums($new_forum_id == $forum_id ? $forum_id : array($new_forum_id, $forum_id));
				unset($resync);

				$l_return = 'Click_return_topic';
				$u_return = $config->url('viewtopic', array(POST_TOPIC_URL => $topic_id, 'sid' => $user->data['session_id']), true);
				message_return('Topic_split', $l_return, $u_return, 5, $forum_id);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
					'U_VIEW_FORUM' => append_sid("viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id"), 
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
					'U_VIEW_FORUM' => $config->url(INDEX, array(POST_FORUM_URL => $forum_id), true), 
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
				//
				// Define censored word matches
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
						'S_SPLIT_CHECKBOX' => $checkbox)
					);
				}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
				// plugs
				if ( $config->plug_ins[$requester] )
				{
					foreach ( $config->plug_ins[$requester] as $plug => $dummy )
					{
						if ( method_exists($config->plug_ins[$requester][$plug], 'display_posts') )
						{
							$config->plug_ins[$requester][$plug]->display_posts();
						}
					}
				}

				$message_parser = new message();
				for ( $i = 0; $i < $total_posts; $i++ )
				{
					$post_id = $postrow[$i]['post_id'];
					$poster_id = $postrow[$i]['poster_id'];
					$poster = $postrow[$i]['username'];

					$post_date = $user->date($postrow[$i]['post_time']);

					$bbcode_uid = $postrow[$i]['bbcode_uid'];
					$message = $postrow[$i]['post_text'];
					$post_subject =  !empty($postrow[$i]['post_subject']) ? $postrow[$i]['post_subject'] : '';

					// parse the post
					$switches = array(
						'html' => $postrow[$i]['enable_html'],
						'bbcode' => !empty($bbcode_uid),
						'smilies' => $postrow[$i]['enable_smilies'],
					);
					$message_parser->parse($message, $bbcode_uid, $switches);

					$row_color = ( !($i % 2) ) ? $theme['td_color1'] : $theme['td_color2'];
					$row_class = ( !($i % 2) ) ? $theme['td_class1'] : $theme['td_class2'];

					$checkbox = ( $i > 0 ) ? '<input type="checkbox" name="post_id_list[]" value="' . $post_id . '" />' : '&nbsp;';

					$template->assign_block_vars('postrow', array(
						'ROW_COLOR' => '#' . $row_color,
						'ROW_CLASS' => $row_class,
						'POSTER_NAME' => $poster,
						'POST_DATE' => $post_date,
						'POST_SUBJECT' => $post_subject,
						'MESSAGE' => $message,
						'U_POST_ID' => $post_id,
						'S_SPLIT_CHECKBOX' => $checkbox
					));
					$template->set_switch('postrow.light', !($i % 2));

					// plugs
					if ( $config->plug_ins[$requester] )
					{
						foreach ( $config->plug_ins[$requester] as $plug => $dummy )
						{
							if ( method_exists($config->plug_ins[$requester][$plug], 'display_posts') )
							{
								$config->plug_ins[$requester][$plug]->display_posts($postrow[$i], 'postrow');
							}
						}
					}
				}
				unset($message_parser);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		if ( !($result = $db->sql_query($sql)) )
		{
			message_die(GENERAL_ERROR, 'Could not get IP information for this user', '', __LINE__, __FILE__, $sql);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
					'U_LOOKUP_IP' => "modcp.$phpEx?mode=ip&amp;" . POST_POST_URL . "=$post_id&amp;" . POST_TOPIC_URL . "=$topic_id&amp;rdns=" . $row['poster_ip'] . "&amp;sid=" . $userdata['session_id'])
				);

				$i++; 
			}
			while ( $row = $db->sql_fetchrow($result) );
		}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		// plugs
		if ( $config->plug_ins[$requester] )
		{
			foreach ( $config->plug_ins[$requester] as $plug => $dummy )
			{
				if ( method_exists($config->plug_ins[$requester][$plug], 'display_ip') )
				{
					$config->plug_ins[$requester][$plug]->display_ip('ips', $sql);
				}
			}
		}

		$poster_posts = 0;
		if ( $poster_id != ANONYMOUS )
		{
			$color = false;
			$first = true;
			$result = $db->sql_query($sql, false, __LINE__, __FILE__);
			while ( $row = $db->sql_fetchrow($result) )
			{
				$first = false;
				$color = !$color;
				if ( $row['poster_ip'] == $post_row['poster_ip'] )
				{
					$poster_posts = $row['postings'];
					continue;
				}

				$ip = decode_ip($row['poster_ip']);
				$ip = ($rdns_ip_num == $row['poster_ip']) || ($rdns_ip_num == 'all') ? htmlspecialchars(gethostbyaddr($ip)) : $ip;

				$row_color = $color ? $theme['td_color1'] : $theme['td_color2'];
				$row_class = $color ? $theme['td_class1'] : $theme['td_class2'];
				$template->assign_block_vars('iprow', array(
					'ROW_COLOR' => '#' . $row_color,
					'ROW_CLASS' => $row_class,
					'IP' => $ip,
					'POSTS' => $row['postings'] . ' ' . ($row['postings'] == 1 ? $user->lang('Post') : $user->lang('Posts')),
					'U_LOOKUP_IP' => $config->url($requester, array('mode' => 'ip', POST_POST_URL => $post_id, POST_TOPIC_URL => $topic_id, 'rdns' => $row['poster_ip'], 'sid' => $user->data['session_id']), true),
				));
				$template->set_switch('iprow.light', $color);

				// plugs
				if ( $config->plug_ins[$requester] )
				{
					$dummy = false;
					foreach ( $config->plug_ins[$requester] as $plug => $dummy )
					{
						if ( method_exists($config->plug_ins[$requester][$plug], 'display_ip') )
						{
							$config->plug_ins[$requester][$plug]->display_ip('ips', $dummy, $row, 'iprow');
						}
					}
				}

			}
			$db->sql_freeresult($result);
		}
		$template->assign_vars(array(
			'L_NONE' => $user->lang('None'),
			'POSTS' => $poster_posts ? $poster_posts . ' ' . ($poster_posts == 1 ? $user->lang('Post') : $user->lang('Posts')) : '',
		));
		$template->set_switch('iprow_title', !$first);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		//
		// Get other users who've posted under this IP
		//
		$sql = "SELECT u.user_id, u.username, COUNT(*) as postings 
			FROM " . USERS_TABLE ." u, " . POSTS_TABLE . " p 
			WHERE p.poster_id = u.user_id 
				AND p.poster_ip = '" . $post_row['poster_ip'] . "'
			GROUP BY u.user_id, u.username
			ORDER BY " . (( SQL_LAYER == 'msaccess' ) ? 'COUNT(*)' : 'postings' ) . " DESC";
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		// plugs
		if ( $config->plug_ins[$requester] )
		{
			foreach ( $config->plug_ins[$requester] as $plug => $dummy )
			{
				if ( method_exists($config->plug_ins[$requester][$plug], 'display_ip') )
				{
					$config->plug_ins[$requester][$plug]->display_ip('users', $sql);
				}
			}
		}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
					'U_PROFILE' => ($id == ANONYMOUS) ? "modcp.$phpEx?mode=ip&amp;" . POST_POST_URL . "=" . $post_id . "&amp;" . POST_TOPIC_URL . "=" . $topic_id . "&amp;sid=" . $userdata['session_id'] : append_sid("profile.$phpEx?mode=viewprofile&amp;" . POST_USERS_URL . "=$id"),
					'U_SEARCHPOSTS' => append_sid("search.$phpEx?search_author=" . (($id == ANONYMOUS) ? 'Anonymous' : urlencode($username)) . "&amp;showresults=topics"))
				);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				$template->set_switch('userrow.light', !($i % 2));

				// plugs
				if ( $config->plug_ins[$requester] )
				{
					foreach ( $config->plug_ins[$requester] as $plug => $dummy )
					{
						if ( method_exists($config->plug_ins[$requester][$plug], 'display_ip') )
						{
							$config->plug_ins[$requester][$plug]->display_ip('users', $dummy, $row, 'userrow');
						}
					}
				}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$page_title = $lang['Mod_CP'];
		include($phpbb_root_path . 'includes/page_header.'.$phpEx);

		$template->assign_vars(array(
			'FORUM_NAME' => $forum_name,
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
			'L_GOTO_PAGE' => $lang['Goto_page'])
		);

		$template->pparse('body');
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		$topics = new topics_modcp($requester, array('sid' => $user->data['session_id']));
		$topics->set_view_link($requester, array('mode' => 'split', 'sid' => $user->data['session_id']));
		$topics->set_select();

		// read topics keeping only local announces
		$topics->read($forum_id, true);
		$topics->display(false, true);

		$template->assign_vars(array(
			'L_MOD_CP' => $user->lang('Mod_CP'),
			'L_MOD_CP_EXPLAIN' => $user->lang('Mod_CP_explain'),
			'S_MODCP_ACTION' => $config->url($requester, '', true),
		));
		_hide('sid', $user->data['session_id']);
		_hide(POST_FORUM_URL, $forum_id);
		_hide_set();

		// build the display
		$page_title = $user->lang('Mod_CP');
		make_jumpbox($requester);

		include($config->url('includes/page_header'));
		$template->set_filenames(array('body' => 'modcp_body.tpl'));
		$template->pparse('body');
		include($config->url('includes/page_tail'));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
posting.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
include($phpbb_root_path . 'extension.inc');
include($phpbb_root_path . 'common.'.$phpEx);
include($phpbb_root_path . 'includes/bbcode.'.$phpEx);
include($phpbb_root_path . 'includes/functions_post.'.$phpEx);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
define('SID_CHECK', true);

$phpEx = substr(strrchr(__FILE__, '.'), 1);
$requester = 'posting';

include($phpbb_root_path . 'common.'.$phpEx);

// specific treatement for visual confirmation
if ( _read('mode', TYPE_NO_HTML) == 'confirm' )
{
	$userdata = session_pagestart($user_ip, PAGE_POSTING);
	$user->set('posting_confirm', false);
	include($config->url('includes/vc/class_visual_confirm_img'));
	exit;
}

include($config->url('includes/bbcode'));
include($config->url('includes/functions_post'));
include($config->url('includes/class_forums'));
include($config->url('includes/class_topics'));
include($config->url('includes/class_posts'));
include($config->url('includes/class_message'));
include($config->url('includes/class_form'));
include($config->url('includes/class_resync'));

$forums = new forums();
$forums->read();
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$topic_type = ( !empty($HTTP_POST_VARS['topictype']) ) ? intval($HTTP_POST_VARS['topictype']) : POST_NORMAL;
$topic_type = ( in_array($topic_type, array(POST_NORMAL, POST_STICKY, POST_ANNOUNCE)) ) ? $topic_type : POST_NORMAL;
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
else if ( $mode == 'smilies' )
{
	generate_smilies('window', PAGE_POSTING);
	exit;
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$topic_type = _read('topictype', TYPE_INT, POST_NORMAL, array_flip(array(POST_NORMAL, POST_STICKY, POST_ANNOUNCE, POST_GLOBAL_ANNOUNCE)));

if ( $mode == 'topicreview' )
{
	include($config->url('includes/topic_review'));
	topic_review($topic_id, $post_id, false);
	exit;
}
else if ( $mode == 'smilies' )
{
	generate_smilies('window', PAGE_POSTING);
	exit;
}

// get the forum of this topic/post
if ( empty($forum_id) )
{
	if ( !empty($topic_id) )
	{
		$sql = 'SELECT forum_id
					FROM ' . TOPICS_TABLE . '
					WHERE topic_id = ' . intval($topic_id);
	}
	else
	{
		$sql = 'SELECT forum_id
					FROM ' . POSTS_TABLE . '
					WHERE post_id = ' . intval($post_id);
	}
	$result = $db->sql_query($sql, false, __LINE__, __FILE__);
	if ( $row = $db->sql_fetchrow($result) )
	{
		$forum_id = $row['forum_id'];
	}
	$db->sql_freeresult($result);
}

// plugs
if ( $config->plug_ins[$requester] )
{
	foreach ( $config->plug_ins[$requester] as $plug => $dummy )
	{
		if ( method_exists($config->plug_ins[$requester][$plug], 'start') )
		{
			$config->plug_ins[$requester][$plug]->start();
		}
	}
}

$user->use_lang(array('posting', 'viewtopic', 'class_forum', 'class_topics', 'class_posts', 'viewprofile', 'class_fields', 'bbcodes'));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
if ( isset($HTTP_POST_VARS['cancel']) )
{
	if ( $post_id )
	{
		$redirect = "viewtopic.$phpEx?" . POST_POST_URL . "=$post_id";
		$post_append = "#$post_id";
	}
	else if ( $topic_id )
	{
		$redirect = "viewtopic.$phpEx?" . POST_TOPIC_URL . "=$topic_id";
		$post_append = '';
	}
	else if ( $forum_id )
	{
		$redirect = "viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id";
		$post_append = '';
	}
	else
	{
		$redirect = "index.$phpEx";
		$post_append = '';
	}

	redirect(append_sid($redirect, true) . $post_append);
}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
// check guests posting count
if ( !$user->data['session_logged_in'] && ($max_guests = intval($config->data['posting_max_guests'])) && ($time_guests = intval($config->data['posting_time_guests'])) )
{
	$sql = 'SELECT COUNT(DISTINCT session_id) AS count_session_id
				FROM ' . SESSIONS_TABLE . '
				WHERE session_page = ' . intval(PAGE_POSTING) . '
					AND session_user_id = ' . ANONYMOUS . '
					AND session_time > ' . (time() - $time_guests);
	$result = $db->sql_query($sql, false, __LINE__, __FILE__);
	$flood = ($row = $db->sql_fetchrow($result)) ? intval($row['count_session_id']) > $max_guests : false;
	$db->sql_freeresult($result);
	if ( $flood )
	{
		message_die(GENERAL_MESSAGE, $user->lang('Too_many_connections'));
	}
}

// cancel
if ( _button('cancel') )
{
	if ( intval($post_id) )
	{
		redirect($config->url('viewtopic', array(POST_POST_URL => intval($post_id)), true, intval($post_id)));
	}
	else if ( intval($topic_id) )
	{
		redirect($config->url('viewtopic', array(POST_TOPIC_URL => intval($topic_id)), true));
	}
	else if ( intval($forum_id) )
	{
		redirect($config->url(INDEX, array(POST_FORUM_URL => intval($forum_id)), true));
	}
	else
	{
		redirect($config->url(INDEX, '', true));
	}
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$is_auth = array();
switch( $mode )
{
	case 'newtopic':
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		if ( $topic_type == POST_GLOBAL_ANNOUNCE )
		{
			$is_auth_type = 'auth_global_announce';
		}
		else
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
switch ( $mode )
{
	case 'newtopic':
		if ( empty($forum_id) )
		{
			message_die(GENERAL_MESSAGE, $lang['Forum_not_exist']);
		}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
	$forum_id = $post_info['forum_id'];
	$forum_name = $post_info['forum_name'];

	$is_auth = auth(AUTH_ALL, $forum_id, $userdata, $post_info);
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$user->get_cache(array(POST_FORUM_URL, POST_FORUM_URL . 'jbox'));

$topic_fields = array(
	't.topic_id',
	't.topic_icon',
	't.topic_duration',
	't.topic_title',
	't.topic_sub_title',
	't.topic_type',
	't.topic_sub_type',
	't.topic_status',
	't.topic_vote',
	't.topic_time',
	't.topic_first_post_id',
	't.topic_last_post_id',
);

// plugs
if ( $config->plug_ins[$requester] )
{
	foreach ( $config->plug_ins[$requester] as $plug => $dummy )
	{
		if ( method_exists($config->plug_ins[$requester][$plug], 'topic_fields') )
		{
			$config->plug_ins[$requester][$plug]->topic_fields($topic_fields);
		}
	}
}

$post_info = false;
switch ( $mode )
{
	case 'newtopic':
		if ( !($forum_id = intval($forum_id)) || !isset($forums->data[$forum_id]) || ($forums->data[$forum_id]['forum_type'] != POST_FORUM_URL) )
		{
			message_die(GENERAL_MESSAGE, 'Forum_not_exist');
		}
		$post_info = array('forum_id' => $forum_id);
		break;

	case 'reply':
	case 'vote':
		if ( !($topic_id = intval($topic_id)) )
		{
			message_die(GENERAL_MESSAGE, 'No_topic_id');
		}
		$sql = 'SELECT t.forum_id, ' . implode(', ', $topic_fields) . '
					FROM ' . TOPICS_TABLE . ' t
					WHERE t.topic_id = ' . intval($topic_id);
		$result = $db->sql_query($sql, false, __LINE__, __FILE__);
		$post_info = $db->sql_fetchrow($result);
		$db->sql_freeresult($result);
		break;

	case 'quote':
	case 'editpost':
	case 'delete':
	case 'poll_delete':
		if ( !($post_id = intval($post_id)) )
		{
			message_die(GENERAL_MESSAGE, 'No_post_id');
		}
		$fields = array_merge($topic_fields, array(
			'p.post_id',
			'p.forum_id',
			'p.poster_id',
			'p.poster_ip',
			'p.post_icon',
		));

		// plugs
		if ( $config->plug_ins[$requester] )
		{
			foreach ( $config->plug_ins[$requester] as $plug => $dummy )
			{
				if ( method_exists($config->plug_ins[$requester][$plug], 'post_fields') )
				{
					$config->plug_ins[$requester][$plug]->post_fields($fields);
				}
			}
		}
		$sql_tables = array(POSTS_TABLE . ' p', TOPICS_TABLE . ' t');
		$sql_wheres = array('p.post_id = ' . intval($post_id), 't.topic_id = p.topic_id');

		if ( !$submit )
		{
			$fields = array_merge($fields, array(
				'p.enable_bbcode',
				'p.enable_html',
				'p.enable_smilies',
				'p.enable_sig',
				'p.post_username',

				'pt.post_subject',
				'pt.post_sub_title',
				'pt.post_text',
				'pt.bbcode_uid',

				'u.username',
				'u.user_id',
				'u.user_sig',
				'u.user_sig_bbcode_uid',
			));
			$sql_tables = array_merge($sql_tables, array(POSTS_TEXT_TABLE . ' pt', USERS_TABLE . ' u'));
			$sql_wheres = array_merge($sql_wheres, array('pt.post_id = p.post_id', 'u.user_id = p.poster_id'));
		}
		$sql = 'SELECT ' . implode(', ', $fields) . '
					FROM ' . implode(', ', $sql_tables) . '
					WHERE ' . implode('
						AND ', $sql_wheres);
		unset($fields);
		unset($sql_tables);
		unset($sql_wheres);
		$result = $db->sql_query($sql, false, __LINE__, __FILE__);
		$post_info = $db->sql_fetchrow($result);
		$db->sql_freeresult($result);
		break;

	default:
		message_die(GENERAL_MESSAGE, 'No_valid_mode');
		break;
}
unset($topic_fields);
if ( !$post_info )
{
	message_die(GENERAL_MESSAGE, 'No_such_post');
}

// add forum data
if ( ($forum_id = intval($post_info['forum_id'])) && isset($forums->data[$forum_id]) )
{
	// we only need to refresh data on some case (to get the "last_topic" info)
	if ( $is_last_topic = in_array($mode, array('editpost', 'delete', 'poll_delete')) )
	{
		$forums->refresh($forum_id);
	}
	$row = $forums->data[$forum_id];
	if ( $is_last_topic )
	{
		if ( !empty($row['last']) )
		{
			$row = array_merge($row, $row['last']);
			unset($row['last']);
		}
		if ( isset($row['subs']) )
		{
			unset($row['subs']);
		}
	}
	$post_info = array_merge($post_info, $row);
	unset($row);
	unset($is_last_topic);
}

$topic_last_post_id = intval($post_info['topic_last_post_id']);
if ( ($submit || $refresh) && in_array($mode, array('reply', 'quote', 'editpost')) )
{
	// check if the last post id is still the same
	if ( _read('last_post', TYPE_INT, $topic_last_post_id) != $topic_last_post_id )
	{
		$refresh = $preview = true;
		$submit = false;
		_error($mode == 'editpost' ? 'New_post_meanwhile_edit' : 'New_post_meanwhile_reply');
	}
}

// check & prepare data
if ( !empty($post_info['forum_id']) && !empty($forums->data[ $post_info['forum_id'] ]) )
{
	$forum_name = $user->lang($post_info['forum_name']);

	// get auths
	$is_auth = auth(AUTH_ALL, $forum_id, $user->data, $post_info);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		else if ( !$post_data['last_post'] && !$is_auth['auth_mod'] && ( $mode == 'delete' || $delete ) )
		{
			message_die(GENERAL_MESSAGE, $lang['Cannot_delete_replied']);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		else if ( !$user->data['session_logged_in'] && ($user->data['session_ip'] != $post_info['poster_ip']) && !$user->auth(POST_FORUM_URL, 'auth_mod', $forum_id) )
		{
			message_return(($delete || ($mode == 'delete')) ? 'Delete_own_posts' : 'Edit_own_posts', 'Click_return_topic', $config->url('viewtopic', array(POST_TOPIC_URL => $topic_id), true));
		}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
if ( !$is_auth[$is_auth_type] )
{
	if ( $userdata['session_logged_in'] )
	{
		message_die(GENERAL_MESSAGE, sprintf($lang['Sorry_' . $is_auth_type], $is_auth[$is_auth_type . "_type"]));
	}

	switch( $mode )
	{
		case 'newtopic':
			$redirect = "mode=newtopic&" . POST_FORUM_URL . "=" . $forum_id;
			break;
		case 'reply':
		case 'topicreview':
			$redirect = "mode=reply&" . POST_TOPIC_URL . "=" . $topic_id;
			break;
		case 'quote':
		case 'editpost':
			$redirect = "mode=quote&" . POST_POST_URL ."=" . $post_id;
			break;
	}

	redirect(append_sid("login.$phpEx?redirect=posting.$phpEx&" . $redirect, true));
}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
if ( !$user->auth(POST_FORUM_URL, $is_auth_type, $forum_id) )
{
	if ( !$user->data['session_logged_in'] )
	{
		switch ( $mode )
		{
			case 'newtopic':
				$parms = array('mode' => 'newtopic', POST_FORUM_URL => intval($forum_id));
				break;
			case 'reply':
			case 'topicreview':
				$parms = array('mode' => 'reply', POST_TOPIC_URL => intval($topic_id));
				break;
			case 'quote':
			case 'editpost':
				$parms = array('mode' => 'quote', POST_POST_URL => intval($post_id));
				break;
			default:
				$parms = '';
		}
		redirect($config->url('login', '', true), $config->url($requester, $parms, true));
	}
	message_die(GENERAL_MESSAGE, sprintf($user->lang('Sorry_' . $is_auth_type), $user->lang('Auth_Users_granted_access')));
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$attach_sig = ( $submit || $refresh ) ? ( ( !empty($HTTP_POST_VARS['attach_sig']) ) ? TRUE : 0 ) : ( ( $userdata['user_id'] == ANONYMOUS ) ? 0 : $userdata['user_attachsig'] );
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
//
// all is prepared, the data have been readed from the table
//

// check the visual confirm code
$visual_confirm = '';
if ( $config->data['enable_confirm_post'] && !$user->data['session_logged_in'] && in_array($mode, array('newtopic', 'reply', 'quote')))
{
	include($config->url('includes/vc/class_visual_confirm'));
	$visual_confirm = new visual_confirm($requester);
	if ( _button('post') && ($res = $visual_confirm->check('confirm_id', 'confirm_code')) )
	{
		_error($res);
	}
}

// first post of a topic
$first_post = ($mode == 'newtopic') || (($mode == 'editpost') && $post_data['first_post']);
$set_menu = 0;

// plugs
if ( $config->plug_ins[$requester] )
{
	foreach ( $config->plug_ins[$requester] as $plug => $dummy )
	{
		if ( method_exists($config->plug_ins[$requester][$plug], 'set_form') )
		{
			$config->plug_ins[$requester][$plug]->set_form();
		}
	}
}

//
// sub type form
//
$topics_attr->read();
$topics_attr->get_allowed('topic_sub_type', $forum_id);
$auth_sub_type = count($topics_attr->allowed) > 1;
$topic_sub_type = $first_post ? intval($post_info['topic_sub_type']) : 0;
if ( $first_post && $auth_sub_type )
{
	$fields = array(
		'topic_sub_type' => array('type' => 'list', 'legend' => 'Topic_sub_type', 'value' => $topic_sub_type, 'options' => $topics_attr->allowed, 'bold' => true),
	);
	$sub_type_form = new form($fields, false);
	$sub_type_form->process('', ($submit || $refresh), _button('cancel'), 'SUB_TYPE_FORM');

	// post process
	$topic_sub_type = intval($sub_type_form->fields['topic_sub_type']->value);
	unset($sub_type_form);
}

//
// topic type + topic duration form
//
$post_info['topic_duration'] = intval($post_info['topic_duration']);

$auth_sticky = $user->auth(POST_FORUM_URL, 'auth_sticky', $forum_id);
$auth_announce = $user->auth(POST_FORUM_URL, 'auth_announce', $forum_id);
$auth_global_announce = $user->auth(POST_FORUM_URL, 'auth_global_announce', $forum_id);
$auth_announces = $auth_announce || $auth_global_announce;
$auth_topic_types = $auth_sticky || $auth_announces;

$topic_type = intval($post_info['topic_type']);
$topic_duration = $first_post ? (empty($post_info['topic_time']) || !$auth_announces ? time() : intval($post_info['topic_time'])) : -1;
if ( $first_post && $auth_topic_types )
{
	$set_menu++;
	$available_topic_types = array(
		POST_NORMAL => 'Post_Normal',
		POST_STICKY => 'Post_Sticky',
		POST_ANNOUNCE => 'Post_Announcement',
		POST_GLOBAL_ANNOUNCE => 'Post_Global_Announcement',
	);
	if ( !$auth_sticky )
	{
		unset($available_topic_types[POST_STICKY]);
	}
	if ( !$auth_announce )
	{
		unset($available_topic_types[POST_ANNOUNCE]);
	}
	if ( !$auth_global_announce )
	{
		unset($available_topic_types[POST_GLOBAL_ANNOUNCE]);
	}
	$fields = array(
		'topic_type_title' => array('type' => 'title', 'legend' => 'Post_topic_as'),
		'topictype' => array('type' => 'radio_list', 'legend' => 'Post_topic_as', 'value' => $topic_type, 'options' => $available_topic_types, 'bold' => true),
	);

	// topic duration
	if ( $auth_announces )
	{
		if ( !empty($post_info['topic_duration']) )
		{
			$topic_duration = ($post_info['topic_time'] >= $post_info['topic_duration']) ? -1 : $user->cvt_sys_to_user_date($post_info['topic_duration']);
		}
		else
		{
			$topic_duration = ($mode != 'newtopic') || !intval($config->data['default_duration']) ? 0 : $user->cvt_sys_to_user_date(time() + intval($config->data['default_duration']) * 86400);
		}
		$fields += array(
			'topic_duration' => array('type' => 'date_unix', 'legend' => 'Topic_duration', 'explain' => 'Topic_duration_explain', 'value' => $topic_duration, 'options.specials' => array(-1 => 'Never_displayed', 0 => 'Always_displayed'), 'options.floor' => $user->cvt_sys_to_user_date(time()), 'options.end_date' => true, 'bold' => true),
			'topic_duration_special' => array('type' => 'comment', 'output' => true, 'legend' => 'Topic_duration_special', 'combined' => true, 'linefeed' => true),
		);
	}

	$topic_type_form = new form($fields, false);
	$topic_type_form->process('', ($submit || $refresh), _button('cancel'), 'TOPIC_TYPE_FORM');

	// post process
	$topic_type = intval($topic_type_form->fields['topictype']->value);

	// duration
	if ( $auth_announces )
	{
		$topic_duration = in_array($topic_type, array(POST_ANNOUNCE, POST_GLOBAL_ANNOUNCE)) ? intval($topic_type_form->fields['topic_duration']->value) : -1;
		if ( $topic_duration < 0 )
		{
			$topic_duration = empty($post_info['topic_time']) ? time() : intval($post_info['topic_time']);
		}
		else if ( $topic_duration > 0 )
		{
			$topic_duration = $user->cvt_user_to_sys_date($topic_duration);
		}
	}
	unset($topic_type_form);
}

// send forms titles to template
$template->assign_vars(array(
	'L_LEFT_PART' => $user->lang('Options'),
	'L_TOPIC_TYPE_FORM' => $user->lang('Post_topic_as'),
	'L_POLL_FORM' => $user->lang('Poll'),
));
$template->set_switch('sub_type_form', $first_post && $auth_sub_type);
$template->set_switch('topic_type_form', $first_post && $auth_topic_types);
// nb.: poll_form switch is defined at bottom

// errors are sent later, checking if error_msg is empty
// so we don't need to send our own break messages :)

//
// icons
//
$icons->read();
$icons->get_allowed($forum_id);
if ( $mode == 'newtopic' )
{
	$post_info['topic_icon'] = 0;
	$post_info['post_icon'] = 0;
	$post_info['topic_type'] = POST_NORMAL;
}
$post_icon = empty($icons->allowed) ? 0 : _read('icon_id', TYPE_INT, (($mode == 'quote') || ($mode=='reply') ? 0 : ($post_data['first_post'] ? $post_info['topic_icon'] : $post_info['post_icon'])), array(0 => '') + array_flip($icons->allowed));

//
// sub title
//
$sub_title_display = intval($config->data['sub_title_length']);
if ( $mode == 'newtopic' )
{
	$post_info['topic_sub_title'] = '';
	$post_info['post_sub_title'] = '';
}
if ( intval($config->data['topic_title_length']) <= 0 )
{
	$config->set('topic_title_length', 60, true);
}
$template->assign_vars(array(
	'SUBJECT_LENGTH' => intval($config->data['topic_title_length']),
));
if ( $sub_title_display )
{
	$sub_title = trim(_read('sub_title', TYPE_NO_HTML, isset($post_info['post_sub_title']) ? $post_info['post_sub_title'] : ''));
	$template->assign_vars(array(
		'L_SUB_TITLE' => $user->lang('Sub_title'),
		'SUB_TITLE' => $sub_title,
		'SUB_TITLE_LENGTH' => intval($config->data['sub_title_length']),
	));
}
else
{
	$sub_title = trim($post_info['post_sub_title']);
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	$template->set_filenames(array(
		'confirm_body' => 'confirm_body.tpl')
	);
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
	$forums->display_nav();
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		'S_CONFIRM_ACTION' => append_sid("posting.$phpEx"),
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		'S_CONFIRM_ACTION' => $config->url($requester, '', true),
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
else if ( $submit || $confirm )
{
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	if ( !$config->data['fulltext_search'] && ($mode != 'poll_delete') )
	{
		include($config->url('includes/functions_search'));
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	if ($sid == '' || $sid != $userdata['session_id'])
	{
		$error_msg .= (!empty($error_msg)) ? '<br />' . $lang['Session_invalid'] : $lang['Session_invalid'];
	}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	if ( SID_CHECK && (!($sid = _read_form('sid', TYPE_NO_HTML)) || ($sid != $user->data['session_id'])) )
	{
		_error('Session_invalid');
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full line is longer
#
				submit_post($mode, $post_data, $return_message, $return_meta,
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
				$input_data = array(
					'topic_type' => $topic_type,
					'bbcode_on' => $bbcode_on,
					'html_on' => $html_on,
					'smilies_on' => $smilies_on,
					'attach_sig' => $attach_sig,
					'bbcode_uid' => $bbcode_uid,
					'post_username' => stripslashes($username),
					'post_subject' => stripslashes($subject),
					'post_message' => stripslashes($message),
					'poll_title' => stripslashes($poll_title),
					'poll_options' => $poll_options,
					'poll_length' => $poll_length,
					'post_icon' => $post_icon,
					'topic_duration' => $topic_duration,
					'sub_title' => $sub_title,
					'topic_sub_type' => $topic_sub_type,
				);
				submit_post($mode, $post_data, $return_message, $return_meta, $forum_id, $topic_id, $post_id, $poll_id, $input_data);
				unset($input_data);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		if ( $mode != 'editpost' )
		{
			$user_id = ( $mode == 'reply' || $mode == 'newtopic' ) ? $userdata['user_id'] : $post_data['poster_id'];
			update_post_stats($mode, $post_data, $forum_id, $topic_id, $post_id, $user_id);
		}
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
		// plugs
		if ( $config->plug_ins[$requester] )
		{
			foreach ( $config->plug_ins[$requester] as $plug => $dummy )
			{
				if ( method_exists($config->plug_ins[$requester][$plug], 'validate') )
				{
					$config->plug_ins[$requester][$plug]->validate();
				}
			}
		}

		// add a cookie for this topic
		if ( ($mode == 'newtopic') || ($mode == 'reply') )
		{
			$user->read_cookies(POST_POST_URL, $topic_id);
			$user->write_cookies();
		}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		if ( $mode == 'newtopic' || $mode == 'reply' )
		{
			$tracking_topics = ( !empty($HTTP_COOKIE_VARS[$board_config['cookie_name'] . '_t']) ) ? unserialize($HTTP_COOKIE_VARS[$board_config['cookie_name'] . '_t']) : array();
			$tracking_forums = ( !empty($HTTP_COOKIE_VARS[$board_config['cookie_name'] . '_f']) ) ? unserialize($HTTP_COOKIE_VARS[$board_config['cookie_name'] . '_f']) : array();

			if ( count($tracking_topics) + count($tracking_forums) == 100 && empty($tracking_topics[$topic_id]) )
			{
				asort($tracking_topics);
				unset($tracking_topics[key($tracking_topics)]);
			}

			$tracking_topics[$topic_id] = time();

			setcookie($board_config['cookie_name'] . '_t', serialize($tracking_topics), 0, $board_config['cookie_path'], $board_config['cookie_domain'], $board_config['cookie_secure']);
		}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	if ( $mode == 'newtopic' || $mode == 'reply')
	{
		$user_sig = ( $userdata['user_sig'] != '' && $board_config['allow_sig'] ) ? $userdata['user_sig'] : '';
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
		$template->assign_var_from_handle('ERROR_BOX', 'reg_header');
	}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	// get the sig to attach
	$user_sig = !empty($post_info['user_sig']) && $config->data['allow_sig'] ? $post_info['user_sig'] : '';
	$user_sig_bbcode_uid = $user_sig ? $post_info['user_sig_bbcode_uid'] : '';
	if ( ($mode == 'newtopic') || ($mode == 'reply') )
	{
		$user_sig = !empty($user->data['user_sig']) && $config->data['allow_sig'] ? $user->data['user_sig'] : '';
		$user_sig_bbcode_uid = $user_sig ? $user->data['user_sig_bbcode_uid'] : '';
	}

	if ( $preview )
	{
		$preview_subject = _censor($subject);
		$preview_username = _censor($username);
		$preview_sig = $attach_sig && !empty($user_sig) ? $user_sig : '';

		// parse the message
		$bbcode_uid = $bbcode_on ? make_bbcode_uid() : '';
		$preview_message = stripslashes(prepare_message(addslashes(unprepare_message($message)), $html_on, $bbcode_on, $smilies_on, $bbcode_uid));
		$message_parser = new message();
		$switches = array(
			'html' => $html_on,
			'bbcode' => $bbcode_on,
			'smilies' => $smilies_on,
		);
		$message_parser->parse($preview_message, $bbcode_uid, $switches);
		$message_parser->parse($preview_sig, $user_sig_bbcode_uid);
		unset($message_parser);

		$template->assign_block_vars('preview', array(
			'TOPIC_TITLE' => $preview_subject,
			'POST_SUBJECT' => $preview_subject,
			'POSTER_NAME' => $preview_username,
			'POST_DATE' => $user->date(time()),
			'MESSAGE' => $preview_message,
			'SIGNATURE' => $preview_sig,

			'L_POST_SUBJECT' => $user->lang('Post_subject'),
			'L_PREVIEW' => $user->lang('Preview'),
			'L_POSTED' => $user->lang('Posted'),
			'L_POST' => $user->lang('Post'),
			'I_POST' => $user->img('icon_minipost'),
		));
		$template->set_switch('preview.signature', !empty($preview_sig));

		// enhance the topic title
		$title_row = array_merge($post_info, array(
			'topic_type' => $topic_type,
			'topic_sub_type' => $topic_sub_type,
			'topic_duration' => $topic_duration,
			'post_icon' => $post_icon,
			'post_subject' => $subject,
			'post_sub_title' => $sub_title,
			'topic_sub_title' => ($post_data['first_post'] || ($mode == 'newtopic')) ? $sub_title : $post_info['topic_sub_title'],
		));

		// plugs
		if ( $config->plug_ins[$requester] )
		{
			foreach ( $config->plug_ins[$requester] as $plug => $dummy )
			{
				if ( method_exists($config->plug_ins[$requester][$plug], 'preview') )
				{
					$config->plug_ins[$requester][$plug]->preview();
				}
			}
		}

		$front_title = new front_title();
		$front_title->set('preview', $title_row, $post_data['first_post'] || ($mode == 'newtopic'));

		// send the preview
		$template->assign_vars(array('POST_PREVIEW_BOX' => $template->include_file('posting_preview.tpl')));
		$template->set_switch('preview_box');
	}

	// let's send error messages
	if ( !empty($error_msg) )
	{
		$template->assign_vars(array(
			'ERROR_MESSAGE' => $error_msg,
			'ERROR_BOX' => $template->include_file('error_body.tpl'),
		));
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		if ( $post_info['bbcode_uid'] != '' )
		{
			$message = preg_replace('/\:(([a-z0-9]:)?)' . $post_info['bbcode_uid'] . '/s', '', $message);
		}

		$message = str_replace('<', '&lt;', $message);
		$message = str_replace('>', '&gt;', $message);
		$message = str_replace('<br />', "\n", $message);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		$message = bbencode_decode($message, $post_info['bbcode_uid']);
		$message = _html_entities_encode($message, false);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$topic_type_toggle .= ' /> ' . $lang['Post_Announcement'] . '&nbsp;&nbsp;';
	}
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
	if ( $is_auth['auth_global_announce'] )
	{
		$topic_type_toggle .= '<input type="radio" name="topictype" value="' . POST_GLOBAL_ANNOUNCE . '"';
		if ( $post_data['topic_type'] == POST_GLOBAL_ANNOUNCE || $topic_type == POST_GLOBAL_ANNOUNCE )
		{
			$topic_type_toggle .= ' checked="checked"';
		}
		$topic_type_toggle .= ' /> ' . $user->lang('Post_Global_Announcement') . '&nbsp;&nbsp;';
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	'reviewbody' => 'posting_topic_review.tpl')
);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	'U_VIEW_FORUM' => append_sid("viewforum.$phpEx?" . POST_FORUM_URL . "=$forum_id"))
);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	'U_VIEW_FORUM' => $config->url(INDEX, array(POST_FORUM_URL => $forum_id), true),
));
$hidden_form_fields .= '<input type="hidden" name="last_post" value = "' . $topic_last_post_id . '" />';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	'L_BBCODE_B_HELP' => $lang['bbcode_b_help'], 
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
	//
	// note : all of this has been copied into includes/bbcode.php, function display_bbcodes()
	//
/*
#
#-----[ FIND ]------------------------------------------------
#
	'L_STYLES_TIP' => $lang['Styles_tip'], 
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	'U_REVIEW_TOPIC' => ( $mode == 'reply' ) ? append_sid("posting.$phpEx?mode=topicreview&amp;" . POST_TOPIC_URL . "=$topic_id") : '', 
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	'U_REVIEW_TOPIC' => $mode == 'reply' ? $config->url($requester, array('mode' => 'topicreview', POST_TOPIC_URL => intval($topic_id)), true) : '',
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	'S_POST_ACTION' => append_sid("posting.$phpEx"),
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	'S_POST_ACTION' => $config->url($requester, '', true),
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//
// Topic review
//
if( $mode == 'reply' && $is_auth['auth_read'] )
{
	require($phpbb_root_path . 'includes/topic_review.'.$phpEx);
	topic_review($topic_id, true);

	$template->assign_block_vars('switch_inline_mode', array());
	$template->assign_var_from_handle('TOPIC_REVIEW_BOX', 'reviewbody');
}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
// visual confirm for guests
if ( (!empty($error_msg) || !_button('post')) && $config->data['enable_confirm_post'] && !$user->data['session_logged_in'] && in_array($mode, array('newtopic', 'reply', 'quote')))
{
	$visual_confirm->display();
}

// poll form switch
$template->set_switch('poll_form', (($mode == 'newtopic') || (($mode == 'editpost') && $post_data['edit_poll'])) && $is_auth['auth_pollcreate']);
if ( (($mode == 'newtopic') || (($mode == 'editpost') && $post_data['edit_poll'])) && $is_auth['auth_pollcreate'] )
{
	$set_menu++;
}
$template->set_switch('left_part', $set_menu);

// topic review
if( (($mode == 'reply') || ($mode == 'editpost')) && $is_auth['auth_read'] )
{
	$template->assign_vars(array(
		'U_REVIEW_TOPIC' => $config->url($requester, array('mode' => 'topicreview') + ($mode == 'reply' ? array(POST_TOPIC_URL => $topic_id) : array(POST_POST_URL => $post_id)), true),
	));
	include($config->url('includes/topic_review'));
	topic_review($topic_id, $post_id, true, 'TOPIC_REVIEW_BOX');
}

// display navigation sentence
$forums->display_nav($forum_id);

// display bbcodes
display_bbcodes();

// display moderators
$moderators = new moderators();
$moderators->read();
$moderators->display('moderators', $forum_id);
unset($moderators);

// send the name of the topic if any, else send forum name
$template->assign_vars(array(
	'U_TITLE' => ($mode == 'newtopic') ? $config->url(INDEX, array(POST_FORUM_URL => $forum_id), true) : $config->url('viewtopic', array(POST_TOPIC_URL => $topic_id), true),
	'TITLE' => ($mode == 'newtopic') ? $forum_name : _censor($post_info['topic_title']),
	'I_SUBMIT' => $user->img('cmd_submit'),
	'I_PREVIEW' => $user->img('cmd_preview'),
	'I_CANCEL' => $user->img('cmd_cancel'),

// panel view
	'PID' => _read('pid', TYPE_INT),
));

// icons
$icons->display('ICON_BOX', $post_icon);

// environement
$template->set_switch('switch_standalone');
$template->set_switch('switch_standalone.switch_user_logged_in', $user->data['session_logged_in']);
$template->set_switch('switch_subject');
$template->set_switch('switch_sub_title', $sub_title_display);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
privmsg.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
include($phpbb_root_path . 'extension.inc');
include($phpbb_root_path . 'common.'.$phpEx);
include($phpbb_root_path . 'includes/bbcode.'.$phpEx);
include($phpbb_root_path . 'includes/functions_post.'.$phpEx);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
define('SID_CHECK', true);

$phpEx = substr(strrchr(__FILE__, '.'), 1);
$requester = 'privmsg';

include($phpbb_root_path . 'common.'.$phpEx);
include($config->url('includes/bbcode'));
include($config->url('includes/functions_post'));
include($config->url('includes/class_message'));

$user->use_lang(array('privmsg', 'class_forum', 'class_topics', 'class_posts', 'viewprofile', 'bbcodes'));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
// End session management
//
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
$boxes = array(
	'inbox' => array('txt' => 'Inbox', 'img' => 'pm_inbox'),
	'outbox' => array('txt' => 'Outbox', 'img' => 'pm_outbox'),
	'sentbox' => array('txt' => 'Sentbox', 'img' => 'pm_sentbox'),
	'savebox' => array('txt' => 'Savebox', 'img' => 'pm_savebox'),
);
$mode = _read('mode', TYPE_NO_HTML, '', $boxes);
if ( ($mode == 'edit') || ($mode == 'reply') || ($mode == 'quote') || ($mode == 'post') )
{
	$folder = 'outbox';
}
$navigation = new navigation();
$navigation->add($boxes[$folder]['txt'], '', $requester, array('folder' => $folder), '');
$navigation->display();

// no access for bots
if ( $user->data['session_is_bot'] )
{
	message_return('Not_Authorised');
}

// environement
$template->set_switch('switch_standalone');
$template->set_switch('switch_standalone.switch_user_logged_in', $user->data['session_logged_in']);
$template->set_switch('switch_subject');

// posting subject length
if ( intval($config->data['topic_title_length']) <= 0 )
{
	$config->set('topic_title_length', 60, true);
}
$template->assign_vars(array(
	'SUBJECT_LENGTH' => intval($config->data['topic_title_length']),

	'L_LEFT_PART' => $user->lang('Private_Message'),
	'I_SUBMIT' => $user->img('cmd_submit'),
	'I_PREVIEW' => $user->img('cmd_preview'),
	'I_CANCEL' => $user->img('cmd_cancel'),

	'L_GO' => $user->lang('Go'),
	'I_GO' => $user->img('cmd_mini_submit'),
// panel view
	'PID' => _read('pid', TYPE_INT),
));
$tpl_vars = array();
foreach ( $boxes as $box => $data )
{
	$box_tpl = strtoupper($box);
	$tpl_vars += array(
		'U_' . $box_tpl => $config->url($requester, array('folder' => $box), true),
		'L_' . $box_tpl => $user->lang($data['txt']),
		'I_' . $box_tpl => $user->img($data['img']),
	);
	$template->set_switch($box, $folder == $box);
}
$template->assign_vars($tpl_vars);

// we only want save button for inbox and outbox
$template->set_switch('save_button', ($folder == 'inbox') || ($folder == 'sentbox'));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$savebox_url = ( $folder != 'savebox' || $mode != '' ) ? '<a href="' . append_sid("privmsg.$phpEx?folder=savebox") . '">' . $lang['Savebox'] . '</a>' : $lang['Savebox'];
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
// plugs
if ( $config->plug_ins[$requester] )
{
	foreach ( $config->plug_ins[$requester] as $plug => $dummy )
	{
		if ( method_exists($config->plug_ins[$requester][$plug], 'start') )
		{
			$config->plug_ins[$requester][$plug]->start();
		}
	}
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$sql_priority = ( SQL_LAYER == 'mysql' ) ? 'LOW_PRIORITY' : '';
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$sql_priority = '';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
					message_die(GENERAL_ERROR, 'Could not delete oldest privmsgs text (sent)', '', __LINE__, __FILE__, $sql);
				}
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				// plugs
				if ( $config->plug_ins[$requester] )
				{
					foreach ( $config->plug_ins[$requester] as $plug => $dummy )
					{
						if ( method_exists($config->plug_ins[$requester][$plug], 'delete') )
						{
							$config->plug_ins[$requester][$plug]->delete($old_privmsgs_id);
						}
					}
				}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			message_die(GENERAL_ERROR, 'Could not insert private message sent text', '', __LINE__, __FILE__, $sql);
		}
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
		// plugs
		if ( $config->plug_ins[$requester] )
		{
			foreach ( $config->plug_ins[$requester] as $plug => $dummy )
			{
				if ( method_exists($config->plug_ins[$requester][$plug], 'duplicate') )
				{
					$config->plug_ins[$requester][$plug]->duplicate($privmsg, intval($privmsg_sent_id));
				}
			}
		}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	make_jumpbox('viewforum.'.$phpEx);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		'L_SENTBOX' => $lang['Sent'],
		'L_SAVEBOX' => $lang['Saved'],
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	$username_to = $privmsg['username_2'];
	$user_id_to = $privmsg['user_id_2'];
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
	// plugs
	if ( $config->plug_ins[$requester] )
	{
		foreach ( $config->plug_ins[$requester] as $plug => $dummy )
		{
			if ( method_exists($config->plug_ins[$requester][$plug], 'display_message') )
			{
				$config->plug_ins[$requester][$plug]->display_message($privmsg, $privmsgs_id);
			}
		}
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	if ( !empty($privmsg['user_viewemail']) || $userdata['user_level'] == ADMIN )
	{
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	if ( (!empty($privmsg['user_viewemail']) && empty($config->data['email_disable'])) || ($user->data['user_level'] == ADMIN) )
	{
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	//
	// If the board has HTML off but the post has HTML
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
	$private_message = str_replace("\n", '<br />', $private_message);
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	// get the sender display block
	if ( $privmsg['user_id_1'] == $user->data['user_id'] )
	{
		$view_user = $user;
	}
	else
	{
		$view_user = new user();
		$view_user->read($privmsg['user_id_1']);
	}

	// erase user sig if not attached
	if ( !$privmsg['privmsgs_attach_sig'] )
	{
		$view_user->data['user_sig'] = '';
		$view_user->data['user_sig_bbcode_uid'] = '';
	}

	// store the user
	$user->pool[ intval($view_user->data['user_id']) ] = $view_user->data;
	unset($view_user);

	// get poster info
	if ( !class_exists('topics') )
	{
		include($config->url('includes/class_topics'));
	}
	if ( !class_exists('posts') )
	{
		include($config->url('includes/class_posts'));
	}
	$poster_info = new posts($requester);
	$user_blocks = $poster_info->poster_block_vars($privmsg['user_id_1']);
	unset($poster_info);

	$tpl_switches = empty($user_blocks['switches']) ? array() : $user_blocks['switches'];
	$tpl_vars = empty($user_blocks['data']) ? array() : $user_blocks['data'];
	unset($user_blocks);

	// anon
	if ( $privmsg['user_id_1'] == ANONYMOUS )
	{
		$tpl_vars['POSTER_NAME'] = $user->lang('Guest');
	}

	// overwrite some vars: avatar, rank & sig
	$poster_avatar = !isset($tpl_vars['POSTER_AVATAR']) || empty($tpl_vars['POSTER_AVATAR']) ? '' : $template->sprintf('<img src="%s" alt="" border="0" />', $tpl_vars['POSTER_AVATAR']);
	$poster_rank = !isset($tpl_vars['L_POSTER_RANK']) || empty($tpl_vars['L_POSTER_RANK']) ? '' : $tpl_vars['L_POSTER_RANK'];
	$rank_image = !isset($tpl_vars['I_POSTER_RANK']) || empty($tpl_vars['I_POSTER_RANK']) ? '' : $template->sprintf('<img src="%s" alt="" title="%s" border="0" />', $tpl_vars['I_POSTER_RANK'], $poster_rank);

	// send to template
	if ( $tpl_vars )
	{
		$template->assign_vars($tpl_vars);
	}
	if ( $tpl_switches )
	{
		foreach ( $tpl_switches as $key => $value )
		{
			$template->set_switch($key, $value);
		}
	}

	// author panel constants
	$template->assign_vars(array(
		// legend
		'L_POSTER_POSTS' => $user->lang('Posts'),
		'L_POSTER_FROM' => $user->lang('Location'),
		'L_POSTER_JOINED' => $user->lang('Joined'),
		// users buttons
		'I_POSTER_PROFILE' => $user->img('icon_profile'),
		'L_POSTER_PROFILE' => $user->lang('Read_profile'),
		'I_POSTER_SEARCH' => $user->img('icon_search'),
		'I_POSTER_PM' => $user->img('icon_pm'),
		'L_POSTER_PM' => $user->lang('Send_private_message'),
		'I_POSTER_EMAIL' => $user->img('icon_email'),
		'L_POSTER_EMAIL' => $user->lang('Send_email'),
		'I_POSTER_WWW' => $user->img('icon_www'),
		'L_POSTER_WWW' => $user->lang('Visit_website'),
		'I_POSTER_ICQ' => $user->img('icon_icq'),
		'L_POSTER_ICQ' => $user->lang('ICQ'),
		'I_POSTER_AIM' => $user->img('icon_aim'),
		'L_POSTER_AIM' => $user->lang('AIM'),
		'I_POSTER_MSN' => $user->img('icon_msnm'),
		'L_POSTER_MSN' => $user->lang('MSNM'),
		'I_POSTER_YIM' => $user->img('icon_yim'),
		'L_POSTER_YIM' => $user->lang('YIM'),
		// back to top
		'I_BACK_TO_TOP' => $user->img('icon_go_top'),
		'L_BACK_TO_TOP' => $user->lang('Back_to_top'),
	));

	// other message components
	$post_subject = _censor($post_subject);

	// parse message & sig
	$message_parser = new message();
	$switches = array(
		'html' => $privmsg['privmsgs_enable_html'],
		'bbcode' => !empty($bbcode_uid),
		'smilies' => $privmsg['privmsgs_enable_smilies'],
	);
	$message_parser->parse($private_message, $bbcode_uid, $switches);
	unset($message_parser);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		'POSTER_POSTS' => $poster_posts,
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			$delete_text_sql = "DELETE FROM " . PRIVMSGS_TEXT_TABLE . "
				WHERE privmsgs_text_id IN ($delete_sql_id)";
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
				message_die(GENERAL_ERROR, 'Could not delete private message text', '', __LINE__, __FILE__, $delete_text_sql);
			}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
			// the privmsgs_ids are already certified, so let's make sure we won't desynchronize the texts and headers
			$sql = 'DELETE FROM ' . PRIVMSGS_TABLE . '
						WHERE privmsgs_id IN(' . implode(', ', $mark_list) . ')';
			$db->sql_query($sql, BEGIN_TRANSACTION, __LINE__, __FILE__);

			$sql = 'DELETE FROM ' . PRIVMSGS_TEXT_TABLE . '
						WHERE privmsgs_text_id IN(' . implode(', ', $mark_list) . ')';
			$db->sql_query($sql, END_TRANSACTION, __LINE__, __FILE__);

			// plugs
			if ( $config->plug_ins[$requester] )
			{
				foreach ( $config->plug_ins[$requester] as $plug => $dummy )
				{
					if ( method_exists($config->plug_ins[$requester][$plug], 'delete') )
					{
						$config->plug_ins[$requester][$plug]->delete($mark_list);
					}
				}
			}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$sql_priority = ( SQL_LAYER == 'mysql' ) ? 'LOW_PRIORITY' : '';
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$sql_priority = '';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
					message_die(GENERAL_ERROR, 'Could not delete oldest privmsgs text (save)', '', __LINE__, __FILE__, $sql);
				}
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				// plugs
				if ( $config->plug_ins[$requester] )
				{
					foreach ( $config->plug_ins[$requester] as $plug => $dummy )
					{
						if ( method_exists($config->plug_ins[$requester][$plug], 'delete') )
						{
							$config->plug_ins[$requester][$plug]->delete($old_privmsgs_id);
						}
					}
				}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		if ($sid == '' || $sid != $userdata['session_id'])
		{
			$error = true;
			$error_msg .= ( ( !empty($error_msg) ) ? '<br />' : '' ) . $lang['Session_invalid'];
		}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		if ( SID_CHECK && (!($sid = _read_form('sid', TYPE_NO_HTML)) || ($sid != $user->data['session_id'])) )
		{
			_error('Session_invalid');
		}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			$sql_priority = ( SQL_LAYER == 'mysql' ) ? 'LOW_PRIORITY' : '';
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			$sql_priority = '';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			message_die(GENERAL_ERROR, "Could not insert/update private message sent text.", "", __LINE__, __FILE__, $sql);
		}
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
		// plugs
		if ( $config->plug_ins[$requester] )
		{
			foreach ( $config->plug_ins[$requester] as $plug => $dummy )
			{
				if ( method_exists($config->plug_ins[$requester][$plug], 'submit') )
				{
					$config->plug_ins[$requester][$plug]->submit();
				}
			}
		}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$privmsg_message = ( isset($HTTP_POST_VARS['message']) ) ? trim($HTTP_POST_VARS['message']) : '';
		// $privmsg_message = preg_replace('#<textarea>#si', '&lt;textarea&gt;', $privmsg_message);
		if ( !$preview )
		{
			$privmsg_message = stripslashes($privmsg_message);
		}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		$privmsg_message = ( isset($HTTP_POST_VARS['message']) ) ? trim(stripslashes($HTTP_POST_VARS['message'])) : '';
		$privmsg_message = _html_entities_encode($privmsg_message, false);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			if ( $privmsg_bbcode_enabled )
			{
				$privmsg_message = preg_replace("/\:(([a-z0-9]:)?)$privmsg_bbcode_uid/si", '', $privmsg_message);
			}
			
			$privmsg_message = str_replace('<br />', "\n", $privmsg_message);
			// $privmsg_message = preg_replace('#</textarea>#si', '&lt;/textarea&gt;', $privmsg_message);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
			$privmsg_message = bbencode_decode($privmsg_message, $privmsg['privmsgs_bbcode_uid']);
			$privmsg_message = _html_entities_encode($privmsg_message, false);
			if ( !$submit && !$refresh )
			{
				$html_on = $config->data['allow_html'] && intval($privmsg['privmsgs_enable_html']);
				$bbcode_on = $config->data['allow_bbcode'] && $privmsg_bbcode_enabled;
				$smilies_on = $config->data['allow_smilies'] && intval($privmsg['privmsgs_enable_smilies']);
				$attach_sig = $config->data['allow_sig'] && intval($privmsg['privmsgs_attach_sig']) && !empty($privmsg['user_sig']);
			}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
				$privmsg_message = preg_replace("/\:(([a-z0-9]:)?)$privmsg_bbcode_uid/si", '', $privmsg_message);
				$privmsg_message = str_replace('<br />', "\n", $privmsg_message);
				// $privmsg_message = preg_replace('#</textarea>#si', '&lt;/textarea&gt;', $privmsg_message);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
				$privmsg_message = bbencode_decode($privmsg_message, $privmsg['privmsgs_bbcode_uid'], true);
				$privmsg_message = _html_entities_encode($privmsg_message, false);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$message = $lang['Cannot_send_privmsg'];
		message_die(GENERAL_MESSAGE, $message);
	}
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	// plugs
	if ( !$error && $config->plug_ins[$requester] )
	{
		foreach ( $config->plug_ins[$requester] as $plug => $dummy )
		{
			if ( method_exists($config->plug_ins[$requester][$plug], 'set_form') )
			{
				$config->plug_ins[$requester][$plug]->set_form();
			}
		}
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$orig_word = array();
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
		$template->assign_var_from_handle('POST_PREVIEW_BOX', 'preview');
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		$bbcode_uid = $bbcode_on ? make_bbcode_uid() : '';

		$to_username = !empty($HTTP_POST_VARS['username']) ? htmlspecialchars(trim(stripslashes($HTTP_POST_VARS['username']))) : '';
		$preview_subject = !empty($HTTP_POST_VARS['subject']) ? htmlspecialchars(trim(stripslashes($HTTP_POST_VARS['subject']))) : '';
		$preview_message = !empty($HTTP_POST_VARS['message']) ? htmlspecialchars(trim(stripslashes($HTTP_POST_VARS['message']))) : '';

		$preview_subject = _censor($preview_subject);
		$preview_message = stripslashes(prepare_message(addslashes(unprepare_message($preview_message)), $html_on, $bbcode_on, $smilies_on, $bbcode_uid));
		$preview_user_sig = $attach_sig && $user_sig ? $user_sig : '';

		// parse message & sig
		$message_parser = new message();
		$switches = array(
			'html' => $html_on,
			'bbcode' => $bbcode_on,
			'smilies' => $smilies_on,
		);
		$message_parser->parse($preview_message, $bbcode_uid, $switches);
		$message_parser->parse($preview_user_sig, $user->data['user_sig_bbcode_uid']);
		unset($message_parser);

		// hide some vars
		_hide('folder', $folder, true);
		_hide('mode', $mode, true);
		_hide(POST_POST_URL, $privmsg_id);
		_hide_set();

		$template->assign_block_vars('preview', array(
			'TOPIC_TITLE' => $preview_subject,
			'POST_SUBJECT' => $preview_subject,
			'MESSAGE_TO' => $to_username, 
			'MESSAGE_FROM' => $user->data['username'], 
			'POST_DATE' => $user->date(),
			'MESSAGE' => $preview_message,
			'SIGNATURE' => $preview_user_sig,

			'S_HIDDEN_FIELDS' => $s_hidden_fields,

			'L_SUBJECT' => $user->lang('Subject'),
			'L_DATE' => $user->lang('Date'),
			'L_FROM' => $user->lang('From'),
			'L_TO' => $user->lang('To'),
			'L_PREVIEW' => $user->lang('Preview'),
			'L_POSTED' => $user->lang('Posted'),
		));
		$template->set_switch('preview.signature', !empty($preview_user_sig));

		// plugs
		if ( $config->plug_ins[$requester] )
		{
			foreach ( $config->plug_ins[$requester] as $plug => $dummy )
			{
				if ( method_exists($config->plug_ins[$requester][$plug], 'preview') )
				{
					$config->plug_ins[$requester][$plug]->preview();
				}
			}
		}

		// include the tpl
		$template->assign_vars(array('POST_PREVIEW_BOX' => $template->include_file('privmsgs_preview.tpl', 'preview')));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$privmsg_message = htmlspecialchars($privmsg_message);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	make_jumpbox('viewforum.'.$phpEx);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		'L_BBCODE_B_HELP' => $lang['bbcode_b_help'], 
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
		//
		// note : all of this has been copied into includes/bbcode.php, function display_bbcodes()
		//
/*
#
#-----[ FIND ]------------------------------------------------
#
		'L_STYLES_TIP' => $lang['Styles_tip'], 
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		'U_VIEW_FORUM' => append_sid("privmsg.$phpEx"))
	);
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
	display_bbcodes();
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
make_jumpbox('viewforum.'.$phpEx);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
if ( $folder != 'outbox' )
{
	$inbox_limit_pct = ( $board_config['max_' . $folder . '_privmsgs'] > 0 ) ? round(( $pm_all_total / $board_config['max_' . $folder . '_privmsgs'] ) * 100) : 100;
	$inbox_limit_img_length = ( $board_config['max_' . $folder . '_privmsgs'] > 0 ) ? round(( $pm_all_total / $board_config['max_' . $folder . '_privmsgs'] ) * $board_config['privmsg_graphic_length']) : $board_config['privmsg_graphic_length'];
	$inbox_limit_remain = ( $board_config['max_' . $folder . '_privmsgs'] > 0 ) ? $board_config['max_' . $folder . '_privmsgs'] - $pm_all_total : 0;

	$template->assign_block_vars('switch_box_size_notice', array());

	switch( $folder )
	{
		case 'inbox':
			$l_box_size_status = sprintf($lang['Inbox_size'], $inbox_limit_pct);
			break;
		case 'sentbox':
			$l_box_size_status = sprintf($lang['Sentbox_size'], $inbox_limit_pct);
			break;
		case 'savebox':
			$l_box_size_status = sprintf($lang['Savebox_size'], $inbox_limit_pct);
			break;
		default:
			$l_box_size_status = '';
			break;
	}
}
else
{
	$inbox_limit_img_length = $inbox_limit_pct = $l_box_size_status = '';
}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$boxes = array(
	'inbox' => array('txt' => 'Inbox_size', 'max' => 'max_inbox_privmsgs'),
	'sentbox' => array('txt' => 'Sentbox_size', 'max' => 'max_sentbox_privmsgs'),
	'savebox' => array('txt' => 'Savebox_size', 'max' => 'max_savebox_privmsgs'),
);
if ( isset($boxes[$folder]) )
{
	$template->assign_vars(array('PM_QUOTA_BOX' => get_quota_box($boxes[$folder]['txt'], $pm_all_total, $config->data[ $boxes[$folder]['max'] ])));
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	'INBOX_LIMIT_IMG_WIDTH' => $inbox_limit_img_length, 
	'INBOX_LIMIT_PERCENT' => $inbox_limit_pct, 

	'BOX_SIZE_STATUS' => $l_box_size_status, 
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	'L_SENTBOX' => $lang['Sent'],
	'L_SAVEBOX' => $lang['Saved'],
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
if ( !($result = $db->sql_query($sql)) )
{
	message_die(GENERAL_ERROR, 'Could not query private messages', '', __LINE__, __FILE__, $sql);
}

if ( $row = $db->sql_fetchrow($result) )
{
	$i = 0;
	do
	{
		$privmsg_id = $row['privmsgs_id'];
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$result = $db->sql_query($sql, false, __LINE__, __FILE__);
$rows = array();
while ( $row = $db->sql_fetchrow($result) )
{
	$rows[ intval($row['privmsgs_id']) ] = $row;
}
$db->sql_freeresult($result);

if ( !empty($rows) )
{
	// plugs
	if ( $config->plug_ins[$requester] )
	{
		foreach ( $config->plug_ins[$requester] as $plug => $dummy )
		{
			if ( method_exists($config->plug_ins[$requester][$plug], 'format_rows') )
			{
				$config->plug_ins[$requester][$plug]->format_rows($rows);
			}
		}
	}

	$i = 0;
	foreach ( $rows as $privmsg_id => $row )
	{
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	}
	while( $row = $db->sql_fetchrow($result) );

	$template->assign_vars(array(
		'PAGINATION' => generate_pagination("privmsg.$phpEx?folder=$folder", $pm_total, $board_config['topics_per_page'], $start),
		'PAGE_NUMBER' => sprintf($lang['Page_of'], ( floor( $start / $board_config['topics_per_page'] ) + 1 ), ceil( $pm_total / $board_config['topics_per_page'] )), 

		'L_GOTO_PAGE' => $lang['Goto_page'])
	);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		$template->set_switch('listrow.light', !($i % 2));

		// plugs
		if ( $config->plug_ins[$requester] )
		{
			foreach ( $config->plug_ins[$requester] as $plug => $dummy )
			{
				if ( method_exists($config->plug_ins[$requester][$plug], 'display_row') )
				{
					$config->plug_ins[$requester][$plug]->display_row($row);
				}
			}
		}
	}
	unset($rows);
	$pagination = new pagination($requester, array('folder' => $folder));
	$pagination->display('pagination', $pm_total, intval($board_config['topics_per_page']), $start, true, 'Pms_count');
	unset($pagination);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_disallow.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$phpbb_root_path = "./../";
require($phpbb_root_path . 'extension.inc');
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$phpbb_root_path = './../';
$phpEx = substr(strrchr(__FILE__, '.'), 1);
$requester = 'admin/admin_disallow';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$disallow_select = '<select name="disallowed_id">';

if( trim($disallowed) == "" )
{
	$disallow_select .= '<option value="">' . $lang['no_disallowed'] . '</option>';
}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$disallow_select = '<select name="disallowed_id" id="disallowed_id">';
if ( empty($disallowed) )
{
	$disallow_select .= '<option value="">' . $lang['No_disallowed'] . '</option>';
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_groups.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
require($phpbb_root_path . 'extension.inc');
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$phpEx = substr(strrchr(__FILE__, '.'), 1);
$requester = 'admin/admin_groups';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
else
{
	$mode = '';
}
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
include($config->url('includes/class_forums'));
include($config->url('includes/class_cp'));

// get styles available
$styles_available = get_list_styles_dft();

$user->get_cache(POST_GROUPS_URL);
$user_groups_list = $user->get_groups_list();

// auth
$auth_manage = false;

// level
$is_founder = $user->data['session_logged_in'] && in_array(GROUP_FOUNDER, $user_groups_list);
$is_admin = $user->data['session_logged_in'] && in_array(GROUP_ADMIN, $user_groups_list);
$is_owner = false;

// read group
if ( _button('new') || ($mode == 'newgroup') )
{
	$group_id = 0;
}
else
{
	$group_id = _read(POST_GROUPS_URL, TYPE_INT);
}
$group_status = GROUP_STANDARD;
$group_row = array();
if ( !empty($group_id) )
{
	$sql = 'SELECT *
				FROM ' . GROUPS_TABLE . '
				WHERE group_id = ' . intval($group_id) . '
					AND group_single_user <> ' . true . '
					AND group_status < ' . GROUP_SPECIAL;
	$result = $db->sql_query($sql, false, __LINE__, __FILE__);
	if ( $group_row = $db->sql_fetchrow($result) )
	{
		if ( !isset($styles_available[ $group_row['group_style'] ]) )
		{
			$group_row['group_style'] = 0;
		}
		$group_status = intval($group_row['group_status']);
		$is_owner = $user->data['session_logged_in'] && (intval($group_row['group_moderator']) == $user->data['user_id']);
	}
	$db->sql_freeresult($result);
}

switch ( $group_id )
{
	case GROUP_FOUNDER:
		$auth_manage = $is_owner;
		break;
	case GROUP_ADMIN:
		$auth_manage = $is_founder;
		break;
	case 0: // GROUP_ALL:
		if ( _button('new') || ($mode == 'newgroup') )
		{
			$auth_manage = $is_founder || $is_admin;
		}
	default:
		$auth_manage = $is_owner || $is_founder || $is_admin;
		break;
}
if ( !empty($group_id) || (!_button('new') && ($mode != 'newgroup')) )
{
	// check group
	if ( !empty($group_id) && empty($group_row) )
	{
		_error('Group_not_exist');
	}

	// check management auth
	if ( !$auth_manage )
	{
		_error('Manage_group_denied');
	}

	// send error
	if ( $error )
	{
		$l_link = 'Click_return_groupsadmin';
		$u_link = $config->url('admin/admin_groups', '', true);
		message_return($error_msg, $l_link, $u_link);
	}
}

// plugs
if ( $config->plug_ins[$requester] )
{
	foreach ( $config->plug_ins[$requester] as $plug => $dummy )
	{
		if ( method_exists($config->plug_ins[$requester][$plug], 'start') )
		{
			$config->plug_ins[$requester][$plug]->start();
		}
	}
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$sql = "SELECT *
			FROM " . GROUPS_TABLE . "
			WHERE group_single_user <> " . TRUE . "
			AND group_id = $group_id";
		if ( !($result = $db->sql_query($sql)) )
		{
			message_die(GENERAL_ERROR, 'Error getting group information', '', __LINE__, __FILE__, $sql);
		}

		if ( !($group_info = $db->sql_fetchrow($result)) )
		{
			message_die(GENERAL_MESSAGE, $lang['Group_not_exist']);
		}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		$group_info = $group_row;
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$mode = 'newgroup';
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$group_info['group_status'] = GROUP_STANDARD;
		$group_info['group_style'] = 0;
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	if ($group_info['group_moderator'] != '')
	{
		$sql = "SELECT user_id, username
			FROM " . USERS_TABLE . "
			WHERE user_id = " . $group_info['group_moderator'];
		if ( !($result = $db->sql_query($sql)) )
		{
			message_die(GENERAL_ERROR, 'Could not obtain user info for moderator list', '', __LINE__, __FILE__, $sql);
		}

		if ( !($row = $db->sql_fetchrow($result)) )
		{
			message_die(GENERAL_ERROR, 'Could not obtain user info for moderator list', '', __LINE__, __FILE__, $sql);
		}

		$group_moderator = $row['username'];
	}
	else
	{
		$group_moderator = '';
	}

	$group_open = ( $group_info['group_type'] == GROUP_OPEN ) ? ' checked="checked"' : '';
	$group_closed = ( $group_info['group_type'] == GROUP_CLOSED ) ? ' checked="checked"' : '';
	$group_hidden = ( $group_info['group_type'] == GROUP_HIDDEN ) ? ' checked="checked"' : '';
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	if ( $group_info['group_moderator'] == ANONYMOUS )
	{
		$group_info['group_moderator'] = 0;
	}
	if ( intval($group_info['group_moderator']) )
	{
		$sql = 'SELECT username
					FROM ' . USERS_TABLE . '
					WHERE user_id = ' . intval($group_info['group_moderator']);
		$result = $db->sql_query($sql, false, __LINE__, __FILE__);
		$group_moderator = ($row = $db->sql_fetchrow($result)) ? $row['username'] : '';
		$db->sql_freeresult($result);
	}
	else
	{
		$group_moderator = '';
	}

	$group_open = ( $group_info['group_type'] == GROUP_OPEN ) ? ' checked="checked"' : '';
	$group_closed = ( $group_info['group_type'] == GROUP_CLOSED ) ? ' checked="checked"' : '';
	$group_hidden = ( $group_info['group_type'] == GROUP_HIDDEN ) ? ' checked="checked"' : '';
	$s_group_sysstatus_std = (intval($group_info['group_status']) == GROUP_STANDARD) ? ' checked="checked"' : '';
	$s_group_sysstatus_sys = (intval($group_info['group_status']) != GROUP_STANDARD) ? ' checked="checked"' : '';
	$template->assign_vars(array(
		'L_GROUP_SYSSTATUS' => $user->lang('System_group'),
		'S_GROUP_SYSSTATUS_STD' => $s_group_sysstatus_std,
		'GROUP_SYSSTATUS_STD' => GROUP_STANDARD,
		'S_GROUP_SYSSTATUS_SYS' => $s_group_sysstatus_sys,
		'GROUP_SYSSTATUS_SYS' => GROUP_SYSTEM,
		'L_YES' => $user->lang('Yes'),
		'L_NO' => $user->lang('No'),
		'L_GROUP_STYLE' => $user->lang('Group_style'),
		'L_GROUP_STYLE_EXPLAIN' => $user->lang('Group_style_explain'),
	));
	foreach ( $styles_available as $style_id => $style_name )
	{
		$template->assign_block_vars('style', array(
			'STYLE_ID' => $style_id,
			'STYLE_NAME' => $style_name,
		));
		$template->set_switch('style.selected', intval($group_info['group_style']) == $style_id);
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		//
		// Reset User Moderator Level
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
						message_die(GENERAL_ERROR, 'Could not update moderator permissions', '', __LINE__, __FILE__, $sql);
					}
				}
			}
		}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		// check if it is a system group
		if ( $group_row['group_status'] == GROUP_SYSTEM )
		{
			$l_link = 'Click_return_groupsadmin';
			$u_link = $config->url('admin/admin_groups', array(POST_GROUPS_URL => intval($group_id)), true);
			message_return('Delete_sysgroup_denied', $l_link, $u_link);
		}

		// users to update
		$user_ids = array();

		// get all members of this group
		$sql = 'SELECT user_id
					FROM ' . USER_GROUP_TABLE . '
					WHERE group_id = ' . intval($group_id) . '
						AND user_pending <> 1';
		$result = $db->sql_query($sql, false, __LINE__, __FILE__);
		while ( $row = $db->sql_fetchrow($result) )
		{
			if ( !empty($row['user_id']) )
			{
				$user_ids[ intval($row['user_id']) ] = true;
			}
		}
		$db->sql_freeresult($result);

		// get users having auths specific to this group
		$sql = 'SELECT DISTINCT ug.user_id
					FROM ' . AUTHS_TABLE . ' a, ' . USER_GROUP_TABLE . ' ug
					WHERE ug.group_id = a.group_id
						AND ug.user_pending <> 1
						AND a.obj_type = \'' . POST_GROUPS_URL . '\'
						AND a.obj_id = ' . intval($group_id) . '
					GROUP BY ug.user_id';
		$result = $db->sql_query($sql, false, __LINE__, __FILE__);
		$user_ids = array();
		while ( $row = $db->sql_fetchrow($result) )
		{
			if ( !empty($row['user_id']) )
			{
				$user_ids[ intval($row['user_id']) ] = true;
			}
		}
		$db->sql_freeresult($result);

		// delete auths relative to this group
		$sql = 'DELETE FROM ' . AUTHS_TABLE . '
					WHERE group_id = ' . intval($group_id) . '
						OR (obj_type = \'' . POST_GROUPS_URL . '\' AND obj_id = ' . intval($group_id) . ')';
		$db->sql_query($sql, false, __LINE__, __FILE__);

		// delete user caches
		if ( !empty($user_ids) )
		{
			$sql = 'DELETE FROM ' . USERS_CACHE_TABLE . '
						WHERE user_id IN(' . implode(', ', array_keys($user_ids)) . ')';
			$db->sql_query($sql, false, __LINE__, __FILE__);
		}
		unset($user_ids);

		// remove group style
		if ( intval($group_row['group_style']) )
		{
			$sql = 'UPDATE ' . GROUPS_TABLE . '
						SET group_style = 0
						WHERE group_user_id IN(' . $db->sql_subquery('user_id', '
								SELECT DISTINCT user_id
									FROM ' . USER_GROUP_TABLE . '
									WHERE group_id = ' . intval($group_id) . '
										AND user_pending <> 1
								', __LINE__, __FILE__) . ')
							AND group_style = ' . intval($group_row['group_style']);
			$db->sql_query($sql, false, __LINE__, __FILE__);
		}

		// reset the users mod status
		$moderators = new moderators();
		$moderators->set_users_status();
		unset($moderators);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$sql = "DELETE FROM " . AUTH_ACCESS_TABLE . "
			WHERE group_id = " . $group_id;
		if ( !$db->sql_query($sql) )
		{
			message_die(GENERAL_ERROR, 'Could not update auth_access', '', __LINE__, __FILE__, $sql);
		}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		if ( $group_name == '' )
		{
			message_die(GENERAL_MESSAGE, $lang['No_group_name']);
		}
		else if ( $group_moderator == '' )
		{
			message_die(GENERAL_MESSAGE, $lang['No_group_moderator']);
		}
		
		$this_userdata = get_userdata($group_moderator, true);
		$group_moderator = $this_userdata['user_id'];

		if ( !$group_moderator )
		{
			message_die(GENERAL_MESSAGE, $lang['No_group_moderator']);
		}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		$group_style = _read('group_style', TYPE_INT, 0, $styles_available);
		$group_status = _read('group_status', TYPE_INT);
		$group_status_available = array_flip(array(GROUP_STANDARD, GROUP_SYSTEM));
		$sys_groups = array_flip(array(GROUP_FOUNDER, GROUP_ADMIN, GROUP_REGISTERED, GROUP_ANONYMOUS));

		// check the group system status value
		if ( !isset($group_status_available[$group_status]) )
		{
			_error('Unknown_group_sysstatus');
		}

		// check if we can remove this system status
		if ( isset($sys_groups[ intval($group_id) ]) && ($group_status != GROUP_SYSTEM) )
		{
			_error('Change_sysgroup_denied');
		}

		// check group type towards group status
		if ( (intval($group_status) >= GROUP_SYSTEM) && ($group_type < GROUP_CLOSED) )
		{
			_error('Change_sysgroup_type_denied');
		}

		// send error
		if ( $error )
		{
			$l_link = 'Click_return_groupsadmin';
			$u_link = $config->url('admin/admin_groups', array(POST_GROUPS_URL => intval($group_id)), true);
			message_return($error_msg, $l_link, $u_link);
		}

		if ( $group_name == '' )
		{
			message_die(GENERAL_MESSAGE, 'No_group_name');
		}
		else if ( empty($group_moderator) && ($mode == 'editgroup') && ($group_id == GROUP_FOUNDER) )
		{
			message_die(GENERAL_MESSAGE, 'No_group_moderator');
		}

		if ( !empty($group_moderator) )
		{
			$this_userdata = get_userdata($group_moderator, true);
			if ( !$group_moderator = $this_userdata['user_id'] )
			{
				message_die(GENERAL_MESSAGE, 'No_group_moderator');
			}
		}
		else
		{
			$group_moderator = 0;
		}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			if ( $group_info['group_moderator'] != $group_moderator )
			{
				if ( $delete_old_moderator )
				{
					$sql = "DELETE FROM " . USER_GROUP_TABLE . "
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
			$sql = "UPDATE " . GROUPS_TABLE . "
				SET group_type = $group_type, group_name = '" . str_replace("\'", "''", $group_name) . "', group_description = '" . str_replace("\'", "''", $group_description) . "', group_moderator = $group_moderator 
				WHERE group_id = $group_id";
			if ( !$db->sql_query($sql) )
			{
				message_die(GENERAL_ERROR, 'Could not update group', '', __LINE__, __FILE__, $sql);
			}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
			if ( $group_info['group_moderator'] != $group_moderator )
			{
				if ( $delete_old_moderator )
				{
					if ( intval($group_info['group_moderator']) )
					{
						// recache old moderator
						$sql = 'DELETE FROM ' . USERS_CACHE_TABLE . '
									WHERE user_id = ' . intval($group_info['group_moderator']);
						$db->sql_query($sql, false, __LINE__, __FILE__);

						// remove style if any
						if ( intval($group_row['group_style']) )
						{
							$sql = 'UPDATE ' . GROUPS_TABLE . '
										SET group_style = 0
										WHERE group_user_id = ' . intval($group_info['group_moderator']) . '
											AND group_style = ' . intval($group_row['group_style']);
							$db->sql_query($sql, false, __LINE__, __FILE__);
						}

						// remove the link to the group
						$sql = 'DELETE FROM ' . USER_GROUP_TABLE . '
									WHERE user_id = ' . intval($group_info['group_moderator']) . '
										AND group_id = ' . intval($group_id);
						$db->sql_query($sql, false, __LINE__, __FILE__);
					}
				}

				// add the moderator to the group
				if ( intval($group_moderator) )
				{
					$sql = 'SELECT user_id
								FROM ' . USER_GROUP_TABLE . '
								WHERE user_id = ' . intval($group_moderator) . '
									AND group_id = ' . intval($group_id);
					$result = $db->sql_query($sql, false, __LINE__, __FILE__);
					$found = ($row = $db->sql_fetchrow($result));
					$db->sql_freeresult($result);
					if ( !$found )
					{
						$fields = array(
							'user_id' => intval($group_moderator),
							'group_id' => intval($group_id),
							'user_pending' => 0,
						);
						$db->sql_statement($fields);
						$sql = 'INSERT INTO ' . USER_GROUP_TABLE . '
									(' . $db->sql_fields . ') VALUES(' . $db->sql_values . ')';
						$db->sql_query($sql, false, __LINE__, __FILE__);
					}
				}
			}

			// update group
			$fields = array(
				'group_type' => intval($group_type),
				'group_status' => intval($group_status),
				'group_style' => intval($group_style),
				'group_name' => stripslashes($group_name),
				'group_description' => stripslashes($group_description),
				'group_moderator' => intval($group_moderator),
			);
			$db->sql_statement($fields);
			$sql = 'UPDATE ' . GROUPS_TABLE . '
						SET ' . $db->sql_update . '
						WHERE group_id = ' . intval($group_id);
			$db->sql_query($sql, false, __LINE__, __FILE__);

			// recache group moderator
			if ( intval($group_moderator) )
			{
				$sql = 'DELETE FROM ' . USERS_CACHE_TABLE . '
							WHERE user_id = ' . intval($group_moderator);
				$db->sql_query($sql, false, __LINE__, __FILE__);
			}

			// set group style
			$old_style = intval($group_row['group_style']);
			$new_style = intval($group_style);
			if ( $old_style || $new_style )
			{
				$sql = 'UPDATE ' . GROUPS_TABLE . '
							SET group_style = ' . $new_style . '
							WHERE group_style = ' . $old_style . '
								AND group_user_id IN(' . $db->sql_subquery('user_id', '
									SELECT DISTINCT user_id
										FROM ' . USER_GROUP_TABLE . '
										WHERE user_pending = 0
											AND group_id = ' . intval($group_id) . '
								', __LINE__, __FILE__) . ')';
				$db->sql_query($sql, false, __LINE__, __FILE__);
			}

			// reset the users mod status
			$moderators = new moderators();
			$moderators->set_users_status();
			unset($moderators);

			// reset bots
			$bots = new bots();
			$bots->read(true);
			unset($bots);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			$sql = "INSERT INTO " . GROUPS_TABLE . " (group_type, group_name, group_description, group_moderator, group_single_user) 
				VALUES ($group_type, '" . str_replace("\'", "''", $group_name) . "', '" . str_replace("\'", "''", $group_description) . "', $group_moderator,	'0')";
			if ( !$db->sql_query($sql) )
			{
				message_die(GENERAL_ERROR, 'Could not insert new group', '', __LINE__, __FILE__, $sql);
			}
			$new_group_id = $db->sql_nextid();

			$sql = "INSERT INTO " . USER_GROUP_TABLE . " (group_id, user_id, user_pending)
				VALUES ($new_group_id, $group_moderator, 0)";
			if ( !$db->sql_query($sql) )
			{
				message_die(GENERAL_ERROR, 'Could not insert new user-group info', '', __LINE__, __FILE__, $sql);
			}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
			$fields = array(
				'group_type' => intval($group_type),
				'group_status' => intval($group_status),
				'group_style' => intval($group_style),
				'group_name' => stripslashes($group_name),
				'group_description' => stripslashes($group_description),
				'group_moderator' => intval($group_moderator),
				'group_single_user' => 0,
			);
			$db->sql_statement($fields);
			$sql = 'INSERT INTO ' . GROUPS_TABLE . '
						(' . $db->sql_fields . ') VALUES(' . $db->sql_values . ')';
			$db->sql_query($sql, false, __LINE__, __FILE__);
			$new_group_id = $db->sql_nextid();

			if ( intval($group_moderator) )
			{
				$fields = array(
					'group_id' => intval($new_group_id),
					'user_id' => intval($group_moderator),
					'user_pending' => 0,
				);
				$db->sql_statement($fields);
				$sql = 'INSERT INTO ' . USER_GROUP_TABLE . '
							(' . $db->sql_fields . ') VALUES(' . $db->sql_values . ')';
				$db->sql_query($sql, false, __LINE__, __FILE__);

				// recache group moderator
				$sql = 'DELETE FROM ' . USERS_CACHE_TABLE . '
							WHERE user_id = ' . intval($group_moderator);
				$db->sql_query($sql, false, __LINE__, __FILE__);

				// set style
				if ( intval($group_style) )
				{
					$sql = 'UPDATE ' . GROUPS_TABLE . '
								SET group_style = ' . intval($group_style) . '
								WHERE group_style = 0
									AND group_user_id = ' . intval($group_moderator);
					$db->sql_query($sql, false, __LINE__, __FILE__);
				}

				// reset the users mod status
				$moderators = new moderators();
				$moderators->set_users_status();
				unset($moderators);

				// reset bots
				$bots = new bots();
				$bots->read(true);
				unset($bots);
			}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	$sql = "SELECT group_id, group_name
		FROM " . GROUPS_TABLE . "
		WHERE group_single_user <> " . TRUE . "
		ORDER BY group_name";
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	$sql = str_replace('SELECT ', 'SELECT group_status, ', $sql);
	$sql = str_replace('WHERE ', 'WHERE group_status < ' . GROUP_SPECIAL . ' AND ', $sql);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			$select_list .= '<option value="' . $row['group_id'] . '">' . $row['group_name'] . '</option>';
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			if ( $row['group_status'] == GROUP_SYSTEM )
			{
				$row['group_name'] = $user->lang($row['group_name']);
			}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_mass_email.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
require($phpbb_root_path . 'extension.inc');
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$phpEx = substr(strrchr(__FILE__, '.'), 1);
$requester = 'admin/admin_mass_email';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$sql = "SELECT group_id, group_name 
	FROM ".GROUPS_TABLE . "  
	WHERE group_single_user <> 1";
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
$sql = str_replace('SELECT ', 'SELECT group_status,', $sql);
$sql = str_replace('WHERE ', 'WHERE group_status < ' . GROUP_SPECIAL . ' AND group_id <> ' . GROUP_REGISTERED . ' AND ', $sql);
$sql .= ' ORDER BY group_status DESC';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$select_list .= '<option value = "' . $row['group_id'] . '">' . $row['group_name'] . '</option>';
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		if ( intval($row['group_status']) > GROUP_STANDARD )
		{
			$row['group_name'] = $user->lang($row['group_name']);
		}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_ranks.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$phpbb_root_path = "./../";
require($phpbb_root_path . 'extension.inc');

$cancel = ( isset($HTTP_POST_VARS['cancel']) ) ? true : false;
$no_page_header = $cancel;

require('./pagestart.' . $phpEx);

if ($cancel)
{
	redirect('admin/' . append_sid("admin_ranks.$phpEx", true));
}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$phpbb_root_path = './../';
$phpEx = substr(strrchr(__FILE__, '.'), 1);
$requester = 'admin/admin_ranks';
require('./pagestart.' . $phpEx);
include($config->url('includes/class_message'));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$mode = ( in_array($mode, array('add', 'edit', 'save', 'delete')) ) ? $mode : '';
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
if ( _button('cancel') )
{
	$mode = '';
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full line is longer
#
		$message .= "<br /><br />" . sprintf($lang['Click_return_rankadmin'],
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$ranks = new ranks();
		$ranks->read(true);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full line is longer
#
			$message = $lang['Rank_removed'] . "<br />
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			$ranks = new ranks();
			$ranks->read(true);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		"U_RANK_DELETE" => append_sid("admin_ranks.$phpEx?mode=delete&amp;id=$rank_id"))
	);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	$template->set_switch('ranks.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_smilies.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$phpbb_root_path = "./../";
require($phpbb_root_path . 'extension.inc');

$cancel = ( isset($HTTP_POST_VARS['cancel']) ) ? true : false;
$no_page_header = $cancel;

require('./pagestart.' . $phpEx);

if ($cancel)
{
	redirect('admin/' . append_sid("admin_smilies.$phpEx", true));
}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$phpbb_root_path = './../';
$phpEx = substr(strrchr(__FILE__, '.'), 1);
$requester = 'admin/admin_smilies';
require('./pagestart.' . $phpEx);
include($config->url('includes/class_message'));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
else
{
	$mode = "";
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
if ( _button('cancel') )
{
	$mode = '';
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full-line is longer
#
		$message = $lang['smiley_import_success'] . "<br />
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$smilies = new smilies();
		$smilies->read(true);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$smile_paks_select = "<select name='smile_pak'><option value=''>" . $lang['Select_pak'] . "</option>";
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$smile_paks_select = '<select name="smile_pak" id="smile_pak"><option value="">' . $lang['Select_pak'] . "</option>";
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$smile_paks_select .= "</select>";

		$hidden_vars = "<input type='hidden' name='mode' value='import'>";	
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$hidden_vars = '<input type="hidden" name="mode" value="import" />';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full-line is longer
#
				$message = $lang['smiley_del_success'] . "<br />
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				$smilies = new smilies();
				$smilies->read(true);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full-line is longer
#
			$message = $lang['smiley_edit_success'] . "<br />
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			$smilies = new smilies();
			$smilies->read(true);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full-line is longer
#
			$message = $lang['smiley_add_success'] . "<br />
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			$smilies = new smilies();
			$smilies->read(true);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			"U_SMILEY_DELETE" => append_sid("admin_smilies.$phpEx?mode=delete&amp;id=" . $smilies[$i]['smilies_id']))
		);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$template->set_switch('smiles.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_styles.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$phpbb_root_path = "./../";
require($phpbb_root_path . 'extension.inc');
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$phpbb_root_path = './../';
$phpEx = substr(strrchr(__FILE__, '.'), 1);
$requester = 'admin/admin_styles';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full-line is longer
#
			$message = $lang['Theme_installed'] . "<br />
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			$themes->read(true);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
								$working_data = $$sub_dir;
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
								if ( !empty($working_data) && is_array($working_data) )
								{
									foreach ( $working_data as $style_id => $style_data )
									{
										$working_data[$style_id]['install_to'] = $sub_dir;
									}
								}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
						"U_STYLES_INSTALL" => append_sid("admin_styles.$phpEx?mode=addnew&amp;style=" . urlencode($installable_themes[$i]['style_name']) . "&amp;install_to=" . urlencode($installable_themes[$i]['template_name'])))
					);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
						'U_STYLES_INSTALL' => $config->url('admin/admin_styles', array('mode' => 'addnew', 'style' => urlencode($installable_themes[$i]['style_name']), 'install_to' => urlencode($installable_themes[$i]['install_to'])), true),
					));
					$template->set_switch('styles.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			// Wheeeew! Thank heavens for copy and paste and search and replace :D
			//
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
			$updated['images_pack'] = _read('images_pack', TYPE_NO_HTML);
			$updated['custom_tpls'] = _read('custom_tpls', TYPE_NO_HTML);
			$updated['style_private'] = _read('style_private', TYPE_INT);

			// let's perform some checks
			if ( !empty($updated['images_pack']) )
			{
				if ( !file_exists(phpbb_realpath($config->root . 'templates/' . $updated['template_name'] . '/' . $updated['images_pack'])) || is_dir(phpbb_realpath($config->root . 'templates/' . $updated['template_name'] . '/' . $updated['images_pack'])) || is_link(phpbb_realpath($config->root . 'templates/' . $updated['template_name'] . '/' . $updated['images_pack'])) )
				{
					_error('Images_pack_not_found');
				}
			}
			if ( !empty($updated['custom_tpls']) )
			{
				if ( !file_exists(phpbb_realpath($config->root . 'templates/' . $updated['template_name'] . '/' . $updated['custom_tpls'])) || !is_dir(phpbb_realpath($config->root . 'templates/' . $updated['template_name'] . '/' . $updated['custom_tpls'])) )
				{
					_error('Custom_tpls_not_found');
				}
			}
			if ( !empty($updated['head_stylesheet']) )
			{
				if ( !file_exists(phpbb_realpath($config->root . 'templates/' . $updated['template_name'] . '/' . $updated['head_stylesheet'])) )
				{
					_error('Head_stylesheet_not_found');
				}
			}
			if ( $error )
			{
				message_die(GENERAL_MESSAGE, $error_msg);
			}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full-line is longer
#
				$message = $lang['Theme_updated'] . "<br />
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				$themes->read(true);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full-lines are longer
#
				$sql .= "'" . $vals[$i] . "'";
				}
				
				$sql .= ")";
										
				if(!$result = $db->sql_query($sql))
				{
					message_die(GENERAL_ERROR, "Could not insert themes name table!", "", __LINE__, __FILE__, $sql);
				}
				
				$message = $lang['Theme_created'] . "<br />
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
					$vals[$i] = _htmldecode($vals[$i]);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
				$themes->read(true);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
				if ( $selected_values = $db->sql_fetchrow($result) )
				{
					while(list($key, $val) = @each($selected_values))
					{
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
						$val = htmlspecialchars($val);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			$s_hidden_fields .= '<input type="hidden" name="mode" value="' . $mode . '" />';
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			$template->assign_vars(array(
				'L_IMAGES_PACK' => $user->lang('Images_pack'),
				'L_IMAGES_PACK_EXPLAIN' => $user->lang('Images_pack_explain'),
				'IMAGES_PACK' => $selected['images_pack'],
				'L_CUSTOM_TPLS' => $user->lang('Custom_tpls'),
				'L_CUSTOM_TPLS_EXPLAIN' => $user->lang('Custom_tpls_explain'),
				'CUSTOM_TPLS' => $selected['custom_tpls'],
				'L_STYLE_PRIVATE' => $user->lang('Style_private'),
				'L_STYLE_PRIVATE_EXPLAIN' => $user->lang('Style_private_explain'),
			));
			$template->set_switch('style_private', intval($selected['style_private']));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full-line is longer
#
			$message = $lang['Style_removed'] . "<br />
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			// recache themes
			$themes->read(true);

			// update also forums
			$sql = 'UPDATE ' . FORUMS_TABLE . '
				SET forum_style = 0
				WHERE forum_style = ' . intval($style_id);
			$db->sql_query($sql, false, __LINE__, __FILE__);
			if ( $db->sql_affectedrows() )
			{
				// recache forums
				if ( !class_exists('forums') )
				{
					include($config->url('includes/class_forums'));
				}
				$forums = new forums();
				$forums->read(true);
			}

			// maybe the groups are impacted
			$sql = 'UPDATE ' . GROUPS_TABLE . '
						SET group_style = 0
						WHERE group_style = ' . intval($style_id);
			$db->sql_query($sql, false, __LINE__, __FILE__);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
				"U_STYLES_DELETE" => append_sid("admin_styles.$phpEx?mode=delete&amp;style_id=" . $style_rowset[$i]['themes_id']))
			);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			$template->set_switch('styles.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_user_ban.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
require($phpbb_root_path . 'extension.inc');
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$phpEx = substr(strrchr(__FILE__, '.'), 1);
$requester = 'admin/admin_user_ban';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/admin_words.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$phpbb_root_path = "./../";
require($phpbb_root_path . 'extension.inc');

$cancel = ( isset($HTTP_POST_VARS['cancel']) ) ? true : false;
$no_page_header = $cancel;

require('./pagestart.' . $phpEx);

if ($cancel)
{
	redirect('admin/' . append_sid("admin_words.$phpEx", true));
}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$phpbb_root_path = './../';
$phpEx = substr(strrchr(__FILE__, '.'), 1);
$requester = 'admin/admin_words';
require('./pagestart.' . $phpEx);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$mode = ( in_array($mode, array('add', 'edit', 'save', 'delete')) ) ? $mode : '';
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
if ( _button('cancel') )
{
	$mode = '';
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full-line is longer
#
		$message .= "<br /><br />" . sprintf($lang['Click_return_wordadmin'],
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$censored_words->read(true);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full-line is longer
#
			$message = $lang['Word_removed'] . "<br />
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
			$censored_words->read(true);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			"U_WORD_DELETE" => append_sid("admin_words.$phpEx?mode=delete&amp;id=$word_id"))
		);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
		$template->set_switch('words.light', !($i % 2));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/page_footer_admin.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	'TRANSLATION_INFO' => (isset($lang['TRANSLATION_INFO'])) ? $lang['TRANSLATION_INFO'] : ((isset($lang['TRANSLATION'])) ? $lang['TRANSLATION'] : ''))
);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
if ( isset($lang['TRANSLATION_INFO']) )
{
	$lang['TRANSLATION'] = $lang['TRANSLATION_INFO'];
}
$translation_copy = array();
if ( isset($lang['TRANSLATION']) )
{
	$translation_copy[] = $lang['TRANSLATION'];
}
if ( isset($lang['CH_TRANSLATION']) )
{
	$translation_copy[] = $lang['CH_TRANSLATION'];
}
$template->assign_vars(array(
	'TRANSLATION_INFO' => empty($translation_copy) ? '' : implode('<br />', $translation_copy),
));
if ( (_read('pane') != 'left') && defined('DEBUG') && defined('DEBUG_SQL_ADMIN') )
{
	// send run stat (page generation, sql time, requests dump...)
	include($config->url('includes/class_run_stats'));
	$stat_run = new stat_run_class(microtime());
	$stat_run->display();
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/page_header_admin.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	'T_SPAN_CLASS3' => $theme['span_class3'])
);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
$template->assign_vars(array(
	'I_SPACER' => $user->img('spacer'),
	'I_LOGO_SMALL' => $user->img('logo_small'),
	'S_ROOT' => $config->root,
));

// set the in_admin switch
$template->set_switch('in_admin', defined('IN_ADMIN'));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
admin/pagestart.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	redirect("index.$phpEx?sid=" . $userdata['session_id']);
}
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
// check if .htaccess is available
if ( ($userdata['session_admin'] == true) || @file_exists('.htaccess') )
{
	$userdata['session_admin'] = true;
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
db/mssql-odbc.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
				$this->result = odbc_exec($this->db_connect_id, "SELECT $query"); 
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
				$this->result = @odbc_exec($this->db_connect_id, 'SELECT ' . $query);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
db/mysql.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			$this->row[$query_id] = @mysql_fetch_array($query_id);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
			$this->row[$query_id] = @mysql_fetch_array($query_id, MYSQL_ASSOC);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			while($this->rowset[$query_id] = @mysql_fetch_array($query_id))
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
			while($this->rowset[$query_id] = @mysql_fetch_array($query_id, MYSQL_ASSOC))
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/auth.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full lines are longer
#
function auth($type, $forum_id, $userdata, $f_access = '')
{
	global $db, $lang;

	switch( $type )
	{
		case AUTH_ALL:
			$a_sql = 'a.auth_view, a.auth_read,
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
// this one will be only called by hitting the ACP/Auths center/Definition/"Forums" auths type/Regen button
function get_forums_auths_def()
{
	global $config;

	// get current auths fields
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			break;

		case AUTH_VIEW:
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
		$auth_user = $is_admin;
	}

	return $auth_user;
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	// reverse the array to get the order
	$auth_fields = array_flip($auth_fields);

	// add global annonce auth after announce
	$auth_fields['auth_global_announce'] = $auth_fields['auth_announce'];
	asort($auth_fields);
	return array_keys($auth_fields);
}

// this one is to keep compliancy with vanilia phpBB way to get auths values
function auth($type, $forum_id, $userdata, $f_access = '')
{
	global $db, $user, $forums, $config;

	// get auths def
	$auths_def = get_forums_auths_def();
	$auths_def[] = 'auth_mod';

	// prepare results
	$user_auth = array();

	// read forums if required
	if ( ($forum_id != AUTH_LIST_ALL) && empty($f_access) && ($forums === false) )
	{
		if ( !class_exists('forums') )
		{
			include($config->url('includes/class_forums'));
		}
		$forums = new forums();
		$forums->read();
	}

	// read forum auths if not done
	if ( empty($user->cache[POST_FORUM_URL]) )
	{
		$user->get_cache(POST_FORUM_URL);
	}

	// get the result
	if ( !empty($auths_def) )
	{
		$count_auths_def = count($auths_def);
		for ( $i = 0; $i < $count_auths_def; $i++ )
		{
			$auth_name = $auths_def[$i];
			if ( $forum_id != AUTH_LIST_ALL )
			{
				$user_auth[$auth_name] = $user->auth(POST_FORUM_URL, $auth_name, $forum_id);
			}
			else if ( !empty($f_access) )
			{
				$count_f_access = count($f_access);
				for ( $k = 0; $k < $count_f_access; $k++ )
				{
					$f_forum_id = $f_access[$k]['forum_id'];
					$user_auth[$f_forum_id][$auth_name] = $user->auth(POST_FORUM_URL, $auth_name, $f_forum_id);
				}
			}
			else if ( !empty($forums->keys) )
			{
				$count_forums = count($forums->keys);
				for ( $k = 0; $k < $count_forums; $k++ )
				{
					$f_forum_id = $forums->keys[$k];
					$user_auth[$f_forum_id][$auth_name] = $user->auth(POST_FORUM_URL, $auth_name, $f_forum_id);
				}
			}
		}
	}
	return $user_auth;
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/bbcode.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
if ( !defined('IN_PHPBB') )
{
	die("Hacking attempt");
}
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
class bbcode
{
	var $bbcode_tpl;

	function bbcode()
	{
		$this->bbcode_tpl = false;
	}

	function read()
	{
		// load templates from file into array.
		$this->bbcode_tpl = load_bbcode_template();

		// prepare array for use in regexps.
		$this->bbcode_tpl = prepare_bbcode_template($this->bbcode_tpl);
	}
}

// Note : this has been copied from posting.php (or privmsg.php)
function display_bbcodes()
{
	global $config, $template;
	global $lang;

	$template->assign_vars(array(
		'L_BBCODE_B_HELP' => $template->lang('bbcode_b_help'),
		'L_BBCODE_I_HELP' => $template->lang('bbcode_i_help'),
		'L_BBCODE_U_HELP' => $template->lang('bbcode_u_help'),
		'L_BBCODE_Q_HELP' => $template->lang('bbcode_q_help'),
		'L_BBCODE_C_HELP' => $template->lang('bbcode_c_help'),
		'L_BBCODE_L_HELP' => $template->lang('bbcode_l_help'),
		'L_BBCODE_O_HELP' => $template->lang('bbcode_o_help'),
		'L_BBCODE_P_HELP' => $template->lang('bbcode_p_help'),
		'L_BBCODE_W_HELP' => $template->lang('bbcode_w_help'),
		'L_BBCODE_A_HELP' => $template->lang('bbcode_a_help'),
		'L_BBCODE_S_HELP' => $template->lang('bbcode_s_help'),
		'L_BBCODE_F_HELP' => $template->lang('bbcode_f_help'),
		'L_EMPTY_MESSAGE' => $template->lang('Empty_message'),

		'L_FONT_COLOR' => $template->lang('Font_color'),
		'L_COLOR_DEFAULT' => $template->lang('color_default'),
		'L_COLOR_DARK_RED' => $template->lang('color_dark_red'),
		'L_COLOR_RED' => $template->lang('color_red'),
		'L_COLOR_ORANGE' => $template->lang('color_orange'),
		'L_COLOR_BROWN' => $template->lang('color_brown'),
		'L_COLOR_YELLOW' => $template->lang('color_yellow'),
		'L_COLOR_GREEN' => $template->lang('color_green'),
		'L_COLOR_OLIVE' => $template->lang('color_olive'),
		'L_COLOR_CYAN' => $template->lang('color_cyan'),
		'L_COLOR_BLUE' => $template->lang('color_blue'),
		'L_COLOR_DARK_BLUE' => $template->lang('color_dark_blue'),
		'L_COLOR_INDIGO' => $template->lang('color_indigo'),
		'L_COLOR_VIOLET' => $template->lang('color_violet'),
		'L_COLOR_WHITE' => $template->lang('color_white'),
		'L_COLOR_BLACK' => $template->lang('color_black'),

		'L_FONT_SIZE' => $template->lang('Font_size'),
		'L_FONT_TINY' => $template->lang('font_tiny'),
		'L_FONT_SMALL' => $template->lang('font_small'),
		'L_FONT_NORMAL' => $template->lang('font_normal'),
		'L_FONT_LARGE' => $template->lang('font_large'),
		'L_FONT_HUGE' => $template->lang('font_huge'),

		'L_BBCODE_CLOSE_TAGS' => $template->lang('Close_Tags'),
		'L_STYLES_TIP' => $template->lang('Styles_tip'),
	));

	// plugs
	if ( !isset($config->plug_ins['bbcode']) )
	{
		$plug_ins = new plug_ins();
		$plug_ins->load('bbcode');
		unset($plug_ins);
	}

	if ( $config->plug_ins['bbcode'] )
	{
		foreach ( $config->plug_ins['bbcode'] as $plug => $dummy )
		{
			if ( method_exists($config->plug_ins['bbcode'][$plug], 'display') )
			{
				$config->plug_ins['bbcode'][$plug]->display();
			}
		}
	}
}

function bbencode_decode($text, $uid)
{
	return empty($uid) || (trim($text) == '') ? $text : preg_replace('#\:(([a-z0-9]\:)?)' . $uid . '#s', '', $text);
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
function load_bbcode_template()
{
	global $template;
	$tpl_filename = $template->make_filename('bbcode.tpl');
	$tpl = fread(fopen($tpl_filename, 'r'), filesize($tpl_filename));
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
	global $config;

	// plugs
	if ( !isset($config->plug_ins['bbcode']) )
	{
		$plug_ins = new plug_ins();
		$plug_ins->load('bbcode');
		unset($plug_ins);
	}

	if ( $config->plug_ins['bbcode'] )
	{
		foreach ( $config->plug_ins['bbcode'] as $plug => $dummy )
		{
			if ( method_exists($config->plug_ins['bbcode'][$plug], 'load_template') )
			{
				$config->plug_ins['bbcode'][$plug]->load_template($tpl);
			}
		}
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
function prepare_bbcode_template($bbcode_tpl)
{
	global $lang;
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
	global $config;

	// plugs
	if ( !isset($config->plug_ins['bbcode']) )
	{
		$plug_ins = new plug_ins();
		$plug_ins->load('bbcode');
		unset($plug_ins);
	}

	if ( $config->plug_ins['bbcode'] )
	{
		foreach ( $config->plug_ins['bbcode'] as $plug => $dummy )
		{
			if ( method_exists($config->plug_ins['bbcode'][$plug], 'prepare_template') )
			{
				$config->plug_ins['bbcode'][$plug]->prepare_template($bbcode_tpl);
			}
		}
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	global $lang, $bbcode_tpl;

	$text = preg_replace('#(script|about|applet|activex|chrome):#is', "\\1&#058;", $text);

	// pad it with a space so we can distinguish between FALSE and matching the 1st char (index 0).
	// This is important; bbencode_quote(), bbencode_list(), and bbencode_code() all depend on it.
	$text = " " . $text;

	// First: If there isn't a "[" and a "]" in the message, don't bother.
	if (! (strpos($text, "[") && strpos($text, "]")) )
	{
		// Remove padding, return.
		$text = substr($text, 1);
		return $text;
	}

	// Only load the templates ONCE..
	if (!defined("BBCODE_TPL_READY"))
	{
		// load templates from file into array.
		$bbcode_tpl = load_bbcode_template();

		// prepare array for use in regexps.
		$bbcode_tpl = prepare_bbcode_template($bbcode_tpl);
	}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	global $config;
	global $lang;

	// do a basic cleaning
	$text = preg_replace('#(script|about|applet|activex|chrome):#is', "\\1&#058;", $text);

	// something to parse ?
	if ( (trim($text) == '') || ((strpos($text, ':' . $uid) === false) && (strpos($text, '[url') === false) && (strpos($text, '[email]') === false)) )
	{
		return $text;
	}

	// load tpl
	if ( !isset($config->globals['bbcode']) )
	{
		$config->globals['bbcode'] = new bbcode();
		$config->globals['bbcode']->read();
	}
	$bbcode_tpl = &$config->globals['bbcode']->bbcode_tpl;

	// plugs
	if ( !isset($config->plug_ins['bbcode']) )
	{
		$plug_ins = new plug_ins();
		$plug_ins->load('bbcode');
		unset($plug_ins);
	}

	// plugs
	if ( $config->plug_ins['bbcode'] )
	{
		foreach ( $config->plug_ins['bbcode'] as $plug => $dummy )
		{
			if ( method_exists($config->plug_ins['bbcode'][$plug], 'second_pass') )
			{
				$config->plug_ins['bbcode'][$plug]->second_pass($text, $uid);
			}
		}
	}

	// start to process all
	$text = ' ' . $text;
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	return $text;

} // bbencode_second_pass()
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	// remove remaining $uid from unparsed bbcode
	$text = bbencode_decode($text, $uid);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
mt_srand( (double) microtime() * 1000000);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	// Remove our padding from the string..
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	global $config;

	// plugs
	if ( !isset($config->plug_ins['bbcode']) )
	{
		$plug_ins = new plug_ins();
		$plug_ins->load('bbcode');
		unset($plug_ins);
	}

	if ( $config->plug_ins['bbcode'] )
	{
		foreach ( $config->plug_ins['bbcode'] as $plug => $dummy )
		{
			if ( method_exists($config->plug_ins['bbcode'][$plug], 'first_pass') )
			{
				$config->plug_ins['bbcode'][$plug]->first_pass($text, $uid);
			}
		}
	}
//-- fin mod : categories hierarchy --------------------------------------------

#
#-----[ FIND ]------------------------------------------------
#
function make_clickable($text)
{
	$text = preg_replace('#(script|about|applet|activex|chrome):#is', "\\1&#058;", $text);
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
	global $config;

	// plugs
	if ( !isset($config->plug_ins['bbcode']) )
	{
		$plug_ins = new plug_ins();
		$plug_ins->load('bbcode');
		unset($plug_ins);
	}

	// plugs
	$handled = false;
	if ( $config->plug_ins['bbcode'] )
	{
		foreach ( $config->plug_ins['bbcode'] as $plug => $dummy )
		{
			if ( method_exists($config->plug_ins['bbcode'][$plug], 'make_clickable') )
			{
				$handled |= $config->plug_ins['bbcode'][$plug]->make_clickable($text);
			}
		}
	}
	if ( $handled )
	{
		return $text;
	}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
function undo_make_clickable($text)
{
	$text = preg_replace("#<!-- BBCode auto-link start --><a href=\"(.*?)\" target=\"_blank\">.*?</a><!-- BBCode auto-link end -->#i", "\\1", $text);
	$text = preg_replace("#<!-- BBcode auto-mailto start --><a href=\"mailto:(.*?)\">.*?</a><!-- BBCode auto-mailto end -->#i", "\\1", $text);

	return $text;

}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
// this one is depreciated
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
function undo_htmlspecialchars($input)
{
	$input = preg_replace("/&gt;/i", ">", $input);
	$input = preg_replace("/&lt;/i", "<", $input);
	$input = preg_replace("/&quot;/i", "\"", $input);
	$input = preg_replace("/&amp;/i", "&", $input);

	return $input;
}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
// this one is depreciated: use in place _html_entities_decode()
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
function escape_slashes($input)
{
	$output = str_replace('/', '\/', $input);
	return $output;
}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
// this one is depreciated
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
function bbcode_array_push(&$stack, $value)
{
   $stack[] = $value;
   return(sizeof($stack));
}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
// this one is depreciated
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
function bbcode_array_pop(&$stack)
{
   $arrSize = count($stack);
   $x = 1;

   while(list($key, $val) = each($stack))
   {
      if($x < count($stack))
      {
	 		$tmpArr[] = $val;
      }
      else
      {
	 		$return_val = $val;
      }
      $x++;
   }
   $stack = $tmpArr;

   return($return_val);
}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
// this one is depreciated
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
function smilies_pass($message)
{
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
// these ones have been moved to class_message
/*
#
#-----[ FIND ]------------------------------------------------
#
	return ( strlen($a['code']) > strlen($b['code']) ) ? -1 : 1;
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/db.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$db = new sql_db($dbhost, $dbuser, $dbpasswd, $dbname, false);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
include($phpbb_root_path . 'includes/class_db.' . $phpEx);
$db = new db_class($dbhost, $dbuser, $dbpasswd, $dbname, false);
if ( defined('PHPBB_INSTALLED') )
{
	unset($dbhost);
	unset($dbuser);
	unset($dbpasswd);
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/emailer.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			$template_lang = $board_config['default_lang'];
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
			global $config, $user;

			$template_lang = $user->lang_set ? $user->lang_used : $config->data['default_lang'];
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/functions.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
// added at phpBB 2.0.11 to properly format the username
function phpbb_clean_username($username)
{
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	$username = str_replace(array("\xA0", "\xAD", "\r\n", "\n"), ' ', $username);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
function dss_rand()
{
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
	return substr($val, 4, 16);
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
function make_jumpbox($action, $match_forum_id = 0)
{
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
	return ( !empty($translate) ) ? strtr(@gmdate($format, $gmepoch + (3600 * $tz)), $translate) : @gmdate($format, $gmepoch + (3600 * $tz));
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//
// Obtain list of naughty words and build preg style replacement arrays for use by the
// calling script, note that the vars are passed as references this just makes it easier
// to return both sets of arrays
//
function obtain_word_list(&$orig_word, &$replacement_word)
{
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
	// Behave as per HTTP/1.1 spec for others
	header('Location: ' . $server_protocol . $server_name . $server_port . $script_name . $url);
	exit;
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/functions_post.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$html_entities_match = array('#&(?!(\#[0-9]+;))#', '#<#', '#>#', '#"#');
$html_entities_replace = array('&amp;', '&lt;', '&gt;', '&quot;');

$unhtml_specialchars_match = array('#&gt;#', '#&lt;#', '#&quot;#', '#&amp;#');
$unhtml_specialchars_replace = array('>', '<', '"', '&');
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
include($config->url('includes/CH_functions_post'));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# function prepare_message()
#
	global $board_config, $html_entities_match, $html_entities_replace;
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			$message .= preg_replace($html_entities_match, $html_entities_replace, $part) . clean_html($tag);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
			$message .= _html_entities_encode($part) . clean_html($tag);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
		$message = preg_replace($html_entities_match, $html_entities_replace, $message);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
		$message = _html_entities_encode($message);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# function unprepare_message()
#
	global $unhtml_specialchars_match, $unhtml_specialchars_replace;

	return preg_replace($unhtml_specialchars_match, $unhtml_specialchars_replace, $message);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	return _html_entities_decode($message);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full lines are longer
#
//
// Post a new topic/reply/poll or edit existing post/poll
//
function submit_post($mode, &$post_data, &$message, &$meta,
{
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full lines are longer
#
# at end of function delete_post()
#
	$message .=  '<br /><br />' . sprintf($lang['Click_return_forum'],

	return;
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			$sql = "SELECT ban_userid 
				FROM " . BANLIST_TABLE;
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
					$update_watched_sql .= ($update_watched_sql != '') ? ', ' . $row['user_id'] : $row['user_id'];
				}
				while ($row = $db->sql_fetchrow($result));
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
			global $user;

			$sql = 'SELECT u.user_id, u.user_email, u.user_lang
						FROM ' . TOPICS_WATCH_TABLE . ' tw, ' . USERS_TABLE . ' u
						WHERE tw.topic_id = ' . intval($topic_id) . '
							AND tw.notify_status = ' . TOPIC_WATCH_UN_NOTIFIED . '
							AND u.user_id = tw.user_id
							AND tw.user_id NOT IN(' . $db->sql_subquery('ban_userid', '
								SELECT DISTINCT ban_userid
									FROM ' . BANLIST_TABLE . '
							', __LINE__, __FILE__) . ')';
			$result = $db->sql_query($sql, false, __LINE__, __FILE__);
			$update_watched_sql = '';
			$bcc_list_ary = array();
			while ( $row = $db->sql_fetchrow($result) )
			{
				if ( !in_array($row['user_id'], array(ANONYMOUS, $user->data['user_id'])) )
				{
					if ( !empty($row['user_email']) )
					{
						if ( !isset($bcc_list_ary[ $row['user_lang'] ]) )
						{
							$bcc_list_ary[ $row['user_lang'] ] = array($row['user_email']);
						}
						else
						{
							$bcc_list_ary[ $row['user_lang'] ][] = $row['user_email'];
						}
					}
					$update_watched_sql .= (empty($update_watched_sql) ? '' : ', ') . $row['user_id'];
				}
			}
			$db->sql_freeresult($result);

			// process emails
			if ( !empty($bcc_list_ary) )
			{
				// Sixty second limit
				@set_time_limit(60);
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			$db->sql_freeresult($result);
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
//
// Fill smiley templates (or just the variables) with smileys
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
	if ($mode == 'window')
	{
		$template->pparse('smiliesbody');

		include($phpbb_root_path . 'includes/page_tail.'.$phpEx);
	}
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/functions_search.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
function add_search_words($mode, $post_id, $post_text, $post_title = '')
{
	global $db, $phpbb_root_path, $board_config, $lang;

	$stopword_array = @file($phpbb_root_path . 'language/lang_' . $board_config['default_lang'] . "/search_stopwords.txt"); 
	$synonym_array = @file($phpbb_root_path . 'language/lang_' . $board_config['default_lang'] . "/search_synonyms.txt"); 
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
function add_search_words($mode, $post_id, $post_text, $post_title = '', $force=false)
{
	global $config, $user;
	global $db, $phpbb_root_path, $board_config, $lang;

	if ( $config->data['fulltext_search'] && !$force )
	{
		return;
	}

	$stopword_array = @file($phpbb_root_path . 'language/lang_' . $user->lang_used . '/search_stopwords.txt');
	$synonym_array = @file($phpbb_root_path . 'language/lang_' . $user->lang_used . '/search_synonyms.txt');
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
function remove_search_post($post_id_sql)
{
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
	return $words_removed;
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
function username_search($search_match)
{
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
	global $config, $user, $censored_words, $icons, $navigation, $themes, $smilies, $requester;
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/functions_selects.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			$filename = trim(str_replace("lang_", "", $file));
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
			$filename = trim(phpbb_ltrim(basename(phpbb_rtrim(preg_replace('#^lang_#i', '', $file))), "'"));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
function style_select($default_style, $select_name = "style", $dirname = "templates")
{
	global $db;

	$sql = "SELECT themes_id, style_name
		FROM " . THEMES_TABLE . "
		ORDER BY template_name, themes_id";
	if ( !($result = $db->sql_query($sql)) )
	{
		message_die(GENERAL_ERROR, "Couldn't query themes table", "", __LINE__, __FILE__, $sql);
	}

	$style_select = '<select name="' . $select_name . '">';
	while ( $row = $db->sql_fetchrow($result) )
	{
		$selected = ( $row['themes_id'] == $default_style ) ? ' selected="selected"' : '';

		$style_select .= '<option value="' . $row['themes_id'] . '"' . $selected . '>' . $row['style_name'] . '</option>';
	}
	$style_select .= "</select>";

	return $style_select;
}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
function style_select($default_style, $select_name = "style", $dirname = "templates")
{
	global $themes, $user;

	$themes->read();

	$style_select = '';
	if ( !empty($themes) )
	{
		if ( !defined('IN_ADMIN') || defined('IN_USERCP') )
		{
			$selected = empty($default_style) ? ' selected="selected"' : '';
			$style_select .= '<option value="0"' . $selected . '>' . $user->lang('Default') . '</option>';
		}
		foreach ( $themes->data as $themes_id => $row )
		{
			if ( defined('IN_ADMIN') || !intval($row['style_private']) )
			{
				$selected = $themes_id == $default_style ? ' selected="selected"' : '';
				$style_select .= '<option value="' . $themes_id . '"' . $selected . '>' . $row['style_name'] . '</option>';
			}
		}
		if ( !empty($style_select) )
		{
			$style_select = '<select name="' . $select_name . '">' . $style_select . '</select>';
		}
	}
	return $style_select;
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/page_header.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$s_last_visit = ( $userdata['session_logged_in'] ) ? create_date($board_config['default_dateformat'], $userdata['user_lastvisit'], $board_config['board_timezone']) : '';
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
	$l_online_users .= sprintf($l_g_user_s, $guests_online);
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$s_last_visit = $user->data['session_logged_in'] ? $user->date($user->data['user_lastvisit']) : '';
$l_online_users = $online_userlist = '';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
if (!isset($nav_links))
{
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
$l_timezone = (count($l_timezone) > 1 && $l_timezone[count($l_timezone)-1] != 0) ? $lang[sprintf('%.1f', $board_config['board_timezone'])] : $lang[number_format($board_config['board_timezone'])];
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
$nav_links = (empty($nav_links) ? array() : $nav_links) + array(
	'top' => array(
		'url' => $config->url(INDEX, '', true),
		'title' => $template->sprintf($template->lang('Forum_Index'), $config->data['sitename']),
	),
	'search' => array(
		'url' => $config->url('search', '', true),
		'title' => $template->lang('Search'),
	),
	'help' => array(
		'url' => $config->url('faq', '', true),
		'title' => $template->lang('FAQ'),
	),
	'author' => array(
		'url' => $config->url('memberlist', '', true),
		'title' => $template->lang('Memberlist'),
	),
	'copyright' => array(
		'url' => 'http://www.phpbb.com',
		'title' => 'phpBB',
	),
);
if ( !empty($config->data['site_fav_icon']) )
{
	$nav_links += array(
		'SHORTCUT ICON' => array(
			'url' => $template->img($config->data['site_fav_icon']),
			'title' => $config->data['sitename'],
		),
	);
}
foreach ( $nav_links as $rel => $hrefdata )
{
	if ( isset($hrefdata['url']) )
	{
		$template->assign_block_vars('nav_links', array(
			'REL' => $rel,
			'U_REL' => $hrefdata['url'],
			'L_REL' => $hrefdata['title'],
		));
	}
	else if ( $count_hrefdata = count($hrefdata) )
	{
		for ( $i = 0; $i < $count_hrefdata; $i++ )
		{
			$template->assign_block_vars('nav_links', array(
				'REL' => $rel,
				'U_REL' => $hrefdata[$i]['url'],
				'L_REL' => $hrefdata[$i]['title'],
			));
		}
	}
}
$nav_links_html = $template->include_file('nav_links_box.tpl');

$l_timezone = $user->get_timezone();

$is_admin = $user->data['session_logged_in'] && ($user->data['user_level'] == ADMIN);
$template->assign_vars(array(
	// preferences
	'L_PREFERENCES' => $template->lang('Preferences'),
	'U_PREFERENCES' => $config->url('usercp', '', true),

	// logos
	'I_SPACER' => $template->img('spacer'),
	'I_LOGO' => $template->img('logo'),
	'I_LOGO_SMALL' => $template->img('logo_small'),

	// admin
	'U_ADMIN_LINK' => $is_admin ? $config->url('admin/index', array('sid' => $user->data['session_id']), true) : '',
	'L_ADMIN_LINK' => $is_admin ? $template->lang('Admin_panel') : '',
	'I_ADMIN_LINK' => $is_admin ? $template->img('menu_admin') : '',

	// pics for other options
	'I_ACP' => $template->img('menu_acp'),
	'I_FAQ' => $template->img('menu_faq'),
	'I_SEARCH' => $template->img('menu_search'),
	'I_MEMBERLIST' => $template->img('menu_memberlist'),
	'I_GROUP_CP' => $template->img('menu_usergroup'),
	'I_REGISTER' => $template->img('menu_register'),
	'I_PROFILE' => $template->img('menu_profile'),
	'I_PREFERENCES' => $template->img('menu_preferences'),
	'I_LOGIN' => $template->img('menu_login'),
	'I_LOGOUT' => $template->img('menu_logout'),

	// system
	'S_ROOT' => $config->root,
));
$template->set_switch('user_is_admin', $is_admin);
$template->set_switch('in_admin', defined('IN_ADMIN'));

// plugs
$plug_ins = new plug_ins();
$plug_ins->load('page_header');
unset($plug_ins);
if ( $config->plug_ins['page_header'] )
{
	foreach ( $config->plug_ins['page_header'] as $plug => $dummy )
	{
		if ( method_exists($config->plug_ins['page_header'][$plug], 'start') )
		{
			$config->plug_ins['page_header'][$plug]->start();
		}
	}
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	'LAST_VISIT_DATE' => sprintf($lang['You_last_visit'], $s_last_visit),
	'CURRENT_TIME' => sprintf($lang['Current_time'], create_date($board_config['default_dateformat'], time(), $board_config['board_timezone'])),
	'TOTAL_USERS_ONLINE' => $l_online_users,
	'LOGGED_IN_USER_LIST' => $online_userlist,
	'RECORD_USERS' => sprintf($lang['Record_online_users'], $board_config['record_online_users'], create_date($board_config['default_dateformat'], $board_config['record_online_date'], $board_config['board_timezone'])),
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
	'LAST_VISIT_DATE' => $template->sprintf($template->lang('You_last_visit'), $s_last_visit),
	'CURRENT_TIME' => $template->sprintf($template->lang('Current_time'), $user->date(time(), '', false)),
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	'L_WHO_IS_ONLINE' => $lang['Who_is_Online'],
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/page_tail.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	'ADMIN_LINK' => $admin_link)
);
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
if ( isset($lang['TRANSLATION_INFO']) )
{
	$lang['TRANSLATION'] = $lang['TRANSLATION_INFO'];
}
$translation_copy = array();
if ( isset($lang['TRANSLATION']) )
{
	$translation_copy[] = $lang['TRANSLATION'];
}
if ( isset($lang['CH_TRANSLATION']) )
{
	$translation_copy[] = $lang['CH_TRANSLATION'];
}
$template->assign_vars(array(
	'TRANSLATION_INFO' => empty($translation_copy) ? '' : implode('<br />', $translation_copy),
));

// plugs
$plug_ins = new plug_ins();
$plug_ins->load('page_tail');
unset($plug_ins);
if ( $config->plug_ins['page_tail'] )
{
	foreach ( $config->plug_ins['page_tail'] as $plug => $dummy )
	{
		if ( method_exists($config->plug_ins['page_tail'][$plug], 'end') )
		{
			$config->plug_ins['page_tail'][$plug]->end();
		}
	}
}

// run stats
if ( empty($gen_simple_header) && defined('DEBUG') )
{
	// send run stat (page generation, sql time, requests dump...)
	include($config->url('includes/class_run_stats'));
	$stat_run = new stat_run_class(microtime());
	$stat_run->display();
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/usercp_activate.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
if ( !defined('IN_PHPBB') )
{
	die('Hacking attempt');
	exit;
}
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
if ( !intval($HTTP_GET_VARS[POST_USERS_URL]) || !preg_match('/^[A-Za-z0-9]*$/', trim(stripslashes($HTTP_GET_VARS['act_key']))) )
{
	die('Hacking attempt');
	exit;
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/usercp_avatar.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
			$tmp_path = ( !@$ini_val('safe_mode') ) ? '/tmp' : './' . $board_config['avatar_path'] . '/tmp';
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
			$tmp_path = !@$ini_val('safe_mode') ? TMP_PATH : './' . $board_config['avatar_path'] . '/tmp';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/usercp_email.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
if ( !defined('IN_PHPBB') )
{
	die("Hacking attempt");
	exit;
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- add
if ( !empty($config->data['email_disable']) && ($user->data['user_level'] != ADMIN) )
{
	message_return('Not_Authorised');
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/usercp_sendpasswd.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
if ( !defined('IN_PHPBB') )
{
	die('Hacking attempt');
	exit;
}
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
if ( intval($config->data['enable_confirm']) )
{
	include($config->url('includes/vc/class_visual_confirm'));
	$visual_confirm = new visual_confirm($requester);

	// check the visual confirm code
	if ( _button('submit') )
	{
		if ( $res = $visual_confirm->check('confirm_id', 'confirm_code', 'Too_many_passwords') )
		{
			message_die(GENERAL_MESSAGE, $res);
		}
	}
	else
	{
		$visual_confirm->display();
		$template->set_switch('light_legend');
	}
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
includes/usercp_viewprofile.php
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
if ( empty($HTTP_GET_VARS[POST_USERS_URL]) || $HTTP_GET_VARS[POST_USERS_URL] == ANONYMOUS )
{
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
	$ranksrow[] = $row;
}
$db->sql_freeresult($result);
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
if ( !$view_user->data )
{
	message_return('No_user_id_specified');
}
$profiledata = $view_user->data;
$user->pool[ intval($view_user->data['user_id']) ] = $view_user->data;
if ( isset($menus['editprofile']) && $cp_panels->auth($menus['editprofile'], $view_user) )
{
	display_buttons(array(
		'edit' => array('txt' => 'Edit', 'img' => 'cmd_edit', 'key' => 'cmd_edit', 'url' => 'usercp', 'parms' => $user->data['user_id'] == $view_user->data['user_id'] ? '' : array(POST_USERS_URL => $view_user->data['user_id'])),
	));
}

// plugs
if ( $config->plug_ins[$requester] )
{
	foreach ( $config->plug_ins[$requester] as $plug => $dummy )
	{
		if ( method_exists($config->plug_ins[$requester][$plug], 'view_start') )
		{
			$config->plug_ins[$requester][$plug]->view_start();
		}
	}
}

// get poster info
include($config->url('includes/class_topics'));
include($config->url('includes/class_posts'));
$poster_info = new posts($cp_requester, $cp_parms);
$user_blocks = $poster_info->poster_block_vars($view_user->data['user_id']);
unset($poster_info);

$tpl_switches = empty($user_blocks['switches']) ? array() : $user_blocks['switches'];
$tpl_vars = empty($user_blocks['data']) ? array() : $user_blocks['data'];
unset($user_blocks);

// anon
if ( $view_user->data['user_id'] == ANONYMOUS )
{
	$tpl_vars['POSTER_NAME'] = $user->lang('Guest');
}
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$avatar_img = '';
if ( $profiledata['user_avatar_type'] && $profiledata['user_allowavatar'] )
{
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ FIND ]------------------------------------------------
#
else
{
	for($i = 0; $i < count($ranksrow); $i++)
	{
		if ( $profiledata['user_posts'] >= $ranksrow[$i]['rank_min'] && !$ranksrow[$i]['rank_special'] )
		{
			$poster_rank = $ranksrow[$i]['rank_title'];
			$rank_image = ( $ranksrow[$i]['rank_image'] ) ? '<img src="' . $ranksrow[$i]['rank_image'] . '" alt="' . $poster_rank . '" title="' . $poster_rank . '" border="0" /><br />' : '';
		}
	}
}
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
// avatar & rank
$avatar_img = !isset($tpl_vars['POSTER_AVATAR']) || empty($tpl_vars['POSTER_AVATAR']) ? '' : $template->sprintf('<img src="%s" alt="" border="0" />', $tpl_vars['POSTER_AVATAR']);
$poster_rank = !isset($tpl_vars['L_POSTER_RANK']) || empty($tpl_vars['L_POSTER_RANK']) ? '' : $tpl_vars['L_POSTER_RANK'];
$rank_image = !isset($tpl_vars['I_POSTER_RANK']) || empty($tpl_vars['I_POSTER_RANK']) ? '' : $template->sprintf('<img src="%s" alt="" title="%s" border="0" />', $tpl_vars['I_POSTER_RANK'], $poster_rank);

// send to template
if ( $tpl_vars )
{
	$template->assign_vars($tpl_vars);
}
if ( $tpl_switches )
{
	foreach ( $tpl_switches as $key => $value )
	{
		$template->set_switch($key, $value);
	}
}

// various constants
$template->assign_vars(array(
	// author panel
	'L_POSTER_POSTS' => $user->lang('Posts'),
	'L_POSTER_FROM' => $user->lang('Location'),
	'L_POSTER_JOINED' => $user->lang('Joined'),
	'L_POSTER_SIGNATURE' => $user->lang('Signature'),

	// users buttons
	'I_POSTER_PROFILE' => $user->img('icon_profile'),
	'L_POSTER_PROFILE' => $user->lang('Read_profile'),
	'I_POSTER_SEARCH' => $user->img('icon_search'),
	'I_POSTER_PM' => $user->img('icon_pm'),
	'L_POSTER_PM' => $user->lang('Send_private_message'),
	'I_POSTER_EMAIL' => $user->img('icon_email'),
	'L_POSTER_EMAIL' => $user->lang('Send_email'),
	'I_POSTER_WWW' => $user->img('icon_www'),
	'L_POSTER_WWW' => $user->lang('Visit_website'),
	'I_POSTER_ICQ' => $user->img('icon_icq'),
	'L_POSTER_ICQ' => $user->lang('ICQ'),
	'I_POSTER_AIM' => $user->img('icon_aim'),
	'L_POSTER_AIM' => $user->lang('AIM'),
	'I_POSTER_MSN' => $user->img('icon_msnm'),
	'L_POSTER_MSN' => $user->lang('MSNM'),
	'I_POSTER_YIM' => $user->img('icon_yim'),
	'L_POSTER_YIM' => $user->lang('YIM'),
));
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
if ( !empty($profiledata['user_viewemail']) || $userdata['user_level'] == ADMIN )
{
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
//-- delete
/*
#
#-----[ AFTER, ADD ]------------------------------------------
#
*/
//-- add
if ( (!empty($profiledata['user_viewemail']) && empty($config->data['email_disable'])) || ($user->data['user_level'] == ADMIN) )
{
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
	'S_PROFILE_ACTION' => append_sid("profile.$phpEx"))
);
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
// plugs
if ( $config->plug_ins[$requester] )
{
	foreach ( $config->plug_ins[$requester] as $plug => $dummy )
	{
		if ( method_exists($config->plug_ins[$requester][$plug], 'view') )
		{
			$config->plug_ins[$requester][$plug]->view($view_user);
		}
	}
}
//-- fin mod : categories hierarchy --------------------------------------------
#
################################################################################
#
#   tpls
#
################################################################################
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/bbcode.tpl
#
#-----[ FIND ]------------------------------------------------
#
<!-- BEGIN img --><img src="{URL}" border="0" /><!-- END img -->
#
#-----[ REPLACE WITH ]----------------------------------------
#
<!-- BEGIN img --><img src="{URL}" border="0" alt="" /><!-- END img -->
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/confirm_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
	<tr>
		<td class="nav" align="left"><a class="nav" href="{U_INDEX}">{L_INDEX}</a></td>
	</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
{NAVIGATION_BOX}
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/groupcp_info_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
<form action="{S_GROUPCP_ACTION}" method="post">

<table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
	<tr>
		<td align="left" class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a></td>
	</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<form action="{S_GROUPCP_ACTION}" method="post" name="post">
{NAVIGATION_BOX}
#
#-----[ FIND ]------------------------------------------------
#
{S_HIDDEN_FIELDS}

</form>

<form action="{S_GROUPCP_ACTION}" method="post" name="post">
#
#-----[ REPLACE WITH ]----------------------------------------
#
<!-- INCLUDE pagination_box.tpl -->
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full lines are longer
#
<tr>
{L_GROUP_MODERATOR}
</tr>
<tr>
{MOD_PM_IMG}
{MOD_USERNAME}
{MOD_POSTS}
{MOD_FROM}
{MOD_EMAIL_IMG}
{MOD_WWW_IMG}
</td>
</tr>
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
<!-- BEGIN moderator -->
#
#-----[ AFTER, ADD ]------------------------------------------
#
<!-- END moderator -->
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" border="0" align="center" cellpadding="2">
	<tr>
		<td align="left" valign="top">
		<!-- BEGIN switch_mod_option -->
		<span class="genmed"><input type="text"  class="post" name="username" maxlength="50" size="20" /> <input type="submit" name="add" value="{L_ADD_MEMBER}" class="mainoption" /> <input type="submit" name="usersubmit" value="{L_FIND_USERNAME}" class="liteoption" onClick="window.open('{U_SEARCH_USER}', '_phpbbsearch', 'HEIGHT=250,resizable=yes,WIDTH=400');return false;" /></span><br /><br />
		<!-- END switch_mod_option -->
		<span class="nav">{PAGE_NUMBER}</span></td>
		<td align="right" valign="top"><span class="gensmall">{S_TIMEZONE}</span><br /><span class="nav">{PAGINATION}</span></td>
	</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<!-- INCLUDE pagination_box.tpl -->

<!-- BEGIN switch_mod_option -->
<table width="100%" cellspacing="2" border="0" align="center" cellpadding="2">
<tr>
	<td align="left" valign="top"><span class="genmed">
		<input type="text" class="post" name="username" maxlength="50" size="20" /> <input type="submit" name="add" value="{L_ADD_MEMBER}" class="mainoption" /> <input type="submit" name="usersubmit" value="{L_FIND_USERNAME}" class="liteoption" onclick="window.open('{U_SEARCH_USER}', '_phpbbsearch', 'HEIGHT=250,resizable=yes,WIDTH=400');return false;" /><br /><br />
	</span></td>
</tr>
</table>
<!-- END switch_mod_option -->
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" border="0" align="center">
  <tr> 
	<td valign="top" align="right">{JUMPBOX}</td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/groupcp_user_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
  <tr> 
	<td align="left"><span class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a></span></td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<form method="post" name="post" action="{S_USERGROUP_ACTION}">
{NAVIGATION_BOX}
#
#-----[ FIND ]------------------------------------------------
#
		<tr><form method="get" action="{S_USERGROUP_ACTION}">
			<td width="40%"><span class="gensmall">{GROUP_MEMBER_SELECT}</span></td>
			<td align="center" width="30%"> 
			  <input type="submit" value="{L_VIEW_INFORMATION}" class="liteoption" />{S_HIDDEN_FIELDS}
			</td>
		</form></tr>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<tr>
			<td width="40%"><span class="gensmall">{GROUP_MEMBER_SELECT}</span></td>
			<td align="center" width="30%"> 
			  <input type="submit" name="group_member" value="{L_VIEW_INFORMATION}" class="liteoption" />
			</td>
		</tr>
#
#-----[ FIND ]------------------------------------------------
#
		<tr><form method="get" action="{S_USERGROUP_ACTION}">
			<td width="40%"><span class="gensmall">{GROUP_PENDING_SELECT}</span></td>
			<td align="center" width="30%"> 
			  <input type="submit" value="{L_VIEW_INFORMATION}" class="liteoption" />{S_HIDDEN_FIELDS}
			</td>
		</form></tr>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<tr>
			<td width="40%"><span class="gensmall">{GROUP_PENDING_SELECT}</span></td>
			<td align="center" width="30%"> 
			  <input type="submit" name="group_pending" value="{L_VIEW_INFORMATION}" class="liteoption" />
			</td>
		</tr>
#
#-----[ FIND ]------------------------------------------------
#
		<tr><form method="get" action="{S_USERGROUP_ACTION}">
			<td width="40%"><span class="gensmall">{GROUP_LIST_SELECT}</span></td>
			<td align="center" width="30%"> 
			  <input type="submit" value="{L_VIEW_INFORMATION}" class="liteoption" />{S_HIDDEN_FIELDS}
			</td>
		</form></tr>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<tr>
			<td width="40%"><span class="gensmall">{GROUP_LIST_SELECT}</span></td>
			<td align="center" width="30%"> 
			  <input type="submit" name="group_remaining" value="{L_VIEW_INFORMATION}" class="liteoption" />
			</td>
		</tr>
#
#-----[ FIND ]------------------------------------------------
#
  <!-- END switch_groups_remaining -->
</table>
#
#-----[ AFTER, ADD ]------------------------------------------
#
{S_HIDDEN_FIELDS}</form>
#
#-----[ FIND ]------------------------------------------------
#
<br clear="all" />

<table width="100%" cellspacing="2" border="0" align="center">
  <tr> 
	<td valign="top" align="right">{JUMPBOX}</td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/login_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
  <tr> 
	<td align="left" class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a></td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
{NAVIGATION_BOX}
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/memberlist_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
  <table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
	<tr> 
	  <td align="left"><span class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a></span></td>
	  <td align="right" nowrap="nowrap"><span class="genmed">{L_SELECT_SORT_METHOD}:&nbsp;{S_MODE_SELECT}&nbsp;&nbsp;{L_ORDER}&nbsp;{S_ORDER_SELECT}&nbsp;&nbsp; 
		<input type="submit" name="submit" value="{L_SUBMIT}" class="liteoption" />
		</span></td>
	</tr>
  </table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<table width="100%" cellpadding="4" cellspacing="1" border="0" class="forumline">
<tr>
	<th class="thHead" colspan="2">{L_OPTIONS}</th>
</tr>
<tr>
	<td class="row1" nowrap="nowrap"><span class="gen">{L_SEARCH_USERNAME}:&nbsp;</span><span class="gensmall"><br />{L_SEARCH_EXPLAIN}</span></td>
	<td class="row2" width="100%"><input type="text" class="post" name="username" value="{USERNAME}" size="25" /></td>
</tr>
<tr>
	<td class="row1"><span class="gen">{L_SELECT_SORT_METHOD}:&nbsp;</span></td>
	<td class="row2"><span class="gen">&nbsp;{S_MODE_SELECT}&nbsp;{S_ORDER_SELECT}</span></td>
</tr>
<!-- BEGIN user_admin -->
<tr>
	<td class="row1"><span class="gen">{L_INACTIVE}:&nbsp;</span></td>
	<td class="row2"><span class="gen">&nbsp;
		<input type="radio" name="inact" value="1"<!-- BEGIN inact --> checked="checked"<!-- END inact --> />{L_YES}&nbsp;
		<input type="radio" name="inact" value="0"<!-- BEGIN inact --><!-- BEGINELSE inact --> checked="checked"<!-- END inact --> />{L_NO}&nbsp;
	</span></td>
</tr>
<!-- END user_admin -->
<tr>
	<td class="catBottom" colspan="2" align="center">{S_HIDDEN_FIELDS}<span class="gensmall">&nbsp;
		<!-- BEGIN buttons --><input type="image" name="{buttons.BUTTON}" src="{buttons.I_BUTTON}" alt="{buttons.L_BUTTON}" title="{buttons.L_BUTTON}" <!-- BEGIN accesskey -->accesskey="{buttons.S_BUTTON}"<!-- END accesskey --> />&nbsp;<!-- END buttons -->
	</span></td>
</tr>
</table>
</form><br />
{NAVIGATION_BOX}

<!-- INCLUDE pagination_box.tpl -->
#
#-----[ FIND ]------------------------------------------------
#
	<!-- BEGIN memberrow -->
#
#-----[ AFTER, ADD ]------------------------------------------
#
	<!-- BEGIN active_status -->
	<tr>
		<td colspan="8" class="row3"><span class="genmed"><b>{memberrow.active_status.L_TITLE}</b></span></td>
	</tr>
	<!-- END active_status -->
#
#-----[ FIND ]------------------------------------------------
#
  <table width="100%" cellspacing="2" border="0" align="center" cellpadding="2">
	<tr> 
	  <td align="right" valign="top"></td>
	</tr>
  </table>

<table width="100%" cellspacing="0" cellpadding="0" border="0">
  <tr> 
	<td><span class="nav">{PAGE_NUMBER}</span></td>
	<td align="right"><span class="gensmall">{S_TIMEZONE}</span><br /><span class="nav">{PAGINATION}</span></td>
  </tr>
</table></form>

<table width="100%" cellspacing="2" border="0" align="center">
  <tr> 
	<td valign="top" align="right">{JUMPBOX}</td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#

<!-- INCLUDE pagination_box.tpl -->

<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/message_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
	<tr>
		<td align="left" class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a></td>
	</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
{NAVIGATION_BOX}
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/modcp_move.tpl
#
#-----[ FIND ]------------------------------------------------
#
<form action="{S_MODCP_ACTION}" method="post">
  <table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
	<tr> 
	  <td align="left" class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a></td>
	</tr>
  </table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<table border="0" cellpadding="4" cellspacing="1" width="100%">
<tr>
	<td><span class="maintitle">
		<a href="{U_MOD_CP}" class="maintitle">{L_MOD_CP}</a>
	</span><span class="gensmall"><br />
		<br />
	</span></td>
</tr>
</table>
<form action="{S_MODCP_ACTION}" method="post">
{NAVIGATION_BOX}
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/modcp_split.tpl
#
#-----[ FIND ]------------------------------------------------
#
<form method="post" action="{S_SPLIT_ACTION}">
  <table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
	<tr> 
	  <td align="left" class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a><span class="nav"> 
		-> <a href="{U_VIEW_FORUM}" class="nav">{FORUM_NAME}</a></span></td>
	</tr>
  </table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<table border="0" cellpadding="4" cellspacing="1" width="100%">
<tr>
	<td><span class="maintitle">
		<a href="{U_MOD_CP}" class="maintitle">{L_MOD_CP}</a>
	</span><span class="gensmall"><br />
		{L_SPLIT_TOPIC_EXPLAIN}<br />
	</span></td>
</tr>
</table>
<form method="post" action="{S_SPLIT_ACTION}">
{NAVIGATION_BOX}
#
#-----[ FIND ]------------------------------------------------
#
	<tr> 
	  <td class="row2" colspan="3" align="center"><span class="gensmall">{L_SPLIT_TOPIC_EXPLAIN}</span></td>
	</tr>
	<tr> 
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<tr>
#
#-----[ FIND ]------------------------------------------------
#
	<tr> 
	  <th class="thLeft" nowrap="nowrap">{L_AUTHOR}</th>
	  <th nowrap="nowrap">{L_MESSAGE}</th>
	  <th class="thRight" nowrap="nowrap">{L_SELECT}</th>
	</tr>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<tr> 
	  <th class="thLeft" nowrap="nowrap">{L_AUTHOR}</th>
	  <th class="thTop">{L_MESSAGE}</th>
	  <th class="thRight" nowrap="nowrap">&nbsp;{L_SELECT}&nbsp;</th>
	</tr>
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full line is longer
#
<img src="templates/subSilver/images/icon_minipost.gif" alt="{L_POST}">
#
#----------[ IN-LINE FIND ]-----------------------------------
#
<img src="templates/subSilver/images/icon_minipost.gif" alt="{L_POST}">
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
<img src="{I_POST}" alt="{L_POST}" />
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full line is longer
#
<img src="templates/subSilver/images/spacer.gif" width="1" height="1" alt=".">
#
#----------[ IN-LINE FIND ]-----------------------------------
#
<img src="templates/subSilver/images/spacer.gif" width="1" height="1" alt=".">
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
<img src="{I_SPACER}" width="1" height="1" alt="." />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/modcp_viewip.tpl
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
  <tr> 
	<td align="left"><span class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a></span></td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<table border="0" cellpadding="4" cellspacing="1" width="100%">
<tr>
	<td><span class="maintitle">
		<a href="{U_MOD_CP}" class="maintitle">{L_MOD_CP}</a>
	</span><span class="gensmall"><br />
		<br />
	</span></td>
</tr>
</table>

{NAVIGATION_BOX}
#
#-----[ FIND ]------------------------------------------------
#
		  <td align="right"><span class="gen">[ <a href="{iprow.U_LOOKUP_IP}">{L_LOOKUP_IP}</a> 
			]&nbsp;</span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		  <td align="right"><span class="gen">[ <a href="{iprow.U_LOOKUP_IP}">{L_LOOKUP_IP}</a> ]&nbsp;</span></td>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/overall_footer.tpl
#
#-----[ FIND ]------------------------------------------------
#
</body>
</html>
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
<!-- INCLUDE stat_run_body.tpl -->
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/overall_header.tpl
#
#-----[ FIND ]------------------------------------------------
#
hr	{ height: 0px; border: solid {T_TR_COLOR3} 0px; border-top-width: 1px;}
#
#-----[ AFTER, ADD ]------------------------------------------
#

/*--- mod : categories hierarchy */
form {
	margin: 0px;
	padding: 0px;
}
td.attachrow {
	color: #000000;
	font-size: 11px;
	font-weight: normal;
	border: 1px #006699 solid;
}
td.attachheader {
	color: #314687;
	font-size: 11px;
	font-weight: bold;
	background: #D7D7E7 url(images/cellpic1.gif) repeat-x;
	height: 21px;
	white-space: nowrap;
}
table.attachtable {
	color: #000000;
	font-size: 12px;
	font-weight: normal;
	border: 1px #006699 solid;
	border-collapse: collapse;
}
.absbottom {
	vertical-align: text-bottom;
}
.dom_overview_abshidden { position: absolute; visibility: hidden; width: 300px; }
/*--- fin mod : categories hierarchy */
#
#-----[ FIND ]------------------------------------------------
#
<img src="templates/subSilver/images/logo_phpBB.gif" border="0" alt="{L_INDEX}" vspace="1" />
#
#----------[ IN-LINE FIND ]-----------------------------------
#
<img src="templates/subSilver/images/logo_phpBB.gif" border="0" alt="{L_INDEX}" vspace="1" />
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
<img src="{I_LOGO}" border="0" alt="{L_INDEX}" vspace="1" />
#
#-----[ FIND ]------------------------------------------------
#
&nbsp;<a href="{U_FAQ}" class="mainmenu">
#
#----------[ IN-LINE FIND ]-----------------------------------
#
&nbsp;<a href="{U_FAQ}" class="mainmenu">
#
#----------[ IN-LINE BEFORE, ADD ]----------------------------
#
<!-- BEGIN topic_calendar -->&nbsp;<a href="{U_CALENDAR}" class="mainmenu"><img src="{I_CALENDAR}" width="12" height="13" border="0" alt="{L_CALENDAR}" hspace="3" />{L_CALENDAR}</a>&nbsp; <!-- END topic_calendar -->
#
#-----[ FIND ]------------------------------------------------
#
{U_PROFILE}
#
#----------[ IN-LINE FIND ]-----------------------------------
#
{U_PROFILE}
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
{U_PREFERENCES}
#
#-----[ FIND ]------------------------------------------------
#
		</table>

		<br />
#
#-----[ AFTER, ADD ]------------------------------------------
#
		{CALENDAR_BOX}
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/posting_smilies.tpl
#
#-----[ FIND ]------------------------------------------------
#
<script language="javascript" type="text/javascript">
<!--
function emoticon(text) {
	text = ' ' + text + ' ';
	if (opener.document.forms['post'].message.createTextRange && opener.document.forms['post'].message.caretPos) {
		var caretPos = opener.document.forms['post'].message.caretPos;
		caretPos.text = caretPos.text.charAt(caretPos.text.length - 1) == ' ' ? text + ' ' : text;
		opener.document.forms['post'].message.focus();
	} else {
	opener.document.forms['post'].message.value  += text;
	opener.document.forms['post'].message.focus();
	}
}
//-->
</script>

<table width="100%" border="0" cellspacing="0" cellpadding="10">
#
#-----[ REPLACE WITH ]----------------------------------------
#
<table width="100%" border="0" cellspacing="0" cellpadding="10">
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full line is longer
#
javascript:emoticon('{smilies_row.smilies_col.SMILEY_CODE}')
#
#----------[ IN-LINE FIND ]-----------------------------------
#
emoticon
#
#----------[ IN-LINE BEFORE, ADD ]----------------------------
#
opener.
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full line is longer
#
{L_MORE_SMILIES}
#
#----------[ IN-LINE FIND ]-----------------------------------
#
<span  class="nav">
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
<span class="nav">
#
#----------[ IN-LINE FIND ]-----------------------------------
#
return false"
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
return false;"
#
#----------[ IN-LINE FIND ]-----------------------------------
#
</td>
#
#----------[ IN-LINE BEFORE, ADD ]----------------------------
#
</span>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/posting_topic_review.tpl
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full lines are longer
#
<table
<tr>
{L_AUTHOR}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#

<form method="post" name="post" action="{S_POST_DAYS_ACTION}">
<!-- INCLUDE pagination_box.tpl -->
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full line is longer
#
<span class="name"><a name="{postrow.U_POST_ID}"></a>
#
#----------[ IN-LINE FIND ]-----------------------------------
#
<span class="name"><a name="{postrow.U_POST_ID}"></a>
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
<span class="name">
#
#-----[ FIND ]------------------------------------------------
#
				<td width="100%"><img src="{postrow.MINI_POST_IMG}" width="12" height="9" alt="{postrow.L_MINI_POST_ALT}" title="{postrow.L_MINI_POST_ALT}" border="0" /><span class="postdetails">{L_POSTED}: {postrow.POST_DATE}<span class="gen">&nbsp;</span>&nbsp;&nbsp;&nbsp;{L_POST_SUBJECT}: {postrow.POST_SUBJECT}</span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
				<td width="100%"><a href="{postrow.U_POST}" title="{postrow.L_POST}"><img src="{postrow.I_POST}" width="12" height="9" alt="{postrow.L_POST}" border="0" /></a><span class="postdetails">{L_POSTED}: {postrow.POST_DATE}<span class="gen">&nbsp;</span>&nbsp;&nbsp;&nbsp;{L_POST_SUBJECT}:
					<!-- BEGIN msg_icon --><img src="{postrow.msg_icon.I_ICON}" border="0" title="{postrow.msg_icon.L_ICON}" class="absbottom" />&nbsp;<!-- END msg_icon -->
					<!-- BEGIN sub_type --><!-- BEGIN img --><img src="{postrow.sub_type.I_SUB_TYPE}" border="0" alt="{postrow.sub_type.L_SUB_TYPE}" title="{postrow.sub_type.L_SUB_TYPE}" class="absbottom" />&nbsp;<!-- END img --><!-- BEGIN txt --><b>[{postrow.sub_type.L_SUB_TYPE}]</b>&nbsp;<!-- END txt --><!-- END sub_type -->
					{postrow.POST_SUBJECT}
					<!-- BEGIN sub_title --><br />{L_SUB_TITLE}: {postrow.sub_title.SUB_TITLE}<!-- END sub_title -->
					<!-- BEGIN announce --><br />{postrow.announce.S_ANNOUNCE}<!-- END announce -->
					<!-- BEGIN calendar_event --><br />{postrow.calendar_event.S_CALENDAR_EVENT}<!-- END calendar_event -->
				</span></td>
#
#-----[ FIND ]------------------------------------------------
#
				<td colspan="2"><span class="postbody">{postrow.MESSAGE}</span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
				<td colspan="2">
					<span class="postbody">{postrow.MESSAGE}</span>
					{postrow.ATTACHMENTS}
				</td>
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full line is longer
#
<img src="templates/subSilver/images/spacer.gif" alt="" width="1" height="1" />
#
#----------[ IN-LINE FIND ]-----------------------------------
#
<img src="templates/subSilver/images/spacer.gif" alt="" width="1" height="1" />
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
<img src="{I_SPACER}" alt="" width="1" height="1" />
#
#-----[ FIND ]------------------------------------------------
#
	 <!-- END postrow -->
#
#-----[ AFTER, ADD ]------------------------------------------
#
<!-- BEGIN empty -->
<tr>
	<td colspan="2" class="row1" height="35" align="center"><span class="gen">{L_EMPTY}
	</span></td>
</tr>
<!-- END empty -->
<tr>
	<td class="catBottom" colspan="2" height="28" align="center"><span class="gensmall">
		{L_DISPLAY_POSTS}:&nbsp;<select name="postdays">{POSTDAYS}</select>&nbsp;&nbsp;{L_SORT_BY}:&nbsp;<select name="sort">{SORT}</select>&nbsp;<select name="postorder">{POSTORDER}</select>&nbsp;<input type="image" src="{I_GO}" value="{L_GO}" name="submit" align="top" />
	</span></td>
</tr>
#
#-----[ FIND ]------------------------------------------------
#
<!-- BEGIN switch_inline_mode -->
		</iframe></td>
	</tr>
</table>
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
<!-- INCLUDE pagination_box.tpl -->
</form>
#
#-----[ AFTER, ADD ]------------------------------------------
#
<table width="100%" border="0" cellpadding="0" cellspacing="0"><tr><td align="right"><span class="gensmall"><a href="#top" class="gensmall">{L_BACK_TO_TOP}</a></span></td></tr></table>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/privmsgs_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
	<td valign="top" align="center" width="100%"> 
	  <table height="40" cellspacing="2" cellpadding="2" border="0">
		<tr valign="middle"> 
		  <td>{INBOX_IMG}</td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<td>{ATTACH_QUOTA_BOX}</td>
	<td valign="top" align="center" width="100%"> 
	  <table cellspacing="2" cellpadding="2" border="0">
		<tr valign="middle"> 
		  <td>{INBOX_IMG}</td>
#
#-----[ FIND ]------------------------------------------------
#
	<td align="right"> 
	  <!-- BEGIN switch_box_size_notice -->
	  <table width="175" cellspacing="1" cellpadding="2" border="0" class="bodyline">
		<tr> 
		  <td colspan="3" width="175" class="row1" nowrap="nowrap"><span class="gensmall">{BOX_SIZE_STATUS}</span></td>
		</tr>
		<tr> 
		  <td colspan="3" width="175" class="row2">
			<table cellspacing="0" cellpadding="1" border="0">
			  <tr> 
				<td bgcolor="{T_TD_COLOR2}"><img src="templates/subSilver/images/spacer.gif" width="{INBOX_LIMIT_IMG_WIDTH}" height="8" alt="{INBOX_LIMIT_PERCENT}" /></td>
			  </tr>
			</table>
		  </td>
		</tr>
		<tr> 
		  <td width="33%" class="row1"><span class="gensmall">0%</span></td>
		  <td width="34%" align="center" class="row1"><span class="gensmall">50%</span></td>
		  <td width="33%" align="right" class="row1"><span class="gensmall">100%</span></td>
		</tr>
	  </table>
	  <!-- END switch_box_size_notice -->
	</td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<td align="right">{PM_QUOTA_BOX}</td>
#
#-----[ FIND ]------------------------------------------------
#
<form method="post" name="privmsg_list" action="{S_PRIVMSGS_ACTION}">
#
#-----[ AFTER, ADD ]------------------------------------------
#
{NAVIGATION_BOX}
#
#-----[ FIND ]------------------------------------------------
#
	  <td align="left" valign="middle">{POST_PM_IMG}</td>
	  <td align="left" width="100%">&nbsp;<span class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a></span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	  <td align="left" valign="middle">{POST_PM_IMG}</td>
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full lines are longer
#
<table
<tr>
{L_FLAG}
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
<!-- INCLUDE pagination_box.tpl -->
#
#-----[ FIND ]------------------------------------------------
#
	  <td width="55%" valign="middle" class="{listrow.ROW_CLASS}"><span class="topictitle">&nbsp;<a href="{listrow.U_READ}" class="topictitle">{listrow.SUBJECT}</a></span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	  <td width="55%" valign="middle" class="{listrow.ROW_CLASS}"><span class="topictitle"><!-- BEGIN attach --><img src="{I_ATTACH}" alt="" border="0" />&nbsp;<!-- END attach --><a href="{listrow.U_READ}" class="topictitle">{listrow.SUBJECT}</a></span></td>
#
#-----[ FIND ]------------------------------------------------
#
  <table width="100%" cellspacing="2" border="0" align="center" cellpadding="2">
	<tr> 
	  <td align="left" valign="middle"><span class="nav">{POST_PM_IMG}</span></td>
	  <td align="left" valign="middle" width="100%"><span class="nav">{PAGE_NUMBER}</span></td>
	  <td align="right" valign="top" nowrap="nowrap"><b><span class="gensmall"><a href="javascript:select_switch(true);" class="gensmall">{L_MARK_ALL}</a> :: <a href="javascript:select_switch(false);" class="gensmall">{L_UNMARK_ALL}</a></span></b><br /><span class="nav">{PAGINATION}<br /></span><span class="gensmall">{S_TIMEZONE}</span></td>
	</tr>
  </table>
</form>

<table width="100%" border="0">
  <tr> 
	<td align="right" valign="top">{JUMPBOX}</td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<!-- INCLUDE pagination_box.tpl -->

  <table width="100%" cellspacing="2" border="0" align="center" cellpadding="2">
	<tr> 
	  <td align="left" valign="middle"><span class="nav">{POST_PM_IMG}</span></td>
	</tr>
  </table>
</form>

<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/privmsgs_read_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
<form method="post" action="{S_PRIVMSGS_ACTION}">
#
#-----[ AFTER, ADD ]------------------------------------------
#
{NAVIGATION_BOX}
#
#-----[ FIND ]------------------------------------------------
#
	  <td valign="middle">{REPLY_PM_IMG}</td>
	  <td width="100%"><span class="nav">&nbsp;<a href="{U_INDEX}" class="nav">{L_INDEX}</a></span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	  <td valign="middle">{REPLY_PM_IMG}</td>
#
#-----[ FIND ]------------------------------------------------
#
	  <td valign="top" colspan="3" class="row1"><span class="postbody">{MESSAGE}</span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	  <td valign="top" colspan="3" class="row1">
		<span class="postbody">{MESSAGE}</span>
		{ATTACHMENTS}
		<span class="postbody"><br /><!-- BEGIN signature -->_________________<br />{SIGNATURE}<br /><!-- END signature --></span>
	  </td>
#
#-----[ FIND ]------------------------------------------------
#
	<tr> 
	  <td width="78%" height="28" valign="bottom" colspan="3" class="row1"> 
		<table cellspacing="0" cellpadding="0" border="0" height="18">
		  <tr> 
			<td valign="middle" nowrap="nowrap">{PROFILE_IMG} {PM_IMG} {EMAIL_IMG} 
			  {WWW_IMG} {AIM_IMG} {YIM_IMG} {MSN_IMG}</td><td>&nbsp;</td><td valign="top" nowrap="nowrap"><script language="JavaScript" type="text/javascript"><!-- 

		if ( navigator.userAgent.toLowerCase().indexOf('mozilla') != -1 && navigator.userAgent.indexOf('5.') == -1 && navigator.userAgent.indexOf('6.') == -1 )
			document.write('{ICQ_IMG}');
		else
			document.write('<div style="position:relative"><div style="position:absolute">{ICQ_IMG}</div><div style="position:absolute;left:3px">{ICQ_STATUS_IMG}</div></div>');
		  
		  //--></script><noscript>{ICQ_IMG}</noscript></td>
		  </tr>
		</table>
	  </td>
	</tr>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<tr>
	<td style="padding: 0px" colspan="3"><table style="width: 100%; border: 0px" cellspacing="0">
	<tr>
		<td class="row1" style="padding-top: 4px; vertical-align: middle; white-space: nowrap">
			<div style="float: left; text-align: left">
				<!-- BEGIN profile -->&nbsp;<a href="{U_PROFILE}"><img src="{I_POSTER_PROFILE}" alt="{L_POSTER_PROFILE}" title="{L_POSTER_PROFILE}" border="0" /></a><!-- END profile -->
				<!-- BEGIN pm -->&nbsp;<a href="{U_PM}"><img src="{I_POSTER_PM}" alt="{L_POSTER_PM}" title="{L_POSTER_PM}" border="0" /></a><!-- END pm -->
				<!-- BEGIN email -->&nbsp;<a href="{U_EMAIL}"><img src="{I_POSTER_EMAIL}" alt="{L_POSTER_EMAIL}" title="{L_POSTER_EMAIL}" border="0" /></a><!-- END email -->
				<!-- BEGIN www -->&nbsp;<a href="{U_WWW}" target="userwww"><img src="{I_POSTER_WWW}" alt="{L_POSTER_WWW}" title="{L_POSTER_WWW}" border="0" /></a><!-- END www -->
				<!-- BEGIN aim -->&nbsp;<a href="{U_AIM}"><img src="{I_POSTER_AIM}" alt="{L_POSTER_AIM}" title="{L_POSTER_AIM}" border="0" /></a><!-- END aim -->
				<!-- BEGIN yim -->&nbsp;<a href="{U_YIM}"><img src="{I_POSTER_YIM}" alt="{L_POSTER_YIM}" title="{L_POSTER_YIM}" border="0" /></a><!-- END yim -->
				<!-- BEGIN msn -->&nbsp;<a href="{U_MSN}"><img src="{I_POSTER_MSN}" alt="{L_POSTER_MSN}" title="{L_POSTER_MSN}" border="0" /></a><!-- END msn -->
			</div>
			<!-- BEGIN icq -->
			<div style="float: left; text-align: left; position: relative">&nbsp;<a href="{U_ICQ}"><img src="{I_POSTER_ICQ}" alt="{L_POSTER_ICQ}" title="{L_POSTER_ICQ}" border="0" /></a>&nbsp;<div id="icq_status_user" style="position: absolute; left: 9px; top: -1px; display: none"><a href="{U_ICQ_STATUS}" title=""><img src="{I_ICQ_STATUS}" width="18" height="18" alt="" border="0" /></a></div></div>
			<!-- END icq -->
		</td>
	</tr>
	</table></td>
</tr>
#
#-----[ FIND ]------------------------------------------------
#
		<input type="submit" name="delete" value="{L_DELETE_MSG}" class="liteoption" />
#
#-----[ AFTER, ADD ]------------------------------------------
#
		<!-- BEGIN switch_attachments -->
		&nbsp;<input type="submit" name="pm_delete_attach" value="{L_DELETE_ATTACHMENTS}" class="liteoption" />
		<!-- END switch_attachments -->
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" border="0" align="center" cellpadding="2">
  <tr> 
	<td valign="top" align="right"><span class="gensmall">{JUMPBOX}</span></td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<br clear="all" />

<script language="JavaScript" type="text/javascript"><!--//
function _icq()
{
	this.ids = new Array();
	return this;
}
	_icq.prototype.objref = function(id)
	{
		return document.getElementById ? document.getElementById(id) : (document.all ? document.all[id] : (document.layers ? document.layers[id] : null));
	}
	_icq.prototype.display_status = function()
	{
		if ( (navigator.userAgent.toLowerCase().indexOf('mozilla') == -1) || (navigator.userAgent.indexOf('5.') != -1) || (navigator.userAgent.indexOf('6.') != -1) )
		{
			for ( i = 1; i < this.ids.length; i++ )
			{
				icq_status = this.objref(this.ids[i]);
				if ( icq_status && icq_status.style )
				{
					icq_status.style.display = '';
				}
			}
		}
	}

icq_status = new _icq();
icq_status.ids = Array('', 'icq_status_user');
icq_status.display_status();
//--></script>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/profile_send_email.tpl
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
	<tr>
		<td align="left"><span  class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a></span></td>
	</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
{NAVIGATION_BOX}
#
#-----[ FIND ]------------------------------------------------
#
</table></form>

<table width="100%" cellspacing="2" border="0" align="center">
	<tr>
		<td valign="top" align="right">{JUMPBOX}</td>
	</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
</table></form>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/profile_send_pass.tpl
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
  <tr> 
	<td align="left"><span class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a></span></td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
{NAVIGATION_BOX}
#
#-----[ FIND ]------------------------------------------------
#
	<tr> 
	  <td class="catBottom" colspan="2" align="center" height="28">{S_HIDDEN_FIELDS} 
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
<!-- INCLUDE visual_confirm_box.tpl -->
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/profile_view_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
  <tr> 
	<td align="left"><span class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a></span></td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
{NAVIGATION_BOX}
#
#-----[ FIND ]------------------------------------------------
#
	<td class="row1" height="6" valign="top" align="center">{AVATAR_IMG}<br /><span class="postdetails">{POSTER_RANK}</span></td>
	<td class="row1" rowspan="3" valign="top"><table width="100%" border="0" cellspacing="1" cellpadding="3">
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<td class="row1" height="6" align="center">{AVATAR_IMG}<br /><span class="postdetails">{POSTER_RANK}</span><!-- BEGIN rank --><!-- BEGIN img --><br />{RANK_IMAGE}<!-- END img --><!-- END rank --></td>
	<td class="row1" valign="top"><table width="100%" border="0" cellspacing="1" cellpadding="3">
#
#-----[ FIND ]------------------------------------------------
#
		  <td width="100%"><b><span class="gen">{JOINED}</span></b></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		  <td width="100%"><!-- BEGIN poster_joined --><b><span class="gen">{JOINED}</span></b><!-- BEGINELSE poster_joined -->&nbsp;<!-- END poster_joined --></td>
#
#-----[ FIND ]------------------------------------------------
#
		  <td valign="top"><b><span class="gen">{POSTS}</span></b><br /><span class="genmed">[{POST_PERCENT_STATS} / {POST_DAY_STATS}]</span> <br /><span class="genmed"><a href="{U_SEARCH_USER}" class="genmed">{L_SEARCH_USER_POSTS}</a></span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		  <td valign="top"><!-- BEGIN poster_posts --><b><span class="gen">{POSTS}</span></b><br /><span class="genmed">[{POST_PERCENT_STATS} / {POST_DAY_STATS}]</span> <br /><span class="genmed"><a href="{U_SEARCH_USER}" class="genmed">{L_SEARCH_USER_POSTS}</a></span><!-- BEGINELSE poster_posts -->&nbsp;<!-- END poster_posts --></td>
#
#-----[ FIND ]------------------------------------------------
#
		  <td><b><span class="gen">{LOCATION}</span></b></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		  <td><!-- BEGIN poster_from --><b><span class="gen">{LOCATION}</span></b><!-- BEGINELSE poster_from -->&nbsp;<!-- END poster_from --></td>
#
#-----[ FIND ]------------------------------------------------
#
		  <td><span class="gen"><b>{WWW}</b></span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		  <td><!-- BEGIN www --><span class="gen"><b>{WWW}</b></span><!-- BEGINELSE www -->&nbsp;<!-- END www --></td>
#
#-----[ FIND ]------------------------------------------------
#
		  <td><b><span class="gen">{OCCUPATION}</span></b></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		  <td><!-- BEGIN poster_occ --><b><span class="gen">{OCCUPATION}</span></b><!-- BEGINELSE poster_occ -->&nbsp;<!-- END poster_occ --></td>
#
#-----[ FIND ]------------------------------------------------
#
		  <td> <b><span class="gen">{INTERESTS}</span></b></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		  <td><!-- BEGIN poster_interests --><b><span class="gen">{INTERESTS}</span></b><!-- BEGINELSE poster_interests -->&nbsp;<!-- END poster_interests --></td>
#
#-----[ FIND ]------------------------------------------------
#
	<td class="catLeft" align="center" height="28"><b><span class="gen">{L_CONTACT} {USERNAME} </span></b></td>
#
#-----[ AFTER, ADD ]------------------------------------------
#
	<td class="catRight"><b><span class="gen">{L_POSTER_SIGNATURE}</span></b></td>
#
#-----[ FIND ]------------------------------------------------
#
		  <td class="row1" valign="middle" width="100%"><b><span class="gen">{EMAIL_IMG}</span></b></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		  <td class="row1" valign="middle" width="100%"><!-- BEGIN email --><b><span class="gen">{EMAIL_IMG}</span></b><!-- BEGINELSE email -->&nbsp;<!-- END email --></td>
#
#-----[ FIND ]------------------------------------------------
#
		  <td class="row1" valign="middle"><b><span class="gen">{PM_IMG}</span></b></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		  <td class="row1" valign="middle"><!-- BEGIN pm --><b><span class="gen">{PM_IMG}</span></b><!-- BEGINELSE pm -->&nbsp;<!-- END pm --></td>
#
#-----[ FIND ]------------------------------------------------
#
		  <td class="row1" valign="middle"><span class="gen">{MSN}</span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		  <td class="row1" valign="middle"><!-- BEGIN msn --><span class="gen">{MSN}</span><!-- BEGINELSE msn -->&nbsp;<!-- END msn --></td>
#
#-----[ FIND ]------------------------------------------------
#
		  <td class="row1" valign="middle"><span class="gen">{YIM_IMG}</span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		  <td class="row1" valign="middle"><!-- BEGIN yim --><span class="gen">{YIM_IMG}</span><!-- BEGINELSE yim -->&nbsp;<!-- END yim --></td>
#
#-----[ FIND ]------------------------------------------------
#
		  <td class="row1" valign="middle"><span class="gen">{AIM_IMG}</span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		  <td class="row1" valign="middle"><!-- BEGIN aim --><span class="gen">{AIM_IMG}</span><!-- BEGINELSE aim -->&nbsp;<!-- END aim --></td>
#
#-----[ FIND ]------------------------------------------------
#
		  <td class="row1"><script language="JavaScript" type="text/javascript"><!-- 

		if ( navigator.userAgent.toLowerCase().indexOf('mozilla') != -1 && navigator.userAgent.indexOf('5.') == -1 && navigator.userAgent.indexOf('6.') == -1 )
			document.write(' {ICQ_IMG}');
		else
			document.write('<table cellspacing="0" cellpadding="0" border="0"><tr><td nowrap="nowrap"><div style="position:relative;height:18px"><div style="position:absolute">{ICQ_IMG}</div><div style="position:absolute;left:3px;top:-1px">{ICQ_STATUS_IMG}</div></div></td></tr></table>');
		  
		  //--></script><noscript>{ICQ_IMG}</noscript></td>
		</tr>
	  </table>
	</td>
  </tr>
</table>

<table width="100%" border="0" cellspacing="0" cellpadding="0" align="center">
  <tr> 
	<td align="right"><span class="nav"><br />{JUMPBOX}</span></td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<td class="row1"><!-- BEGIN icq --><table cellspacing="0" cellpadding="0" border="0"><tr><td height="18" valign="top" nowrap="nowrap">
			<div style="position:relative"><a href="{U_ICQ}" title="{L_POSTER_ICQ}"><img src="{I_POSTER_ICQ}" border="0" alt="{L_POSTER_ICQ}" /></a>&nbsp;<div id="icq_status_user" style="position:absolute; left:3px; top:-1px; display:none"><a href="{U_ICQ_STATUS}" title=""><img src="{I_ICQ_STATUS}" width="18" height="18" border="0" alt="" /></a></div></div>
		</td></tr></table><!-- BEGINELSE icq -->&nbsp;<!-- END icq --></td>
		</tr>
	  </table>
	</td>
	<td class="row1" valign="top"><!-- BEGIN signature --><span class="postbody">{SIGNATURE}</span><!-- BEGINELSE signature -->&nbsp;<!-- END signature --></td>
  </tr>
<tr>
	<td class="catBottom" colspan="2" nowrap="nowrap" align="center"><span class="genmed">&nbsp;
		<!-- BEGIN buttons --><a href="{buttons.U_BUTTON}" title="{buttons.L_BUTTON}" accesskey="{buttons.S_BUTTON}"><img src="{buttons.I_BUTTON}" border="0" alt="{buttons.L_BUTTON}" /></a>&nbsp;<!-- END buttons -->
	</span></td>
</tr>
</table>

<script language="JavaScript" type="text/javascript"><!--//
function _icq()
{
	this.ids = new Array();
	return this;
}
	_icq.prototype.objref = function(id)
	{
		return document.getElementById ? document.getElementById(id) : (document.all ? document.all[id] : (document.layers ? document.layers[id] : null));
	}
	_icq.prototype.display_status = function()
	{
		if ( (navigator.userAgent.toLowerCase().indexOf('mozilla') == -1) || (navigator.userAgent.indexOf('5.') != -1) || (navigator.userAgent.indexOf('6.') != -1) )
		{
			for ( i = 1; i < this.ids.length; i++ )
			{
				icq_status = this.objref(this.ids[i]);
				if ( icq_status && icq_status.style )
				{
					icq_status.style.display = '';
				}
			}
		}
	}

icq_status = new _icq();
icq_status.ids = Array('', 'icq_status_user');
icq_status.display_status();
//--></script>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/search_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
<form action="{S_SEARCH_ACTION}" method="POST"><table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
	<tr> 
		<td align="left"><span class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a></span></td>
	</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<form action="{S_SEARCH_ACTION}" method="POST">

{NAVIGATION_BOX}
#
#-----[ FIND ]------------------------------------------------
#
<table class="forumline" width="100%" cellpadding="4" cellspacing="1" border="0">
#
#-----[ AFTER, ADD ]------------------------------------------
#
<colgroup>
	<col width="20%">
	<col width="30%">
	<col width="20%">
	<col width="30%">
</colgroup>
#
#-----[ FIND ]------------------------------------------------
#
	<tr> 
		<th class="thHead" colspan="4" height="25">{L_SEARCH_OPTIONS}</th>
	</tr>
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
	<tr>
		<td class="row1" colspan="2"><span class="gen">{L_SEARCH_FORUM}:&nbsp;</span></td>
		<td class="row2" colspan="2"><span class="genmed"><select class="post" name="search_forum">{S_FORUM_OPTIONS}</select></span><span class="gensmall"><br /><input name="no_subs" type="checkbox" value="1" {S_NO_SUBS} />{L_NO_SUBS}</span></td>
	</tr>
#
#-----[ FIND ]------------------------------------------------
#
	<tr> 
		<td class="row1" align="right"><span class="gen">{L_FORUM}:&nbsp;</span></td>
		<td class="row2"><span class="genmed"><select class="post" name="search_forum">{S_FORUM_OPTIONS}</select></span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<tr>
#
#-----[ FIND ]------------------------------------------------
#
		<td class="row2" valign="middle"><span class="genmed"><select class="post" name="search_time">{S_TIME_OPTIONS}</select><br /><input type="radio" name="search_fields" value="all" checked="checked" /> {L_SEARCH_MESSAGE_TITLE}<br /><input type="radio" name="search_fields" value="msgonly" /> {L_SEARCH_MESSAGE_ONLY}</span></td>
	</tr>
	<tr> 
		<td class="row1" align="right"><span class="gen">{L_CATEGORY}:&nbsp;</span></td>
		<td class="row2"><span class="genmed"><select class="post" name="search_cat">{S_CATEGORY_OPTIONS}
		</select></span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<td class="row2" valign="middle"><span class="genmed"><select class="post" name="search_time">{S_TIME_OPTIONS}</select><br /><input type="radio" name="search_fields" value="all" checked="checked" /> {L_SEARCH_MESSAGE_TITLE}<br /><input type="radio" name="search_fields" value="msgonly" /> {L_SEARCH_MESSAGE_ONLY}<br /><input type="radio" name="search_fields" value="titleonly" /> {L_SEARCH_TITLE_ONLY}</span></td>
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" border="0">
	<tr>
		<td align="right" valign="top">{JUMPBOX}</td>
	</tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/search_results_posts.tpl
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
  <tr> 
	<td align="left"><span class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a></span></td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
{NAVIGATION_BOX}

<!-- INCLUDE pagination_box.tpl -->
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full line is longer
#
<img src="templates/subSilver/images/folder.gif" align="absmiddle" />
#
#----------[ IN-LINE FIND ]-----------------------------------
#
<img src="templates/subSilver/images/folder.gif" align="absmiddle" />
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
<img src="{I_TOPIC}" alt="" align="middle" />
#
#-----[ FIND ]------------------------------------------------
#
	<td width="100%" valign="top" class="row1"><img src="{searchresults.MINI_POST_IMG}" width="12" height="9" alt="{searchresults.L_MINI_POST_ALT}" title="{searchresults.L_MINI_POST_ALT}" border="0" /><span class="postdetails">{L_FORUM}:&nbsp;<b><a href="{searchresults.U_FORUM}" class="postdetails">{searchresults.FORUM_NAME}</a></b>&nbsp; &nbsp;{L_POSTED}: {searchresults.POST_DATE}&nbsp; &nbsp;{L_SUBJECT}: <b><a href="{searchresults.U_POST}">{searchresults.POST_SUBJECT}</a></b></span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<td width="100%" valign="top" class="row1"><span class="postdetails">
		<a href="{searchresults.U_POST}" title="{searchresults.L_POST}"><img src="{searchresults.I_POST}" alt="{searchresults.L_POST}" border="0" /></a>
		{L_POSTED}: {searchresults.POST_DATE}<span class="gen">&nbsp;</span>&nbsp; &nbsp;{L_SUBJECT}:
		<!-- BEGIN msg_icon --><img src="{searchresults.msg_icon.I_ICON}" border="0" title="{searchresults.msg_icon.L_ICON}" class="absbottom" />&nbsp;<!-- END msg_icon -->
		<!-- BEGIN sub_type --><!-- BEGIN img --><img src="{searchresults.sub_type.I_SUB_TYPE}" border="0" alt="{searchresults.sub_type.L_SUB_TYPE}" title="{searchresults.sub_type.L_SUB_TYPE}" class="absbottom" />&nbsp;<!-- END img --><!-- BEGIN txt --><b>[{searchresults.sub_type.L_SUB_TYPE}]</b>&nbsp;<!-- END txt --><!-- END sub_type -->
		<b><a href="{searchresults.U_POST}">{searchresults.POST_SUBJECT}</a></b>
		<!-- BEGIN sub_title --><br />{L_SUB_TITLE}: {searchresults.sub_title.SUB_TITLE}<!-- END sub_title -->
		<!-- BEGIN announce --><br />{searchresults.announce.S_ANNOUNCE}<!-- END announce -->
		<!-- BEGIN calendar_event --><br />{searchresults.calendar_event.S_CALENDAR_EVENT}<!-- END calendar_event -->
		<br />{L_FORUM}:&nbsp;
		<!-- BEGIN nav --><a href="{searchresults.nav.U_NAV}" title="{searchresults.nav.L_NAV_DESC}" class="postdetails">{searchresults.nav.L_NAV}</a><!-- BEGIN sep --> &raquo;&nbsp;<!-- END sep --><!-- END nav -->
	</span></td>
#
#-----[ FIND ]------------------------------------------------
#
	<td valign="top" class="row1"><span class="postbody">{searchresults.MESSAGE}</span></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<td valign="top" class="row1">
		<span class="postbody">{searchresults.MESSAGE}</span>
		{searchresults.ATTACHMENTS}
	</td>
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" border="0" align="center" cellpadding="2">
  <tr> 
	<td align="left" valign="top"><span class="nav">{PAGE_NUMBER}</span></td>
	<td align="right" valign="top" nowrap="nowrap"><span class="nav">{PAGINATION}</span><br /><span class="gensmall">{S_TIMEZONE}</span></td>
  </tr>
</table>

<table width="100%" cellspacing="2" border="0" align="center">
  <tr> 
	<td valign="top" align="right">{JUMPBOX}</td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<!-- INCLUDE pagination_box.tpl -->

{NAVIGATION_BOX}
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/search_username.tpl
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full line is longer
#
onClick=
#
#----------[ IN-LINE FIND ]-----------------------------------
#
onClick=
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
onclick=
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/simple_footer.tpl
#
#-----[ FIND ]------------------------------------------------
#
		</td>
	</tr>
</table>

</body>
</html>
#
#-----[ REPLACE WITH ]----------------------------------------
#

</body>
</html>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/simple_header.tpl
#
#-----[ FIND ]------------------------------------------------
#
<meta http-equiv="Content-Style-Type" content="text/css" />
<style type="text/css">
<!--
-->
</style>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<meta http-equiv="Content-Style-Type" content="text/css" />
#
#-----[ FIND ]------------------------------------------------
#
hr	{ height: 0px; border: solid {T_TR_COLOR3} 0px; border-top-width: 1px;}
#
#-----[ AFTER, ADD ]------------------------------------------
#

/*--- mod : categories hierarchy */
form {
	margin: 0px;
	padding: 0px;
}
td.attachrow {
	color: #000000;
	font-size: 11px;
	font-weight: normal;
	border: 1px #006699 solid;
}
td.attachheader {
	color: #314687;
	font-size: 11px;
	font-weight: bold;
	background: #D7D7E7 url(images/cellpic1.gif) repeat-x;
	height: 21px;
	white-space: nowrap;
}
table.attachtable {
	color: #000000;
	font-size: 12px;
	font-weight: normal;
	border: 1px #006699 solid;
	border-collapse: collapse;
}
.absbottom {
	vertical-align: text-bottom;
}
.dom_overview_abshidden { position: absolute; visibility: hidden; width: 300px; }
/*--- fin mod : categories hierarchy */
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/subSilver.cfg
#
#-----[ FIND ]------------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : categories hierarchy ------------------------------------------------
#
#-----[ FIND ]------------------------------------------------
#
$board_config['privmsg_graphic_length'] = 175;
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : categories hierarchy ------------------------------------------------
//-- add
// vote bars sides
$images['voting_left'][0] = "$current_template_images/vote_lcap.gif";
$images['voting_left'][1] = "$current_template_images/vote_lcap.gif";
$images['voting_left'][2] = "$current_template_images/vote_lcap.gif";
$images['voting_left'][3] = "$current_template_images/vote_lcap.gif";
$images['voting_left'][4] = "$current_template_images/vote_lcap.gif";
$images['voting_right'][0] = "$current_template_images/vote_rcap.gif";
$images['voting_right'][1] = "$current_template_images/vote_rcap.gif";
$images['voting_right'][2] = "$current_template_images/vote_rcap.gif";
$images['voting_right'][3] = "$current_template_images/vote_rcap.gif";
$images['voting_right'][4] = "$current_template_images/vote_rcap.gif";

// page header
$images['logo'] = "$current_template_images/logo_phpBB.gif";
$images['logo_small'] = "$current_template_images/logo_phpBB_med.gif";
$images['earth'] = $current_template_images . '/earth.gif';

// menu
$images['menu_admin'] = "";
$images['menu_faq'] = "";
$images['menu_search'] = "";
$images['menu_memberlist'] = "";
$images['menu_usergroup'] = "";
$images['menu_register'] = "";
$images['menu_profile'] = "";
$images['menu_preferences'] = "";
$images['pm_new_msg'] =  "";
$images['pm_no_new_msg'] =  "";
$images['menu_login'] =  "";
$images['menu_logout'] =  "";

// various pics
$images['forum_mark_read'] = "";
$images['topic_mark_read'] = "";
$images['topic_unmark_read'] = "";
$images['topic_previous'] = "";
$images['topic_next'] = "";
$images['icon_go_top'] = "";

// index page
$images['whosonline'] = "$current_template_images/whosonline.gif";
$images['icon_unmark_read'] = "$current_template_images/icon_unmark_read.gif";

$images['category'] = "$current_template_images/cat_folder_big.gif";
$images['category_new'] = "$current_template_images/cat_folder_new_big.gif";
$images['category_locked'] = "$current_template_images/cat_folder_locked_big.gif";

$images['link'] = "$current_template_images/link_folder.gif";
$images['icon_minilink'] = "$current_template_images/icon_minilink.gif";

$images['forum_tiny'] = "$current_template_images/icon_minipost.gif";
$images['forum_new_tiny'] = "$current_template_images/icon_minipost_new.gif";
$images['forum_locked_tiny'] = "$current_template_images/icon_minipost_lock.gif";

$images['icon_minicat'] = "$current_template_images/icon_minicat.gif";
$images['icon_minicat_new'] = "$current_template_images/icon_minicat_new.gif";
$images['icon_minicat_locked'] = "$current_template_images/icon_minicat_lock.gif";

$images['topic_locked_tiny'] = "$current_template_images/icon_minipost_lock.gif";
$images['topic_poll_tiny'] = "$current_template_images/topic_poll_tiny.gif";
$images['topic_calendar_tiny'] = "$current_template_images/topic_calendar_tiny.gif";

// topics
$images['folder_locked_own'] = "$current_template_images/folder_lock_own.gif";
$images['folder_locked_new_own'] = "$current_template_images/folder_lock_new_own.gif";

$images['folder_global'] = "$current_template_images/folder_announce.gif";
$images['folder_global_new'] = "$current_template_images/folder_announce_new.gif";
$images['folder_global_own'] = "$current_template_images/folder_announce_own.gif";
$images['folder_global_new_own'] = "$current_template_images/folder_announce_new_own.gif";

$images['folder_announce_own'] = "$current_template_images/folder_announce_own.gif";
$images['folder_announce_new_own'] = "$current_template_images/folder_announce_new_own.gif";

$images['folder_sticky_own'] = "$current_template_images/folder_sticky_own.gif";
$images['folder_sticky_new_own'] = "$current_template_images/folder_sticky_new_own.gif";

$images['folder_moved'] = "$current_template_images/folder_moved.gif";

$images['folder_own'] = "$current_template_images/folder_own.gif";
$images['folder_new_own'] = "$current_template_images/folder_new_own.gif";
$images['folder_hot_own'] = "$current_template_images/folder_hot_own.gif";
$images['folder_hot_new_own'] = "$current_template_images/folder_new_hot_own.gif";

$images['folder_calendar'] = "$current_template_images/folder_calendar.gif";
$images['folder_calendar_new'] = "$current_template_images/folder_calendar_new.gif";
$images['folder_calendar_new_own'] = "$current_template_images/folder_calendar_new_own.gif";
$images['folder_calendar_own'] = "$current_template_images/folder_calendar_own.gif";

$images['tree_pic_' . TREE_HSPACE] = "$current_template_images/tree_hspace.gif";
$images['tree_pic_' . TREE_VSPACE] = "$current_template_images/tree_vspace.gif";
$images['tree_pic_' . TREE_CROSS] = "$current_template_images/tree_fcross.gif";
$images['tree_pic_' . TREE_CLOSE] = "$current_template_images/tree_hcross.gif";

$images['cmd_up_arrow'] = "$current_template_images/bs_arrow_up.gif";
$images['cmd_down_arrow'] = "$current_template_images/bs_arrow_down.gif";
$images['cmd_details'] = "$current_template_images/bs_command_details.gif";
$images['cmd_cancel'] = "$current_template_images/{LANG}/bs_command_cancel.gif";
$images['cmd_create'] = "$current_template_images/{LANG}/bs_command_create.gif";
$images['cmd_delete'] = "$current_template_images/{LANG}/bs_command_delete.gif";
$images['cmd_edit'] = "$current_template_images/{LANG}/bs_command_edit.gif";
$images['cmd_submit'] = "$current_template_images/{LANG}/bs_command_submit.gif";
$images['cmd_preview'] = $current_template_images . '/{LANG}/bs_command_preview.gif';
$images['cmd_select'] = "$current_template_images/{LANG}/bs_command_select.gif";
$images['cmd_search'] = "$current_template_images/{LANG}/bs_command_search.gif";
$images['cmd_synchro'] = "$current_template_images/{LANG}/bs_command_synchro.gif";
$images['cmd_export'] = "$current_template_images/{LANG}/bs_command_export.gif";
$images['cmd_check'] = "$current_template_images/{LANG}/bs_command_check.gif";
$images['cmd_regen'] = "$current_template_images/{LANG}/bs_command_regen.gif";
$images['cmd_add'] = "$current_template_images/{LANG}/bs_command_add.gif";

$images['cmd_mini_copy'] = "$current_template_images/bs_command_mini_copy.gif";
$images['cmd_mini_cancel'] = "$current_template_images/bs_command_mini_cancel.gif";
$images['cmd_mini_create'] = "$current_template_images/bs_command_mini_create.gif";
$images['cmd_mini_delete'] = "$current_template_images/bs_command_mini_delete.gif";
$images['cmd_mini_edit'] = "$current_template_images/bs_command_mini_edit.gif";
$images['cmd_mini_submit'] = "$current_template_images/bs_command_mini_submit.gif";
$images['cmd_mini_synchro'] = "$current_template_images/bs_command_mini_synchro.gif";

$images['sts_group'] = "$current_template_images/bs_status_group.gif";
$images['sts_user'] = "$current_template_images/bs_status_user.gif";

$images['spacer'] = "$current_template_images/spacer.gif";

// calendar
$images['folder_birthday'] = "$current_template_images/folder_calendar.gif";

$images['icon_calendar'] = "$current_template_images/icon_calendar.gif";
$images['menu_calendar'] = "$current_template_images/icon_mini_calendar.gif";
$images['icon_tiny_topic'] = "$current_template_images/icon_tiny_topic.gif";
$images['icon_tiny_profile'] = "$current_template_images/icon_tiny_profile.gif";
$images['up_arrow'] = "$current_template_images/icon_up_arrow.gif";
$images['down_arrow'] = "$current_template_images/icon_down_arrow.gif";

// control panels
$images['sts_group_manager'] = $current_template_images . '/fs_group_manager.gif';
$images['sts_group_mmanager'] = $current_template_images . '/fs_membership_manager.gif';
$images['sts_form'] = $current_template_images . '/fs_form.gif';
$images['sts_script'] = $current_template_images . '/fs_script.gif';
$images['sts_permission'] = $current_template_images . '/fs_permission.gif';
$images['sts_hidden'] = $current_template_images . '/fs_hidden.gif';

$images['cmd_mini_form'] = $current_template_images . '/bs_form.gif';
$images['cmd_join'] = $current_template_images . '/{LANG}/bm_join_group.gif';
$images['cmd_leave'] = $current_template_images . '/{LANG}/bm_leave_group.gif';
//-- fin mod : categories hierarchy --------------------------------------------
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/subSilver.css
#
#-----[ FIND ]------------------------------------------------
#
hr	{ height: 0px; border: solid #D1D7DC 0px; border-top-width: 1px;}
#
#-----[ AFTER, ADD ]------------------------------------------
#

/*--- mod : categories hierarchy */
form {
	margin: 0px;
	padding: 0px;
}
td.attachrow {
	color: #000000;
	font-size: 11px;
	font-weight: normal;
	border: 1px #006699 solid;
}
td.attachheader {
	color: #314687;
	font-size: 11px;
	font-weight: bold;
	background: #D7D7E7 url(images/cellpic1.gif) repeat-x;
	height: 21px;
	white-space: nowrap;
}
table.attachtable {
	color: #000000;
	font-size: 12px;
	font-weight: normal;
	border: 1px #006699 solid;
	border-collapse: collapse;
}
.absbottom {
	vertical-align: text-bottom;
}
.dom_overview_abshidden { position: absolute; visibility: hidden; width: 300px; }
/*--- fin mod : categories hierarchy */
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/viewonline_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
<table width="100%" cellspacing="2" cellpadding="2" border="0" align="center">
  <tr> 
	<td align="left"><span class="nav"><a href="{U_INDEX}" class="nav">{L_INDEX}</a></span></td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
{NAVIGATION_BOX}
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full line is longer
#
<img src="templates/subSilver/images/spacer.gif" width="1" height="1" alt=".">
#
#----------[ IN-LINE FIND ]-----------------------------------
#
<img src="templates/subSilver/images/spacer.gif" width="1" height="1" alt=".">
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
<img src="{I_SPACER}" width="1" height="1" alt="." />
#
#-----[ FIND ]------------------------------------------------
#
<br />

<table width="100%" cellspacing="2" border="0" align="center">
  <tr> 
	<td valign="top" align="right">{JUMPBOX}</td>
  </tr>
</table>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/viewtopic_poll_ballot.tpl
#
#-----[ FIND ]------------------------------------------------
#
						<td align="center">
			<input type="submit" name="submit" value="{L_SUBMIT_VOTE}" class="liteoption" />
		  </td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
						<td align="center"><!-- BEGIN buttons --><input type="submit" name="{buttons.BUTTON}" value="{buttons.L_BUTTON}" class="liteoption"<!-- BEGIN accesskey --> accesskey="{buttons.S_BUTTON}"<!-- END accesskey --> /><!-- END buttons --></td>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/viewtopic_poll_result.tpl
#
#-----[ FIND ]------------------------------------------------
#
					<td><img src="templates/subSilver/images/vote_lcap.gif" width="4" alt="" height="12" /></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
					<td><img src="{poll_option.POLL_OPTION_IMG_LEFT}" width="4" alt="" height="12" /></td>
#
#-----[ FIND ]------------------------------------------------
#
					<td><img src="templates/subSilver/images/vote_rcap.gif" width="4" alt="" height="12" /></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
					<td><img src="{poll_option.POLL_OPTION_IMG_RIGHT}" width="4" alt="" height="12" /></td>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/disallow_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
</table></form>
#
#-----[ AFTER, ADD ]------------------------------------------
#

<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/group_edit_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
	  <td class="row2" width="62%"><input class="post" type="text" class="post" name="username" maxlength="50" size="20" value="{GROUP_MODERATOR}" /> &nbsp; <input type="submit" name="usersubmit" value="{L_FIND_USERNAME}" class="liteoption" onClick="window.open('{U_SEARCH_USER}', '_phpbbsearch', 'HEIGHT=250,resizable=yes,WIDTH=400');return false;" /></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	  <td class="row2" width="62%"><input class="post" type="text" name="username" maxlength="50" size="20" value="{GROUP_MODERATOR}" /> &nbsp; <input type="submit" name="usersubmit" value="{L_FIND_USERNAME}" class="liteoption" onclick="window.open('{U_SEARCH_USER}', '_phpbbsearch', 'HEIGHT=250,resizable=yes,WIDTH=400');return false;" /></td>
#
#-----[ FIND ]------------------------------------------------
#
		<input type="radio" name="group_type" value="{S_GROUP_OPEN_TYPE}" {S_GROUP_OPEN_CHECKED} /> {L_GROUP_OPEN} &nbsp;&nbsp;<input type="radio" name="group_type" value="{S_GROUP_CLOSED_TYPE}" {S_GROUP_CLOSED_CHECKED} />	{L_GROUP_CLOSED} &nbsp;&nbsp;<input type="radio" name="group_type" value="{S_GROUP_HIDDEN_TYPE}" {S_GROUP_HIDDEN_CHECKED} />	{L_GROUP_HIDDEN}</td> 
	</tr>
#
#-----[ AFTER, ADD ]------------------------------------------
#
	<tr>
		<td class="row1"><span class="gen">{L_GROUP_SYSSTATUS}:</span></td>
		<td class="row2">
			<input type="radio" name="group_status" value="{GROUP_SYSSTATUS_STD}"{S_GROUP_SYSSTATUS_STD} /> {L_NO} &nbsp;&nbsp;<input type="radio" name="group_status" value="{GROUP_SYSSTATUS_SYS}"{S_GROUP_SYSSTATUS_SYS} /> {L_YES}
		</span></td>
	</tr>
	<tr>
		<td class="row1"><span class="gen">{L_GROUP_STYLE}:</span><span class="gensmall"><br />{L_GROUP_STYLE_EXPLAIN}</span></td>
		<td class="row2"><select name="group_style"><!-- BEGIN style --><option value="{style.STYLE_ID}"<!-- BEGIN selected --> selected="selected"<!-- END selected -->>{style.STYLE_NAME}</option><!-- END style --></select></td>
	</tr>
#
#-----[ FIND ]------------------------------------------------
#
		<input type="checkbox" name="delete_old_moderator" value="1">
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<input type="checkbox" name="delete_old_moderator" value="1" />
#
#-----[ FIND ]------------------------------------------------
#
		<input type="checkbox" name="group_delete" value="1">
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<input type="checkbox" name="group_delete" value="1" />
#
#-----[ FIND ]------------------------------------------------
#
		{L_GROUP_DELETE_CHECK}</td>
	</tr>
#
#-----[ AFTER, ADD ]------------------------------------------
#
	<!-- BEGINGLOBAL attachment -->
	<tr>
	  <td class="row1"><span class="gen">{L_UPLOAD_QUOTA}</span></td>
	  <td class="row2">{S_SELECT_UPLOAD_QUOTA}</td>
	</tr>
	<tr>
	  <td class="row1"><span class="gen">{L_PM_QUOTA}</span></td>
	  <td class="row2">{S_SELECT_PM_QUOTA}</td>
	</tr>
	<!-- ENDGLOBAL attachment -->
#
#-----[ FIND ]------------------------------------------------
#
</table>{S_HIDDEN_FIELDS}</form>
#
#-----[ AFTER, ADD ]------------------------------------------
#

<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/group_select_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
</table></form>
#
#-----[ AFTER, ADD ]------------------------------------------
#

<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/index_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
	<td width="20%" class="{reg_user_row.ROW_CLASS}">&nbsp;<span class="gen"><a href="{reg_user_row.U_USER_PROFILE}" class="gen">{reg_user_row.USERNAME}</a></span>&nbsp;</td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<td width="20%" class="{reg_user_row.ROW_CLASS}">&nbsp;<span class="gen"><a href="{reg_user_row.U_USER_PROFILE}" class="gen" target="_parent">{reg_user_row.USERNAME}</a></span>&nbsp;</td>
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full line is longer
#
<img src="../templates/subSilver/images/spacer.gif" width="1" height="1" alt=".">
#
#----------[ IN-LINE FIND ]-----------------------------------
#
<img src="../templates/subSilver/images/spacer.gif" width="1" height="1" alt=".">
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
<img src="{I_SPACER}" width="1" height="1" alt="." />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/index_navigate.tpl
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full line is longer
#
<img src="../templates/subSilver/images/logo_phpBB_med.gif" border="0" />
#
#----------[ IN-LINE FIND ]-----------------------------------
#
<img src="../templates/subSilver/images/logo_phpBB_med.gif" border="0" />
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
<img src="{I_LOGO_SMALL}" border="0" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/page_footer.tpl
#
#-----[ FIND ]------------------------------------------------
#
</body>
</html>
#
#-----[ BEFORE, ADD ]-----------------------------------------
#
<!-- INCLUDE stat_run_body.tpl -->
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/page_header.tpl
#
#-----[ FIND ]------------------------------------------------
#
h1,h2		{ font-family: "Trebuchet MS", Verdana, Arial, Helvetica, sans-serif; font-size : 22px; font-weight : bold; text-decoration : none; line-height : 120%; color : #000000;}
#
#-----[ AFTER, ADD ]------------------------------------------
#

/*--- mod : categories hierarchy */
form {
	margin: 0px;
	padding: 0px;
}
td.attachrow {
	color: #000000;
	font-size: 11px;
	font-weight: normal;
	border: 1px #006699 solid;
}
td.attachheader {
	color: #314687;
	font-size: 11px;
	font-weight: bold;
	background: #D7D7E7 url(images/cellpic1.gif) repeat-x;
	height: 21px;
	white-space: nowrap;
}
table.attachtable {
	color: #000000;
	font-size: 12px;
	font-weight: normal;
	border: 1px #006699 solid;
	border-collapse: collapse;
}
.absbottom {
	vertical-align: text-bottom;
}
.dom_overview_abshidden { position: absolute; visibility: hidden; width: 300px; }
/*--- fin mod : categories hierarchy */
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/ranks_edit_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
{S_HIDDEN_FIELDS}</form>
#
#-----[ AFTER, ADD ]------------------------------------------
#

<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/ranks_list_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
</table></form>
#
#-----[ AFTER, ADD ]------------------------------------------
#

<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/smile_edit_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
</table></form>
#
#-----[ AFTER, ADD ]------------------------------------------
#

<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/smile_import_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
# this is a partial search: the full line is longer
#
<input type="radio" name="replace" value="1" checked="checked"/>
#
#----------[ IN-LINE FIND ]-----------------------------------
#
<input type="radio" name="replace" value="1" checked="checked"/>
#
#----------[ IN-LINE REPLACE WITH ]---------------------------
#
<input type="radio" name="replace" value="1" checked="checked" />
#
#-----[ FIND ]------------------------------------------------
#
</table></form>
#
#-----[ AFTER, ADD ]------------------------------------------
#

<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/smile_list_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
<P>{L_SMILEY_TEXT}</p>
#
#-----[ REPLACE WITH ]----------------------------------------
#
<p>{L_SMILEY_TEXT}</p>
#
#-----[ FIND ]------------------------------------------------
#
		<td class="catBottom" colspan="5" align="center">{S_HIDDEN_FIELDS}<input type="submit" name="add" value="{L_SMILEY_ADD}" class="mainoption" />&nbsp;&nbsp;<input class="liteoption" type="submit" name="import_pack" value="{L_IMPORT_PACK}">&nbsp;&nbsp;<input class="liteoption" type="submit" name="export_pack" value="{L_EXPORT_PACK}"></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<td class="catBottom" colspan="5" align="center">{S_HIDDEN_FIELDS}<input type="submit" name="add" value="{L_SMILEY_ADD}" class="mainoption" />&nbsp;&nbsp;<input class="liteoption" type="submit" name="import_pack" value="{L_IMPORT_PACK}" />&nbsp;&nbsp;<input class="liteoption" type="submit" name="export_pack" value="{L_EXPORT_PACK}" /></td>
#
#-----[ FIND ]------------------------------------------------
#
</table></form>
#
#-----[ AFTER, ADD ]------------------------------------------
#

<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/styles_addnew_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
</table>
#
#-----[ AFTER, ADD ]------------------------------------------
#

<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/styles_edit_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
		<td class="row2" colspan="2"><input class="post" type="text" size="25" maxlength="100" name="style_name" value="{THEME_NAME}"></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
		<td class="row2" colspan="2"><input class="post" type="text" size="25" maxlength="100" name="style_name" value="{THEME_NAME}" /></td>
#
#-----[ FIND ]------------------------------------------------
#
		<td class="row2" colspan="2">{S_TEMPLATE_SELECT}</td>
	</tr>
#
#-----[ AFTER, ADD ]------------------------------------------
#
	<tr>
		<td class="row1">{L_STYLE_PRIVATE}:<span class="gensmall"><br />{L_STYLE_PRIVATE_EXPLAIN}</span></td>
		<td class="row2" colspan="2"><input type="checkbox" name="style_private" value="1"<!-- BEGIN style_private --> checked="checked"<!-- END style_private --> /></td>
	</tr>
	<tr>
		<td class="row1">{L_IMAGES_PACK}:<span class="gensmall"><br />{L_IMAGES_PACK_EXPLAIN}</span></td>
		<td class="row2" colspan="2"><input class="post" type="text" size="50" maxlength="100" name="images_pack" value="{IMAGES_PACK}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_CUSTOM_TPLS}:<span class="gensmall"><br />{L_CUSTOM_TPLS_EXPLAIN}</span></td>
		<td class="row2" colspan="2"><input class="post" type="text" size="50" maxlength="100" name="custom_tpls" value="{CUSTOM_TPLS}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_STYLESHEET}:<span class="gensmall"><br />{L_STYLESHEET_EXPLAIN}</span></td>
		<td class="row2" colspan="2"><input class="post" type="text" size="50" maxlength="100" name="head_stylesheet" value="{HEAD_STYLESHEET}" /></td>
	</tr>
#
#-----[ FIND ]------------------------------------------------
#
	<tr>
		<td class="row1">{L_STYLESHEET}:<br /><span class="gensmall">{L_STYLESHEET_EXPLAIN}</span></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="head_stylesheet" value="{HEAD_STYLESHEET}"></td>
		<td class="row2">&nbsp;</td>		
	</tr>
	<tr>
		<td class="row1">{L_BACKGROUND_IMAGE}:</td>
		<td class="row2" ><input class="post" type="text" size="25" maxlength="100" name="body_background" value="{BODY_BACKGROUND}"></td>
		<td class="row2">&nbsp;</td>		
	</tr>
	<tr>
		<td class="row1">{L_BACKGROUND_COLOR}:</td>
		<td class="row2" ><input class="post" type="text" size="6" maxlength="6" name="body_bgcolor" value="{BODY_BGCOLOR}"></td>
		<td class="row2">&nbsp;</td>
	</tr>
	<tr>
		<td class="row1">{L_BODY_TEXT_COLOR}:</td>
		<td class="row2" ><input class="post" type="text" size="6" maxlength="6" name="body_text" value="{BODY_TEXT_COLOR}"></td>
		<td class="row2">&nbsp;</td>
	</tr>
	<tr>
		<td class="row1">{L_BODY_LINK_COLOR}:</td>
		<td class="row2" ><input class="post" type="text" size="6" maxlength="6" name="body_link" value="{BODY_LINK_COLOR}"></td>
		<td class="row2">&nbsp;</td>
	</tr>
	<tr>
		<td class="row1">{L_BODY_VLINK_COLOR}:</td>
		<td class="row2" ><input class="post" type="text" size="6" maxlength="6" name="body_vlink" value="{BODY_VLINK_COLOR}"></td>
		<td class="row2">&nbsp;</td>		
	</tr>
	<tr>
		<td class="row1">{L_BODY_ALINK_COLOR}:</td>
		<td class="row2" ><input class="post" type="text" size="6" maxlength="6" name="body_alink" value="{BODY_ALINK_COLOR}"></td>
		<td class="row2">&nbsp;</td>		
	</tr>
	<tr>
		<td class="row1">{L_BODY_HLINK_COLOR}:</td>
		<td class="row2" ><input class="post" type="text" size="6" maxlength="6" name="body_hlink" value="{BODY_HLINK_COLOR}"></td>
		<td class="row2">&nbsp;</td>		
	</tr>

	<tr>
		<td class="row1">{L_TR_COLOR1}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="tr_color1" value="{TR_COLOR1}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="tr_color1_name" value="{TR_COLOR1_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_TR_COLOR2}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="tr_color2" value="{TR_COLOR2}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="tr_color2_name" value="{TR_COLOR2_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_TR_COLOR3}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="tr_color3" value="{TR_COLOR3}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="tr_color3_name" value="{TR_COLOR3_NAME}">
	</tr>
	<tr>
		<td class="row1">{L_TR_CLASS1}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="tr_class1" value="{TR_CLASS1}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="tr_class1_name" value="{TR_CLASS1_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_TR_CLASS2}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="tr_class2" value="{TR_CLASS2}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="tr_class2_name" value="{TR_CLASS2_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_TR_CLASS3}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="tr_class3" value="{TR_CLASS3}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="tr_class3_name" value="{TR_CLASS3_NAME}">
	</tr>
	<tr>
		<td class="row1">{L_TH_COLOR1}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="th_color1" value="{TH_COLOR1}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="th_color1_name" value="{TH_COLOR1_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_TH_COLOR2}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="th_color2" value="{TH_COLOR2}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="th_color2_name" value="{TH_COLOR2_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_TH_COLOR3}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="th_color3" value="{TH_COLOR3}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="th_color3_name" value="{TH_COLOR3_NAME}">
	</tr>
	<tr>
		<td class="row1">{L_TH_CLASS1}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="th_class1" value="{TH_CLASS1}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="th_class1_name" value="{TH_CLASS1_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_TH_CLASS2}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="th_class2" value="{TH_CLASS2}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="th_class2_name" value="{TH_CLASS2_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_TH_CLASS3}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="th_class3" value="{TH_CLASS3}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="th_class3_name" value="{TH_CLASS3_NAME}">
	</tr>
	<tr>
		<td class="row1">{L_TD_COLOR1}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="td_color1" value="{TD_COLOR1}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="td_color1_name" value="{TD_COLOR1_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_TD_COLOR2}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="td_color2" value="{TD_COLOR2}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="td_color2_name" value="{TD_COLOR2_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_TD_COLOR3}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="td_color3" value="{TD_COLOR3}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="td_color3_name" value="{TD_COLOR3_NAME}">
	</tr>
	<tr>
		<td class="row1">{L_TD_CLASS1}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="td_class1" value="{TD_CLASS1}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="td_class1_name" value="{TD_CLASS1_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_TD_CLASS2}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="td_class2" value="{TD_CLASS2}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="td_class2_name" value="{TD_CLASS2_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_TD_CLASS3}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="td_class3" value="{TD_CLASS3}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="td_class3_name" value="{TD_CLASS3_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_FONTFACE_1}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="50" name="fontface1" value="{FONTFACE1}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontface1_name" value="{FONTFACE1_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_FONTFACE_2}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="50" name="fontface2" value="{FONTFACE2}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontface2_name" value="{FONTFACE2_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_FONTFACE_3}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="50" name="fontface3" value="{FONTFACE3}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontface3_name" value="{FONTFACE3_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_FONTSIZE_1}:</td>
		<td class="row2"><input class="post" type="text" size="4" maxlength="4" name="fontsize1" value="{FONTSIZE1}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontsize1_name" value="{FONTSIZE1_NAME}">	
	</tr>

	<tr>
		<td class="row1">{L_FONTSIZE_2}:</td>
		<td class="row2"><input class="post" type="text" size="4" maxlength="4" name="fontsize2" value="{FONTSIZE2}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontsize2_name" value="{FONTSIZE2_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_FONTSIZE_3}:</td>
		<td class="row2"><input class="post" type="text" size="4" maxlength="4" name="fontsize3" value="{FONTSIZE3}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontsize3_name" value="{FONTSIZE3_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_FONTCOLOR_1}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="fontcolor1" value="{FONTCOLOR1}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontcolor1_name" value="{FONTCOLOR1_NAME}">	
	</tr>

	<tr>
		<td class="row1">{L_FONTCOLOR_2}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="fontcolor2" value="{FONTCOLOR2}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontcolor2_name" value="{FONTCOLOR2_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_FONTCOLOR_3}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="fontcolor3" value="{FONTCOLOR3}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontcolor3_name" value="{FONTCOLOR3_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_SPAN_CLASS_1}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="span_class1" value="{SPAN_CLASS1}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="span_class1_name" value="{SPAN_CLASS1_NAME}">	
	</tr>

	<tr>
		<td class="row1">{L_SPAN_CLASS_2}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="span_class2" value="{SPAN_CLASS2}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="span_class2_name" value="{SPAN_CLASS2_NAME}">
	</tr>

	<tr>
		<td class="row1">{L_SPAN_CLASS_3}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="span_class3" value="{SPAN_CLASS3}"></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="span_class3_name" value="{SPAN_CLASS3_NAME}">
	</tr>


	<tr>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	<tr>
		<td class="row1">{L_BACKGROUND_IMAGE}:</td>
		<td class="row2" ><input class="post" type="text" size="25" maxlength="100" name="body_background" value="{BODY_BACKGROUND}" /></td>
		<td class="row2">&nbsp;</td>
	</tr>
	<tr>
		<td class="row1">{L_BACKGROUND_COLOR}:</td>
		<td class="row2" ><input class="post" type="text" size="6" maxlength="6" name="body_bgcolor" value="{BODY_BGCOLOR}" /></td>
		<td class="row2">&nbsp;</td>
	</tr>
	<tr>
		<td class="row1">{L_BODY_TEXT_COLOR}:</td>
		<td class="row2" ><input class="post" type="text" size="6" maxlength="6" name="body_text" value="{BODY_TEXT_COLOR}" /></td>
		<td class="row2">&nbsp;</td>
	</tr>
	<tr>
		<td class="row1">{L_BODY_LINK_COLOR}:</td>
		<td class="row2" ><input class="post" type="text" size="6" maxlength="6" name="body_link" value="{BODY_LINK_COLOR}" /></td>
		<td class="row2">&nbsp;</td>
	</tr>
	<tr>
		<td class="row1">{L_BODY_VLINK_COLOR}:</td>
		<td class="row2" ><input class="post" type="text" size="6" maxlength="6" name="body_vlink" value="{BODY_VLINK_COLOR}" /></td>
		<td class="row2">&nbsp;</td>		
	</tr>
	<tr>
		<td class="row1">{L_BODY_ALINK_COLOR}:</td>
		<td class="row2" ><input class="post" type="text" size="6" maxlength="6" name="body_alink" value="{BODY_ALINK_COLOR}" /></td>
		<td class="row2">&nbsp;</td>
	</tr>
	<tr>
		<td class="row1">{L_BODY_HLINK_COLOR}:</td>
		<td class="row2" ><input class="post" type="text" size="6" maxlength="6" name="body_hlink" value="{BODY_HLINK_COLOR}" /></td>
		<td class="row2">&nbsp;</td>
	</tr>
	<tr>
		<td class="row1">{L_TR_COLOR1}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="tr_color1" value="{TR_COLOR1}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="tr_color1_name" value="{TR_COLOR1_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TR_COLOR2}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="tr_color2" value="{TR_COLOR2}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="tr_color2_name" value="{TR_COLOR2_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TR_COLOR3}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="tr_color3" value="{TR_COLOR3}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="tr_color3_name" value="{TR_COLOR3_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TR_CLASS1}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="tr_class1" value="{TR_CLASS1}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="tr_class1_name" value="{TR_CLASS1_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TR_CLASS2}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="tr_class2" value="{TR_CLASS2}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="tr_class2_name" value="{TR_CLASS2_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TR_CLASS3}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="tr_class3" value="{TR_CLASS3}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="tr_class3_name" value="{TR_CLASS3_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TH_COLOR1}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="th_color1" value="{TH_COLOR1}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="th_color1_name" value="{TH_COLOR1_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TH_COLOR2}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="th_color2" value="{TH_COLOR2}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="th_color2_name" value="{TH_COLOR2_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TH_COLOR3}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="th_color3" value="{TH_COLOR3}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="th_color3_name" value="{TH_COLOR3_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TH_CLASS1}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="th_class1" value="{TH_CLASS1}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="th_class1_name" value="{TH_CLASS1_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TH_CLASS2}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="th_class2" value="{TH_CLASS2}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="th_class2_name" value="{TH_CLASS2_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TH_CLASS3}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="th_class3" value="{TH_CLASS3}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="th_class3_name" value="{TH_CLASS3_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TD_COLOR1}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="td_color1" value="{TD_COLOR1}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="td_color1_name" value="{TD_COLOR1_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TD_COLOR2}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="td_color2" value="{TD_COLOR2}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="td_color2_name" value="{TD_COLOR2_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TD_COLOR3}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="td_color3" value="{TD_COLOR3}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="td_color3_name" value="{TD_COLOR3_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TD_CLASS1}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="td_class1" value="{TD_CLASS1}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="td_class1_name" value="{TD_CLASS1_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TD_CLASS2}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="td_class2" value="{TD_CLASS2}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="td_class2_name" value="{TD_CLASS2_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_TD_CLASS3}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="td_class3" value="{TD_CLASS3}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="td_class3_name" value="{TD_CLASS3_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_FONTFACE_1}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="50" name="fontface1" value="{FONTFACE1}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontface1_name" value="{FONTFACE1_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_FONTFACE_2}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="50" name="fontface2" value="{FONTFACE2}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontface2_name" value="{FONTFACE2_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_FONTFACE_3}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="50" name="fontface3" value="{FONTFACE3}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontface3_name" value="{FONTFACE3_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_FONTSIZE_1}:</td>
		<td class="row2"><input class="post" type="text" size="4" maxlength="4" name="fontsize1" value="{FONTSIZE1}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontsize1_name" value="{FONTSIZE1_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_FONTSIZE_2}:</td>
		<td class="row2"><input class="post" type="text" size="4" maxlength="4" name="fontsize2" value="{FONTSIZE2}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontsize2_name" value="{FONTSIZE2_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_FONTSIZE_3}:</td>
		<td class="row2"><input class="post" type="text" size="4" maxlength="4" name="fontsize3" value="{FONTSIZE3}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontsize3_name" value="{FONTSIZE3_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_FONTCOLOR_1}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="fontcolor1" value="{FONTCOLOR1}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontcolor1_name" value="{FONTCOLOR1_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_FONTCOLOR_2}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="fontcolor2" value="{FONTCOLOR2}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontcolor2_name" value="{FONTCOLOR2_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_FONTCOLOR_3}:</td>
		<td class="row2"><input class="post" type="text" size="6" maxlength="6" name="fontcolor3" value="{FONTCOLOR3}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="fontcolor3_name" value="{FONTCOLOR3_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_SPAN_CLASS_1}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="span_class1" value="{SPAN_CLASS1}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="span_class1_name" value="{SPAN_CLASS1_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_SPAN_CLASS_2}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="span_class2" value="{SPAN_CLASS2}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="span_class2_name" value="{SPAN_CLASS2_NAME}" /></td>
	</tr>
	<tr>
		<td class="row1">{L_SPAN_CLASS_3}:</td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="25" name="span_class3" value="{SPAN_CLASS3}" /></td>
		<td class="row2"><input class="post" type="text" size="25" maxlength="100" name="span_class3_name" value="{SPAN_CLASS3_NAME}" /></td>
	</tr>
	<tr>
#
#-----[ FIND ]------------------------------------------------
#
<br clear="all">

#
#-----[ REPLACE WITH ]----------------------------------------
#
<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/styles_exporter.tpl
#
#-----[ FIND ]------------------------------------------------
#
</table></form>
#
#-----[ AFTER, ADD ]------------------------------------------
#

<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/styles_list_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
</table>
#
#-----[ AFTER, ADD ]------------------------------------------
#

<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/user_ban_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
	  <td class="row2"><input class="post" type="text" class="post" name="username" maxlength="50" size="20" /> <input type="hidden" name="mode" value="edit" />{S_HIDDEN_FIELDS} <input type="submit" name="usersubmit" value="{L_FIND_USERNAME}" class="liteoption" onClick="window.open('{U_SEARCH_USER}', '_phpbbsearch', 'HEIGHT=250,resizable=yes,WIDTH=400');return false;" /></td>
#
#-----[ REPLACE WITH ]----------------------------------------
#
	  <td class="row2"><input class="post" type="text" name="username" maxlength="50" size="20" /> <input type="hidden" name="mode" value="edit" />{S_HIDDEN_FIELDS} <input type="submit" name="usersubmit" value="{L_FIND_USERNAME}" class="liteoption" onclick="window.open('{U_SEARCH_USER}', '_phpbbsearch', 'HEIGHT=250,resizable=yes,WIDTH=400');return false;" /></td>
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/user_email_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
	  <td class="row1" align="right" valign="top"> <span class="gen"><b>{L_EMAIL_MSG}</b></span> 
	  <td class="row2"><span class="gen"> <textarea name="message" rows="15" cols="35" wrap="virtual" style="width:450px" tabindex="3" class="post">{MESSAGE}</textarea></span> 
#
#-----[ REPLACE WITH ]----------------------------------------
#
	  <td class="row1" align="right" valign="top"> <span class="gen"><b>{L_EMAIL_MSG}</b></span></td>
	  <td class="row2"><span class="gen"> <textarea name="message" rows="15" cols="35" wrap="virtual" style="width:450px" tabindex="3" class="post">{MESSAGE}</textarea></span></td>
#
#-----[ FIND ]------------------------------------------------
#
</form>
#
#-----[ AFTER, ADD ]------------------------------------------
#

<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/words_edit_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
</table></form>
#
#-----[ AFTER, ADD ]------------------------------------------
#

<br clear="all" />
#
#-----[ OPEN ]------------------------------------------------
#
templates/subSilver/admin/words_list_body.tpl
#
#-----[ FIND ]------------------------------------------------
#
</table></form>
#
#-----[ AFTER, ADD ]------------------------------------------
#

<br clear="all" />
#
#-----[ SAVE/CLOSE ALL FILES ]--------------------------------
#
# EoM